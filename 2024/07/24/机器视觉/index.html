<!DOCTYPE HTML>
<html lang="zh-CN">




<head>
    <meta charset="utf-8">
    <meta name="keywords" content="机器视觉笔记, Yolo&#39;s blog">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>机器视觉笔记 | Yolo&#39;s blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>

<meta name="generator" content="Hexo 7.2.0"></head>


 




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Yolo&#39;s blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Yolo&#39;s blog</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/zw0927/zw0927.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/zw0927/zw0927.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('https://s2.loli.net/2024/06/06/dY4vajhPWgO3zsb.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">机器视觉笔记</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }
	
	#toc-content {
    height: calc(100vh - 250px);
    overflow: scroll;
}

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">
                                <span class="chip bg-color">人工智能</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2024-07-24
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2024-07-24
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    29.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    122 分
                </div>
                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        
        <!-- 代码块折行 -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="机器视觉笔记"><a href="#机器视觉笔记" class="headerlink" title="机器视觉笔记"></a>机器视觉笔记</h1><h2 id="1-Halcon语法"><a href="#1-Halcon语法" class="headerlink" title="1.Halcon语法"></a>1.Halcon语法</h2><h3 id="一、语法介绍"><a href="#一、语法介绍" class="headerlink" title="一、语法介绍"></a>一、语法介绍</h3><h4 id="①赋值和逻辑比较"><a href="#①赋值和逻辑比较" class="headerlink" title="①赋值和逻辑比较"></a>①赋值和逻辑比较</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>）   赋值等号:        :=                            例如：   A ：=<span class="number">1000</span></span><br><span class="line"></span><br><span class="line"><span class="number">2</span>）   不等号:          <span class="meta">#                             例如：   <span class="keyword">if</span>（A # B）</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span>）   注释符:          *</span><br><span class="line"></span><br><span class="line"><span class="number">4</span>）   字符串赋值:  	   str  :=  ’halcon’</span><br><span class="line"></span><br><span class="line"><span class="number">5</span>）   等于比较符:      =                           例如：   <span class="keyword">if</span>  (X = <span class="number">10</span> )</span><br><span class="line"></span><br><span class="line"><span class="number">6</span>)    逻辑与<span class="keyword">and</span>									 例如：    <span class="keyword">if</span> (A&gt;<span class="number">1</span> <span class="keyword">and</span> A&lt;<span class="number">30</span> )</span><br><span class="line"></span><br><span class="line"><span class="number">7</span>）   逻辑或<span class="keyword">or</span>                                    例如：    <span class="keyword">if</span>(A&gt;<span class="number">1</span> <span class="keyword">or</span> A&lt;<span class="number">30</span> )</span><br><span class="line"></span><br><span class="line"><span class="number">8</span>）   逻辑反<span class="keyword">not</span>                                   例如：   <span class="keyword">if</span>( <span class="keyword">not</span>(A=<span class="number">10</span> ) )</span><br></pre></td></tr></table></figure>

<h4 id="②元组的操作"><a href="#②元组的操作" class="headerlink" title="②元组的操作"></a>②元组的操作</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">赋值</span><br><span class="line">St ：= [ St, iterm ]</span><br><span class="line">访问</span><br><span class="line">iterm ：= St[ i ]</span><br></pre></td></tr></table></figure>

<h4 id="③控制语句"><a href="#③控制语句" class="headerlink" title="③控制语句"></a>③控制语句</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>）For 循环：                                     </span><br><span class="line">例如：   </span><br><span class="line"><span class="keyword">for</span> I := <span class="number">0</span> to NumBalls - <span class="number">1</span> <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line">     语句</span><br><span class="line">endfor</span><br><span class="line"></span><br><span class="line"><span class="number">2</span>） While 循环：                                      </span><br><span class="line">例如：</span><br><span class="line"><span class="keyword">while</span> (x==<span class="number">1</span>)</span><br><span class="line">  语句</span><br><span class="line">Endwhile</span><br><span class="line"></span><br><span class="line"><span class="number">3</span>） 异常捕获:                                       </span><br><span class="line">例如： </span><br><span class="line">Try</span><br><span class="line">  语句</span><br><span class="line"><span class="keyword">catch</span> (Exception)</span><br><span class="line">  语句</span><br><span class="line">Endtry</span><br><span class="line">    </span><br><span class="line">Switch多分支:                                 </span><br><span class="line">例如：   </span><br><span class="line"><span class="keyword">switch</span> (Index)</span><br><span class="line">	<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">	<span class="keyword">break</span></span><br><span class="line">	<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">	<span class="keyword">break</span></span><br><span class="line">	<span class="literal">default</span>:</span><br><span class="line">	 <span class="keyword">break</span></span><br><span class="line"> endswitch</span><br></pre></td></tr></table></figure>

<h4 id="④Halcon开发流程"><a href="#④Halcon开发流程" class="headerlink" title="④Halcon开发流程"></a>④Halcon开发流程</h4><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704145418384.png" alt="image-20240704145418384"></p>
<h3 id="二、代码实例（在HDevelop运行）"><a href="#二、代码实例（在HDevelop运行）" class="headerlink" title="二、代码实例（在HDevelop运行）"></a>二、代码实例（在HDevelop运行）</h3><h4 id="①显示图片代码"><a href="#①显示图片代码" class="headerlink" title="①显示图片代码"></a>①显示图片代码</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">* 引入图片</span><br><span class="line">read_image(Image,<span class="string">&#x27;C:/Users/Pictures/Pictures/image.jpg&#x27;</span>)</span><br><span class="line">read_image(Image1,<span class="string">&#x27;fabrik&#x27;</span>)  软件安装目录下的image，不需要写全部路径</span><br><span class="line"></span><br><span class="line">* 获取图像大小</span><br><span class="line">get_image_size(Image, Width, Height)</span><br><span class="line"></span><br><span class="line">* 打开图像窗口</span><br><span class="line">* WindowHandle:窗口管理者(handle句柄，在某一个进程中的唯一索引)</span><br><span class="line">dev_open_window(<span class="number">0</span>, <span class="number">0</span>, Width, Height, <span class="string">&#x27;black&#x27;</span>, WindowHandle)</span><br><span class="line"></span><br><span class="line">*设置当前填充区域</span><br><span class="line">dev_set_draw(<span class="string">&#x27;margin&#x27;</span>)</span><br><span class="line"></span><br><span class="line">* 显示图像</span><br><span class="line">dev_display(Image)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/91ff1d56381647c1b3e9269dd7801adf-1717663052102-13.png" alt="在这里插入图片描述"></p>
<h4 id="②基础语法运行代码"><a href="#②基础语法运行代码" class="headerlink" title="②基础语法运行代码"></a>②基础语法运行代码</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">* 语法学习</span><br><span class="line">* 声明变量</span><br><span class="line">* C<span class="meta">#语法是 int x = 1</span></span><br><span class="line">* halcon赋值语法是 x:=<span class="number">1</span></span><br><span class="line">x:=<span class="number">1</span></span><br><span class="line">y:=<span class="string">&#x27;Hello halcon&#x27;</span></span><br><span class="line">i:=<span class="number">1.0</span></span><br><span class="line"></span><br><span class="line">* 分支语句判断 <span class="function"><span class="keyword">if</span></span></span><br><span class="line"><span class="function"><span class="title">if</span>(<span class="params">i=x</span>)</span></span><br><span class="line"><span class="function">    i:</span>=<span class="number">2.2</span></span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">* 不等于</span><br><span class="line"><span class="keyword">if</span>(x<span class="meta">#2)</span></span><br><span class="line">    i:=<span class="number">1.0</span></span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">* &gt; &lt; 和C<span class="meta">#都是一样的</span></span><br><span class="line"><span class="keyword">if</span>(i&gt;<span class="number">6</span>)</span><br><span class="line"><span class="function">endif</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">if</span>(<span class="params">i&lt;<span class="number">6</span></span>)</span></span><br><span class="line"><span class="function">endif</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">* <span class="keyword">else</span> <span class="keyword">if</span> 判断</span></span><br><span class="line"><span class="function"><span class="title">if</span>(<span class="params">i&gt;<span class="number">0</span></span>)</span></span><br><span class="line"><span class="function">    i:</span>=<span class="number">2.0</span></span><br><span class="line">elseif(i&lt;<span class="number">2</span>)</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">* 逻辑与 &amp;&amp;</span><br><span class="line"><span class="keyword">if</span>(x&gt;<span class="number">0</span> <span class="keyword">and</span> x&lt;<span class="number">3</span>)</span><br><span class="line">    i:=<span class="number">4.0</span></span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">* 逻辑或 ||</span><br><span class="line"><span class="keyword">if</span>(x&gt;<span class="number">0</span> <span class="keyword">or</span> x&lt;<span class="number">3</span>)</span><br><span class="line">    i:=<span class="number">5.0</span></span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">* 逻辑非 !=</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">not</span>(x=<span class="number">8</span>))</span><br><span class="line">    i:=<span class="number">8</span></span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">* 数组</span><br><span class="line">nums:=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">nums2:=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4.5</span>]</span><br><span class="line">nums3:=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="string">&#x27;4.5&#x27;</span>]</span><br><span class="line"></span><br><span class="line">* <span class="keyword">for</span>循环（j从<span class="number">0</span>到<span class="number">5</span>，步长为<span class="number">1</span>）</span><br><span class="line"><span class="keyword">for</span> j:=<span class="number">0</span> to <span class="number">5</span> <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line">endfor</span><br><span class="line"></span><br><span class="line">* <span class="keyword">while</span> 循环</span><br><span class="line">a:=<span class="number">1</span></span><br><span class="line"><span class="keyword">while</span>(a==<span class="number">1</span>)</span><br><span class="line">    a:=<span class="number">2</span></span><br><span class="line">endwhile</span><br><span class="line"></span><br><span class="line">* <span class="keyword">switch</span> <span class="keyword">case</span> 循环</span><br><span class="line"><span class="keyword">switch</span>(a)</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">    a:=<span class="number">5</span></span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    a:=<span class="number">6</span></span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">endswitch</span><br><span class="line"></span><br><span class="line">* 元组</span><br><span class="line">nums:=[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">* 元组长度</span><br><span class="line">len := |nums|</span><br><span class="line"></span><br><span class="line">* 异常捕获</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">    * nums<span class="number">-1</span> 长度<span class="number">-1</span></span><br><span class="line">    * nums<span class="number">-1</span> 长度在这里有问题，需要换成 |nums|</span><br><span class="line">    <span class="keyword">for</span> Index := <span class="number">0</span> to |nums| <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line">        a:=nums[Index]</span><br><span class="line">    <span class="function">endfor</span></span><br><span class="line"><span class="function"><span class="title">catch</span> (<span class="params">Exception</span>)</span></span><br><span class="line"><span class="function">    *<span class="title">disp_message</span> (<span class="params"><span class="number">3600</span>, Exception, <span class="string">&#x27;window&#x27;</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function">endtry</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">* 进制：halcon对进制可以直接转换。</span></span><br><span class="line"><span class="function">i1 :</span>= <span class="number">123</span>$<span class="string">&#x27;#o&#x27;</span> <span class="comment">//8进制，0代表前缀</span></span><br><span class="line">i2 := <span class="number">123</span>$<span class="string">&#x27;#x&#x27;</span> <span class="comment">//16进制，0x为前缀，7b代表赋值</span></span><br><span class="line">i2 := <span class="number">123</span>$<span class="string">&#x27;#X&#x27;</span> <span class="comment">//7B为赋值，7b=7B</span></span><br><span class="line">i3 := <span class="number">123</span>$<span class="string">&#x27;#f&#x27;</span> <span class="comment">//double类型，默认保留小数点后六位</span></span><br><span class="line">i4 := <span class="number">123</span>$<span class="string">&#x27;#g&#x27;</span> <span class="comment">//</span></span><br><span class="line">i5 := <span class="number">123</span>$<span class="string">&#x27;#G&#x27;</span> <span class="comment">//</span></span><br><span class="line">i6 := <span class="number">123</span>$<span class="string">&#x27;#e&#x27;</span> <span class="comment">//转成科学计数</span></span><br><span class="line">i7 := <span class="number">123</span>$<span class="string">&#x27;#E&#x27;</span> <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">* 整数</span><br><span class="line">d1 := <span class="number">123</span>$<span class="string">&#x27;6&#x27;</span> <span class="comment">// 小于6位文本右对齐，大于6位忽略</span></span><br><span class="line">d2 := <span class="number">123456</span>$<span class="string">&#x27;6&#x27;</span> <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">d3 := <span class="number">123</span>$<span class="string">&#x27;-6&#x27;</span> <span class="comment">// 小于6位文本左对齐，大于6位忽略</span></span><br><span class="line">d4 := <span class="number">123456</span>$<span class="string">&#x27;-6&#x27;</span> <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">d5 := <span class="number">123</span>$<span class="string">&#x27;.6&#x27;</span> <span class="comment">// 小于6位时，文本左补零</span></span><br><span class="line">d6 := <span class="number">123</span>$<span class="string">&#x27;10.5&#x27;</span> <span class="comment">// 小于十位时，文本右对齐，小于五位补零</span></span><br><span class="line">d7:= <span class="number">12345</span>$<span class="string">&#x27;10.5&#x27;</span> <span class="comment">//</span></span><br><span class="line">d8:= <span class="number">1234567891</span>$<span class="string">&#x27;10.5&#x27;</span> <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">* 四舍五入</span><br><span class="line">e := <span class="number">1.5555</span></span><br><span class="line">e1 := e$<span class="string">&#x27;.0f&#x27;</span></span><br><span class="line">e2 := e$<span class="string">&#x27;.1f&#x27;</span></span><br><span class="line">e3 := e$<span class="string">&#x27;.2f&#x27;</span></span><br><span class="line">e4 := e$<span class="string">&#x27;.3f&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240606155957701-1717663052102-14.png" alt="image-20240606155957701"></p>
<h4 id="③元组（数组）运行代码"><a href="#③元组（数组）运行代码" class="headerlink" title="③元组（数组）运行代码"></a>③元组（数组）运行代码</h4><p><code>元组（Tuple）</code>是一种基本的数据结构，用于存储和处理一组有序的元素。</p>
<p>元组可以包含不同类型的数据，如整数、实数、字符串等，甚至可以包含其他元组。</p>
<p>元组在 HALCON 中被广泛应用于表示和操作图像处理和计算机视觉中的数据。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">* 元组</span><br><span class="line">Tuple := [<span class="number">1</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</span><br><span class="line">* 根据索引来操作元组</span><br><span class="line">Tuple[<span class="number">0</span>] := <span class="number">2</span></span><br><span class="line">* 批量操作元组的值</span><br><span class="line">Tuple[<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>] := <span class="string">&#x27;abc&#x27;</span></span><br><span class="line"></span><br><span class="line">*批量为元组赋值,自动填充<span class="number">0</span>~<span class="number">100</span>的连续值</span><br><span class="line">tuple2:=[<span class="number">0</span>:<span class="number">100</span>]</span><br><span class="line"></span><br><span class="line">*批量为元组赋值，从<span class="number">0</span>到<span class="number">150</span>的连续值，步长为<span class="number">3</span></span><br><span class="line">tuple3:=[<span class="number">0</span>:<span class="number">3</span>:<span class="number">150</span>]</span><br><span class="line">* 批量为元组赋值，从<span class="number">100</span>~<span class="number">-100</span>的连续值，步长为<span class="number">-10</span></span><br><span class="line">tuple4:=[<span class="number">100</span>:<span class="number">-10</span>:<span class="number">-100</span>]</span><br><span class="line"></span><br><span class="line">*合并（合并在一起并去重 并存入第三个参数中）</span><br><span class="line">tupleInt1:=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">tupleInt2:=[<span class="number">9</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">5</span>]</span><br><span class="line">tuple_union(tupleInt1, tupleInt2, Union)</span><br><span class="line"></span><br><span class="line">*交集（两个元组中一样的元素 并存入第三个参数中）</span><br><span class="line">tupleInt3:=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">tupleInt4:=[<span class="number">9</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">5</span>]</span><br><span class="line">tuple_intersection (tupleInt3, tupleInt4, Intersection)</span><br><span class="line"></span><br><span class="line">* 替换（注意：[<span class="number">0</span>,<span class="number">1</span>]代表的是数组的下标，而不是数组的值）</span><br><span class="line">tupleInt5:=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">tuple_replace (tupleInt5,[<span class="number">0</span>,<span class="number">1</span>],[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>],Replaced)</span><br><span class="line"></span><br><span class="line">* 插入</span><br><span class="line">tupleInt6:=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">tuple_insert(tupleInt6,<span class="number">3</span>,<span class="string">&#x27;x&#x27;</span>,Replaced2)</span><br><span class="line"></span><br><span class="line">* 求绝对值</span><br><span class="line">tuple_abs ([<span class="number">1</span>,<span class="number">-23</span>,<span class="number">-4</span>,<span class="number">-5</span>],Abs)</span><br><span class="line"></span><br><span class="line">* <span class="keyword">const</span>与元组的使用</span><br><span class="line">* 长度为<span class="number">10</span>，元素为<span class="keyword">const</span>类型的新元组</span><br><span class="line">tuple_gen_const(<span class="number">10</span>,<span class="number">2</span>,Newtuple)</span><br><span class="line"></span><br><span class="line">* 链接</span><br><span class="line">a:=[tupleInt1,tupleInt2]</span><br><span class="line">* 获取索引对应的值</span><br><span class="line">b:=a[<span class="number">1</span>]</span><br><span class="line">* 批量获取索引的值</span><br><span class="line">c:=a[<span class="number">1</span>:<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">* 选取数组下标为<span class="number">3</span>的元素</span><br><span class="line">d:=subset(Replaced2,<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">*移除,对应索引的值</span><br><span class="line">e:=<span class="keyword">remove</span>(Replaced2,<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">*产生<span class="number">10</span>个<span class="number">5</span>存入Newtuple中</span><br><span class="line">tuple_gen_const (<span class="number">10</span>,<span class="number">5</span>,Newtuple)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240606155927359-1717663052102-15.png" alt="image-20240606155927359"></p>
<h3 id="三、第一个Halcon程序"><a href="#三、第一个Halcon程序" class="headerlink" title="三、第一个Halcon程序"></a>三、第一个Halcon程序</h3><p>目的：检测红框内的物体中心点</p>
<p>思路：寻找物体的特征 发现物体的<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%81%B0%E5%BA%A6&spm=1001.2101.3001.7020">灰度</a>与周围相比偏高  再用面积筛选出合适大小的连通域  获取该连通域的面积中心  绘制十字星</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240606162844917-1717663052102-16.png" alt="image-20240606162844917"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">*读取图像</span><br><span class="line">read_image (Image, <span class="string">&#x27;fabrik.png&#x27;</span>)</span><br><span class="line"></span><br><span class="line">*获取图像大小</span><br><span class="line">get_image_size (Image, Width, Height)</span><br><span class="line"></span><br><span class="line">*关闭窗口</span><br><span class="line">dev_clear_window()</span><br><span class="line"></span><br><span class="line">*打开窗口</span><br><span class="line">dev_open_window(<span class="number">0</span>, <span class="number">0</span>, Width, Height, <span class="string">&#x27;black&#x27;</span>, WindowHandle)</span><br><span class="line"></span><br><span class="line">*显示图像</span><br><span class="line">dev_display(Image)</span><br><span class="line"></span><br><span class="line">* 限制灰度值范围：<span class="number">128</span>-最小灰度值 <span class="number">255</span>-最大灰度值</span><br><span class="line">threshold (Image, Region, <span class="number">128</span>, <span class="number">255</span>)</span><br><span class="line"></span><br><span class="line">* 连通域搜索：寻找闭合图像</span><br><span class="line">connection (Region, ConnectedRegions)</span><br><span class="line"></span><br><span class="line">* 选择形状： 面积范围： 最小 最大</span><br><span class="line">select_shape (ConnectedRegions, SelectedRegions, <span class="string">&#x27;area&#x27;</span>, <span class="string">&#x27;and&#x27;</span>, <span class="number">8144</span>, <span class="number">8500</span>)</span><br><span class="line"></span><br><span class="line">*获取面积中心</span><br><span class="line">area_center(SelectedRegions, Area, Row, Column)</span><br><span class="line"></span><br><span class="line">*生成十字星</span><br><span class="line">gen_cross_contour_xld (Cross, Row, Column, <span class="number">30</span>, <span class="number">0.0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240606162435298-1717663052102-17.png" alt="image-20240606162435298"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240606163908858.png" alt="image-20240606163908858"></p>
<p><strong>注意：单步调试的时候需要开启和显示 才可以正常覆盖显示十字星</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240606163641049.png" alt="image-20240606163641049"></p>
<h3 id="四、第二个Halcon程序"><a href="#四、第二个Halcon程序" class="headerlink" title="四、第二个Halcon程序"></a>四、第二个Halcon程序</h3><p>目的：识别骰子并给筛子标上不同的颜色</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读一张图片（可以用F1进行帮助文档 或者打开算子窗口）</span></span><br><span class="line"><span class="built_in">read_image</span> (Image, <span class="string">&#x27;dice&#x27;</span>)</span><br><span class="line"><span class="comment">//打开一个窗口 并获得句柄WindowHandle</span></span><br><span class="line"><span class="comment">//其中的参数0,0为坐标值  580和440代表窗口大小  black代表背景颜色</span></span><br><span class="line"><span class="built_in">dev_open_window</span> (<span class="number">0</span>, <span class="number">0</span>, <span class="number">580</span>, <span class="number">440</span>, <span class="string">&#x27;black&#x27;</span>, WindowHandle)</span><br><span class="line"><span class="built_in">dev_display</span> (Image)  <span class="comment">//显示窗口</span></span><br><span class="line"><span class="built_in">stop</span>()</span><br><span class="line">* <span class="comment">// Stop（）函数是暂停程序的执行</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义最高和最低灰度值</span></span><br><span class="line">MinGray := <span class="number">85</span></span><br><span class="line">MaxGray := <span class="number">255</span></span><br><span class="line"><span class="comment">//threshold算子输入的是Image 输出的是Region 条件是最大和最小灰度</span></span><br><span class="line"><span class="built_in">threshold</span> (Image, Region, MinGray, MaxGray)</span><br><span class="line"><span class="built_in">dev_display</span> (Region)</span><br><span class="line"><span class="built_in">stop</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">//connection算子输入的是Region 输出的是ConnectedRegions </span></span><br><span class="line"><span class="comment">//作用是将Region连起来 相当于数组储存到ConnectedRegions</span></span><br><span class="line"><span class="built_in">connection</span> (Region, ConnectedRegions)</span><br><span class="line"><span class="built_in">dev_display</span> (ConnectedRegions)</span><br></pre></td></tr></table></figure>



<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704141209097.png" alt="image-20240704141209097"></p>
<h2 id="2-高斯公式（成像光路）"><a href="#2-高斯公式（成像光路）" class="headerlink" title="2.高斯公式（成像光路）"></a>2.高斯公式（成像光路）</h2><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240510090753975-1717663052102-18.png" alt="image-20240510090753975"></p>
<p><strong>主要是放大率和焦距的计算</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704121003487.png" alt="image-20240704121003487"></p>
<h2 id="3-镜头的选型"><a href="#3-镜头的选型" class="headerlink" title="3.镜头的选型"></a>3.镜头的选型</h2><h3 id="焦距越小-视场角越大-拍摄距离越近"><a href="#焦距越小-视场角越大-拍摄距离越近" class="headerlink" title="焦距越小 视场角越大 拍摄距离越近"></a>焦距越小 视场角越大 拍摄距离越近</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704120929974.png" alt="image-20240704120929974"></p>
<h3 id="相机选型中1英寸-16毫米（mm）"><a href="#相机选型中1英寸-16毫米（mm）" class="headerlink" title="相机选型中1英寸&#x3D;16毫米（mm）"></a>相机选型中1英寸&#x3D;16毫米（mm）</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240510090922912-1717663052102-19.png" alt="image-20240510090922912"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240510092323886-1717663052102-20.png" alt="image-20240510092323886"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240510092425086-1717663052102-21.png" alt="image-20240510092425086"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240510092734634-1717663052102-22.png" alt="image-20240510092734634"></p>
<h3 id="远心镜头"><a href="#远心镜头" class="headerlink" title="远心镜头"></a>远心镜头</h3><p>主要是为了解决被测物体不在同一物面上的情况</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704121320014.png" alt="image-20240704121320014"></p>
<h2 id="4-镜头的MTF曲线"><a href="#4-镜头的MTF曲线" class="headerlink" title="4.镜头的MTF曲线"></a>4.镜头的MTF曲线</h2><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240510091554283-1717663052102-23.png" alt="image-20240510091554283"></p>
<h2 id="5-机器视觉和计算机视觉的区别"><a href="#5-机器视觉和计算机视觉的区别" class="headerlink" title="5.机器视觉和计算机视觉的区别"></a>5.机器视觉和计算机视觉的区别</h2><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704111750500.png" alt="image-20240704111750500"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704111846766.png" alt="image-20240704111846766"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704112852577.png" alt="image-20240704112852577"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704113804093.png" alt="image-20240704113804093"></p>
<h2 id="6-工作原理"><a href="#6-工作原理" class="headerlink" title="6.工作原理"></a>6.工作原理</h2><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704113956372.png" alt="image-20240704113956372"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704114022210.png" alt="image-20240704114022210"></p>
<h2 id="7-光圈"><a href="#7-光圈" class="headerlink" title="7.光圈"></a>7.光圈</h2><p>光圈决定镜头的进光量（进光量越多，画面越亮）</p>
<p>大光圈—-景深较短</p>
<p>小光圈—-景深较长</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704115816759.png" alt="image-20240704115816759"></p>
<h2 id="8-Halcon介绍"><a href="#8-Halcon介绍" class="headerlink" title="8.Halcon介绍"></a>8.Halcon介绍</h2><p><strong>安装路径为C:\Program Files\MVTec\HALCON-12.0</strong></p>
<h3 id="1-算子（Operators）"><a href="#1-算子（Operators）" class="headerlink" title="(1).算子（Operators）"></a>(1).算子（Operators）</h3><p>输入和输出参数严格区分开</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704145650828.png" alt="image-20240704145650828"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">* 开启两个窗口</span><br><span class="line">dev_open_window(0,0,Width, Height, &#x27;black&#x27;, WindowHandle1)</span><br><span class="line">dev_open_window(0,0,Width, Height, &#x27;black&#x27;, WindowHandle2)</span><br><span class="line">* 激活窗口</span><br><span class="line">dev_set_window(WindowHandle2)</span><br><span class="line"></span><br><span class="line">* 显示图片</span><br><span class="line">dev_display(Image)</span><br><span class="line"></span><br><span class="line">*让亮的区域更亮 暗的区域更暗</span><br><span class="line">gray_range_rect(Image : ImageResult : MaskHeight, MaskWidth : )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*求解区域的方向角度</span><br><span class="line">orientation_region(Regions : : : Phi)</span><br><span class="line"></span><br><span class="line">*根据区域Regions创建一个轮廓xld</span><br><span class="line">gen_contour_region_xld(Regions : Contours : Mode : )</span><br><span class="line"></span><br><span class="line">* 将输入的区域Region转换为一个&#x27;byte&#x27;图像，并将区域内的所有像素赋予前景灰度值ForegroundGray</span><br><span class="line">* 如果输入的区域大于生成的图像，则将其裁剪到图像边界。背景设置为BackgroundGray。</span><br><span class="line">region_to_bin(Region, BinImage : ForegroundGray, BackgroundGray, Width, Height : )</span><br><span class="line">    </span><br><span class="line">*计算每个输入轮廓或多边形的平行于坐标轴的包围矩形</span><br><span class="line">*包围矩形由左上角点和右下角点像素的坐标（Row1、Column1、Row2、Column2）描述</span><br><span class="line">*如果传递的轮廓或多边形多于一个，则结果按照与XLD中相应轮廓或多边形相同的顺序存储在元组中</span><br><span class="line">smallest_rectangle1_xld(XLD : : : Row1, Column1, Row2, Column2)</span><br><span class="line"></span><br><span class="line">*计算由轮廓或多边形XLD所围成的区域的面积和重心（质心）和沿边界的点的顺序</span><br><span class="line">*如果轮廓或多边形中的点按逆时针顺序排列（即按照数学上的正方向），则PointOrder将为&#x27;positive&#x27;</span><br><span class="line">area_center_xld(XLD : : : Area, Row, Column, PointOrder)</span><br><span class="line"></span><br><span class="line">*将元组Tuple中的所有元素按升序进行排序，并返回排序后的元组元素相对于输入元组Tuple的索引</span><br><span class="line">*作为前提条件，元组Tuple的单个元素必须是可比较的</span><br><span class="line">tuple_sort_index(Tuple : : : Indices)</span><br><span class="line"></span><br><span class="line">*计算轮廓或多边形XLD的长度</span><br><span class="line">*长度被计算为轮廓或多边形上相邻点之间的欧几里德距离的总和</span><br><span class="line">*如果传递了多个轮廓或多边形，结果按照与XLD中相应轮廓或多边形相同的顺序存储在元组中</span><br><span class="line">length_xld(XLD : : : Length)</span><br><span class="line"></span><br><span class="line">*确定包含轮廓或多边形的最小包围圆，即所有包含轮廓的圆中面积最小的圆</span><br><span class="line">*该函数计算出最小包围圆的中心坐标(Row, Column)和半径(Radius)</span><br><span class="line">smallest_circle_xld(XLD : Row, Column, Radius)</span><br></pre></td></tr></table></figure>



<h3 id="2-HDevelop自带图片素材存储地"><a href="#2-HDevelop自带图片素材存储地" class="headerlink" title="(2).HDevelop自带图片素材存储地"></a>(2).HDevelop自带图片素材存储地</h3><p>C:\Users\Public\Documents\MVTec\HALCON-12.0\examples\images</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704145956479.png" alt="image-20240704145956479"></p>
<h3 id="3-直方图（通过直方图确定灰度范围和面积范围）"><a href="#3-直方图（通过直方图确定灰度范围和面积范围）" class="headerlink" title="(3).直方图（通过直方图确定灰度范围和面积范围）"></a>(3).直方图（通过直方图确定灰度范围和面积范围）</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704152711225.png" alt="image-20240704152711225"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704152728260.png" alt="image-20240704152728260"></p>
<p>在这里打开</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704153136774.png" alt="image-20240704153136774"></p>
<h3 id="4-获取图像"><a href="#4-获取图像" class="headerlink" title="(4).获取图像"></a>(4).获取图像</h3><h4 id="①获取非实时图像"><a href="#①获取非实时图像" class="headerlink" title="①获取非实时图像"></a>①获取非实时图像</h4><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704154946572.png" alt="image-20240704154946572"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704154934659.png" alt="image-20240704154934659"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704155740867.png" alt="image-20240704155740867"></p>
<h4 id="②获取实时图像"><a href="#②获取实时图像" class="headerlink" title="②获取实时图像"></a>②获取实时图像</h4><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704161052574.png" alt="image-20240704161052574"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240704161535280.png"></p>
<p>异步读取:图像从采集设备获取，非实时，取像与处理并行，对图像处理时间把控比较严;</p>
<p>同步读取:通过相机取像，实时，取像与处理是串行的，取像周期长。</p>
<h4 id="③通道"><a href="#③通道" class="headerlink" title="③通道"></a>③通道</h4><p>通道就是代表RBG中的某一个</p>
<p>灰度图片通道为1</p>
<p>彩色图片通道为3</p>
<h4 id="④图片展示设置"><a href="#④图片展示设置" class="headerlink" title="④图片展示设置"></a>④图片展示设置</h4><p>将三幅图片进行平铺展示</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709130659273.png" alt="image-20240709130659273"></p>
<h4 id="⑤图像灰度值"><a href="#⑤图像灰度值" class="headerlink" title="⑤图像灰度值"></a>⑤图像灰度值</h4><p>在灰度图像中，像素的颜色强度是由其对应的灰度级决定的</p>
<p>范围通常从<strong>0（黑色）到255（白色）</strong></p>
<p><strong>亮度越高、颜色越接近白色</strong>的地方，相应的像素值就越<strong>大</strong></p>
<p>而在图像的<strong>深色区域</strong>，像素值则较<strong>小</strong></p>
<p>灰度图像中的<strong>高亮</strong>通常表示<strong>像素值较大</strong>。</p>
<h2 id="9、ROI（对图片感兴趣区域）"><a href="#9、ROI（对图片感兴趣区域）" class="headerlink" title="9、ROI（对图片感兴趣区域）"></a>9、ROI（对图片感兴趣区域）</h2><h3 id="①图形化工具的形式（左键选择-右键结束）"><a href="#①图形化工具的形式（左键选择-右键结束）" class="headerlink" title="①图形化工具的形式（左键选择 右键结束）"></a>①图形化工具的形式（左键选择 右键结束）</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705105109903.png" alt="image-20240705105109903"></p>
<p>可以求多个图形的交并补集 也可以直接插入代码</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705115444789.png" alt="image-20240705115444789"></p>
<h3 id="②代码的形式"><a href="#②代码的形式" class="headerlink" title="②代码的形式"></a>②代码的形式</h3><p>(1)非交互方式</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705105956632.png" alt="image-20240705105956632"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">read_image (image,<span class="string">&#x27;C:/Users/Public/Documents/MVTec/HALCON-12.0/examples/images/claudia.png&#x27;</span>)</span><br><span class="line"></span><br><span class="line">* 生成矩形区域区域为左上(<span class="number">100</span>,<span class="number">100</span>)到右下(<span class="number">300</span>,<span class="number">300</span>)</span><br><span class="line">gen_rectangle1 (Region1,<span class="number">50</span>,<span class="number">100</span>,<span class="number">120</span>,<span class="number">280</span>)</span><br><span class="line"></span><br><span class="line">* 从原始图片中选择出被覆盖的区域</span><br><span class="line">reduce_domain(image,Region1,ImageReduced)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>（2）交互的方式</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705111001641.png" alt="image-20240705111001641"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">read_image (image,<span class="string">&#x27;C:/Users/Public/Documents/MVTec/HALCON-12.0/examples/images/claudia.png&#x27;</span>)</span><br><span class="line"></span><br><span class="line">get_image_size (image,Width,Height)</span><br><span class="line"></span><br><span class="line">* 绘制窗口 并得到窗口句柄(在坐标(<span class="number">0</span>,<span class="number">0</span>)位置处 宽和高为Width,Height)</span><br><span class="line">dev_open_window(<span class="number">0</span>,<span class="number">0</span>,Width, Height, <span class="string">&#x27;black&#x27;</span>, WindowHandle)</span><br><span class="line"></span><br><span class="line">dev_display(image)</span><br><span class="line"></span><br><span class="line">* 产生一个交互式的绘图 左键选择右键结束 输入的是窗口句柄WindowHandle</span><br><span class="line">* 输出的是左上和右下的坐标 Row1, Column1, Row2, <span class="function">Column2</span></span><br><span class="line"><span class="function"><span class="title">draw_rectangle1</span>(<span class="params">WindowHandle, Row1, Column1, Row2, Column2</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">* 绘制窗口 用的是上面所选中的区域(<span class="params">输入是Row1, Column1, Row2, Column2 输出是Rectangle</span>)</span></span><br><span class="line"><span class="function"><span class="title">gen_rectangle1</span> (<span class="params">Rectangle, Row1, Column1, Row2, Column2</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">* 从原始图片中选择出被覆盖的区域(<span class="params">输入是image,Rectangle 输出是ImageReduced</span>)</span></span><br><span class="line"><span class="function"><span class="title">reduce_domain</span>(<span class="params">image,Rectangle,ImageReduced</span>)</span></span><br><span class="line"><span class="function">    </span></span><br></pre></td></tr></table></figure>

<p>绘制多边形的时候比较特殊（不需要连接到首 会自动首尾相连）（绘制完多边形 需要进行填充）</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">read_image (image,<span class="string">&#x27;C:/Users/Public/Documents/MVTec/HALCON-12.0/examples/images/claudia.png&#x27;</span>)</span><br><span class="line"></span><br><span class="line">get_image_size (image,Width,Height)</span><br><span class="line"></span><br><span class="line">* 绘制窗口 并得到窗口句柄(在坐标(<span class="number">0</span>,<span class="number">0</span>)位置处 宽和高为Width,Height)</span><br><span class="line">dev_open_window(<span class="number">0</span>,<span class="number">0</span>,Width, Height, <span class="string">&#x27;black&#x27;</span>, WindowHandle)</span><br><span class="line"></span><br><span class="line">dev_display(image)</span><br><span class="line"></span><br><span class="line">* 绘制多边形</span><br><span class="line">draw_polygon (PolygonRegion, WindowHandle)</span><br><span class="line"></span><br><span class="line">* 对多边形进行填充(保证任意两点相连都在区域内部)</span><br><span class="line">shape_trans(PolygonRegion, RegionTrans, <span class="string">&#x27;convex&#x27;</span>)</span><br><span class="line"></span><br><span class="line">* 从原始图片中选择出被覆盖的区域</span><br><span class="line">reduce_domain(image, RegionTrans, ImageReduced1)</span><br></pre></td></tr></table></figure>



<h2 id="10、图像的变换和校正"><a href="#10、图像的变换和校正" class="headerlink" title="10、图像的变换和校正"></a>10、图像的变换和校正</h2><h3 id="Halcon的坐标轴为"><a href="#Halcon的坐标轴为" class="headerlink" title="Halcon的坐标轴为"></a>Halcon的坐标轴为</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705121449489.png" alt="image-20240705121449489"></p>
<h3 id="①图形的平移—齐次坐标（竖着的x，y，m-其中m一般为1）"><a href="#①图形的平移—齐次坐标（竖着的x，y，m-其中m一般为1）" class="headerlink" title="①图形的平移—齐次坐标（竖着的x，y，m 其中m一般为1）"></a>①图形的平移—齐次坐标（竖着的x，y，m 其中m一般为1）</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705120001705.png" alt="image-20240705120001705"></p>
<h3 id="②图形的旋转"><a href="#②图形的旋转" class="headerlink" title="②图形的旋转"></a>②图形的旋转</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705120308616.png" alt="image-20240705120308616"></p>
<h3 id="③图形的缩放"><a href="#③图形的缩放" class="headerlink" title="③图形的缩放"></a>③图形的缩放</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705120411113.png" alt="image-20240705120411113"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705120417799.png" alt="image-20240705120417799"></p>
<h3 id="④相似变换"><a href="#④相似变换" class="headerlink" title="④相似变换"></a>④相似变换</h3><p>由一个平面&#x2F;立体图形变换到另一个平面&#x2F;立体图形，在改变的过程中保持形状不变（大小方向和位置可变)，任何相似变换都可以分解为等比例缩放、平移、旋转的组合相似变换</p>
<h3 id="⑤仿射变换"><a href="#⑤仿射变换" class="headerlink" title="⑤仿射变换"></a>⑤仿射变换</h3><p>由一个平面&#x2F;立体图形变换到另一个平面&#x2F;立体图形，在改变的过程中保持直线和平行线不变(平行线映射为平行线），任何仿射变换都可以分解为缩放、平移、旋转和切变(Shearing)的组合</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705123658146.png" alt="image-20240705123658146"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">* 平移</span><br><span class="line">* 输入HomMat2D,Tx,Ty</span><br><span class="line">* 输出<span class="function">HomMat2Dtranslate</span></span><br><span class="line"><span class="function"><span class="title">hom_mat2d_translate</span>(<span class="params">::HomMat2D,Tx,Ty:HomMat2Dtranslate</span>)</span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">* 旋转</span></span><br><span class="line"><span class="function">* 输入HomMat2D,phi,Tx,<span class="title">Ty</span>(<span class="params">phi代表旋转角度</span>)（Tx,Ty代表旋转原点）</span></span><br><span class="line"><span class="function">* 输出HomMat2Droute</span></span><br><span class="line"><span class="function"><span class="title">hom_mat2d_rotate</span>(<span class="params">::HomMat2D,phi,Tx,Ty:HomMat2Drotate</span>)</span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">* 缩放</span></span><br><span class="line"><span class="function">* 输入HomMat2D,Sx,Sy,Px,Py（Sx,Sy是缩放系数）（Px,Py是变换不动点）</span></span><br><span class="line"><span class="function">* 输出HomMat2Dscale</span></span><br><span class="line"><span class="function"><span class="title">hom_mat2d_scale</span>(<span class="params">::HomMat2D,Sx,Sy,Px,Py:HomMat2Dscale</span>)</span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">* 仿射变换</span></span><br><span class="line"><span class="function">(<span class="params"><span class="number">1</span></span>)创建一个仿射变换单位矩阵</span></span><br><span class="line"><span class="function"><span class="title">hom_mat2d_identity</span>(<span class="params">:::HomeMat2dIdentity</span>)</span></span><br><span class="line"><span class="function">(<span class="params"><span class="number">2</span></span>)设置可变换的参数 可以设置平移、缩放以及旋转的参数</span></span><br><span class="line"><span class="function">(<span class="params"><span class="number">3</span></span>)进行仿射变换 输入Image 得到仿射变换后端图ImageAffinTrans</span></span><br><span class="line"><span class="function"><span class="title">affine_trans_image</span> (<span class="params">Image:ImageAffinTrans:HomMat2D,Interpolation,AdaptImageSize:</span>)</span></span><br></pre></td></tr></table></figure>

<h3 id="⑥投影变换"><a href="#⑥投影变换" class="headerlink" title="⑥投影变换"></a>⑥投影变换</h3><p>变换过程中，直线映射为直线(但不一定保证平行度)，任何二维投影变换都可以用3x3可逆矩阵表示，而任何三维投影变换都可以用4x4可逆矩阵表示</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705134014758.png" alt="image-20240705134014758"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705134626157.png" alt="image-20240705134626157"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 通过P和Q两组点确定投影变换的矩阵</span><br><span class="line">* 通过P和Q两个点确定齐次变换的矩阵（至少需要4对）</span><br><span class="line">* method是就是进行归异化处理的方法</span><br><span class="line">hom_vector_to_proj_hom_mat2d(::Px,Py,Pw,Qx,Qy,Qw,Method:HomMat2D)</span><br><span class="line"></span><br><span class="line">* 进行投影变换</span><br><span class="line">* 输入校正前的图片Image 输出校正完成的图片Image_rectified 变换的矩阵为HomMat2D</span><br><span class="line">projective_trans_image (Image, Image_rectified, HomMat2D, &#x27;bilinear&#x27;, &#x27;false&#x27;, &#x27;false&#x27;)</span><br></pre></td></tr></table></figure>

<p>具体可以参考–<strong>二维码的简单校验.hdev</strong></p>
<h2 id="11、常见的插值算法"><a href="#11、常见的插值算法" class="headerlink" title="11、常见的插值算法"></a>11、常见的插值算法</h2><p>**插值:**利用已知数据去预测未知数据</p>
<p><strong>图像插值</strong>:给定一个像素点，根据它周围像素点的信息来对该像素点的值进行预测。</p>
<h3 id="①自适应插值"><a href="#①自适应插值" class="headerlink" title="①自适应插值"></a>①自适应插值</h3><p>根据插值的不同像素点内容进行改变（尖锐的边缘或者是平滑的纹理）</p>
<h3 id="②非自适应插值"><a href="#②非自适应插值" class="headerlink" title="②非自适应插值"></a>②非自适应插值</h3><p>对每个像素点的处理都是同样的</p>
<p>（1）最近邻插值：选取离目标点最近的点的灰度值作为新的插入点的灰度值</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705143048523.png" alt="image-20240705143048523"></p>
<p>（2）线性插值</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705143310415.png" alt="image-20240705143310415"></p>
<p>（3）双线性插值</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705143402534.png" alt="image-20240705143402534"></p>
<p>（4）双三次插值</p>
<p>在双三次插值法中，选取最近的16个像素点计算目标图像处像素值</p>
<h2 id="12、图像增强"><a href="#12、图像增强" class="headerlink" title="12、图像增强"></a>12、图像增强</h2><p>图像增强是有目的地强调<strong>图像的整体或局部特性</strong>，将原来不清晰的图像变得清晰或强调某些感兴趣的特征，扩大图像中不同物体特征之间的差别，抑制不感兴趣的特征，改善图像质量，丰富信息量，加强图像判读和识别效果，满足某些特殊分析的需要</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705144428687.png" alt="image-20240705144428687"></p>
<h3 id="①图像取反算子"><a href="#①图像取反算子" class="headerlink" title="①图像取反算子"></a>①图像取反算子</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* 取反算子 将亮变暗 暗变亮</span><br><span class="line">invert_image(Image:ImageInvert::)</span><br></pre></td></tr></table></figure>

<h3 id="②增加图像对比度算子"><a href="#②增加图像对比度算子" class="headerlink" title="②增加图像对比度算子"></a>②增加图像对比度算子</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emphasize(Image:ImageEmphasize:MaskWidth,MaskHeight,Factor:)</span><br></pre></td></tr></table></figure>

<h3 id="③缩放图像的灰度"><a href="#③缩放图像的灰度" class="headerlink" title="③缩放图像的灰度"></a>③缩放图像的灰度</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705145343004.png" alt="image-20240705145343004"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scale_image(Image:ImageScaled:Mult,Add:)</span><br></pre></td></tr></table></figure>

<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705145359058.png" alt="image-20240705145359058"></p>
<h2 id="13、直方图修正法"><a href="#13、直方图修正法" class="headerlink" title="13、直方图修正法"></a>13、直方图修正法</h2><h3 id="①直方图均衡化"><a href="#①直方图均衡化" class="headerlink" title="①直方图均衡化"></a>①直方图均衡化</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705150221291.png" alt="image-20240705150221291"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">equ_histo_image(GrayImage,ImageEquHisto)</span><br></pre></td></tr></table></figure>

<h3 id="②直方图规定化"><a href="#②直方图规定化" class="headerlink" title="②直方图规定化"></a>②直方图规定化</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705150313698.png" alt="image-20240705150313698"></p>
<h2 id="14、图像的平滑"><a href="#14、图像的平滑" class="headerlink" title="14、图像的平滑"></a>14、图像的平滑</h2><h3 id="①噪声"><a href="#①噪声" class="headerlink" title="①噪声"></a>①噪声</h3><h4 id="（1）高斯噪声"><a href="#（1）高斯噪声" class="headerlink" title="（1）高斯噪声"></a>（1）高斯噪声</h4><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705150515895.png" alt="image-20240705150515895"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 生成高斯噪声</span><br><span class="line">gauss_distribution(20,Distribution)</span><br><span class="line">*将灰度图片GrayImage 进行添加噪声处理 得到 ImageNoise</span><br><span class="line">add_noise_distribution(GrayImage,ImageNoise,Distribution)</span><br></pre></td></tr></table></figure>

<h4 id="（2）椒盐噪声"><a href="#（2）椒盐噪声" class="headerlink" title="（2）椒盐噪声"></a>（2）椒盐噪声</h4><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705150720983.png" alt="image-20240705150720983"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 生成椒盐噪声</span><br><span class="line">sp_distribution(3,3,Distribution)</span><br><span class="line">*将灰度图片GrayImage 进行添加噪声处理 得到 ImageNoise</span><br><span class="line">add_noise_distribution(GrayImage,ImageNoise,Distribution)</span><br></pre></td></tr></table></figure>

<h3 id="②滤波"><a href="#②滤波" class="headerlink" title="②滤波"></a>②滤波</h3><h4 id="（1）均值滤波–适合处理高斯噪声"><a href="#（1）均值滤波–适合处理高斯噪声" class="headerlink" title="（1）均值滤波–适合处理高斯噪声"></a>（1）均值滤波–适合处理高斯噪声</h4><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705150855442.png" alt="image-20240705150855442"></p>
<p>图像邻域平均法算法简单，计算速度快</p>
<p>但它的主要缺点是在降低噪声的同时使图像产生模糊，特别在边缘和细节处</p>
<p>图像所用的邻域半径越大，则图像的模糊程度越大</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mean_image(Image:ImageMean:MaskWidth,MaskHeight:)</span><br></pre></td></tr></table></figure>

<h4 id="（2）中值滤波—适合处理椒盐噪声"><a href="#（2）中值滤波—适合处理椒盐噪声" class="headerlink" title="（2）中值滤波—适合处理椒盐噪声"></a>（2）中值滤波—适合处理椒盐噪声</h4><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705151329809.png" alt="image-20240705151329809"></p>
<h2 id="15、图像的锐化–增强图像的边缘或轮廓"><a href="#15、图像的锐化–增强图像的边缘或轮廓" class="headerlink" title="15、图像的锐化–增强图像的边缘或轮廓"></a>15、图像的锐化–增强图像的边缘或轮廓</h2><p>在图像的识别中常需要突出边缘和轮廓信息</p>
<p><strong>图像锐化就是增强图像的边缘或轮廓</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705152150825.png" alt="image-20240705152150825"></p>
<p><strong>横向微分运算</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705152703494.png" alt="image-20240705152703494"></p>
<p><strong>纵向微分运算</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705152719305.png" alt="image-20240705152719305"></p>
<p><strong>双向一次微分运算</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705152738604.png" alt="image-20240705152738604"></p>
<h3 id><a href="#" class="headerlink" title></a></h3><p>Robert存在一定的缺陷 因为图片存在噪声的情况下 会增强大量无用的数据</p>
<h4 id="sobel算子"><a href="#sobel算子" class="headerlink" title="sobel算子"></a>sobel算子</h4><p>sobel算子在一定程度上克服了这个问题（sobel会使边缘锐化更明显）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* sobel算子</span><br><span class="line">*  FilterType代表滤波的类型</span><br><span class="line">sobel_amp(Image:EdgeAmplitude:FilterType,Size:)</span><br></pre></td></tr></table></figure>

<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">*读取图像</span><br><span class="line">read_image (Image, <span class="string">&#x27;C:/Users/ZW/Desktop/机器视觉/资料/B站课程资料/《机器视觉案例》/案例原图/第四章/4-8.png&#x27;</span>)</span><br><span class="line">*边缘检测</span><br><span class="line">sobel_amp (Image, EdgeAmplitude, <span class="string">&#x27;sum_abs&#x27;</span>, <span class="number">3</span>)</span><br><span class="line">*阈值分割</span><br><span class="line">threshold (EdgeAmplitude, Region, <span class="number">10</span>, <span class="number">255</span>)</span><br><span class="line">*提取边缘框架 将图片边缘进行细化</span><br><span class="line">skeleton (Region, Skeleton)</span><br><span class="line">*显示图片</span><br><span class="line">dev_display (Image)</span><br><span class="line">*设置输出颜色为红色</span><br><span class="line">dev_set_color (<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">*显示边缘框架</span><br><span class="line">dev_display (Skeleton)</span><br></pre></td></tr></table></figure>

<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705153911910.png" alt="image-20240705153911910"></p>
<h4 id="基于二阶微分的图像增强–拉普拉斯算子"><a href="#基于二阶微分的图像增强–拉普拉斯算子" class="headerlink" title="基于二阶微分的图像增强–拉普拉斯算子"></a>基于二阶微分的图像增强–拉普拉斯算子</h4><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705154214870.png" alt="image-20240705154214870"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 拉普拉斯算子</span><br><span class="line">laplace(Image:ImageLaplace:ResultType,MaskSize,FileterMask:)</span><br><span class="line"></span><br><span class="line">*找出过零点的像素点</span><br><span class="line">zero_crossing(Image:RegionCrossing::)</span><br></pre></td></tr></table></figure>

<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">*关闭窗口</span><br><span class="line">dev_close_window ()</span><br><span class="line">*获取图像</span><br><span class="line">read_image (Image, <span class="string">&#x27;C:/Users/ZW/Desktop/机器视觉/资料/B站课程资料/《机器视觉案例》/案例原图/第四章/4-9.png&#x27;</span>)</span><br><span class="line">*获取图像尺寸</span><br><span class="line">get_image_size (Image, Width, Height)</span><br><span class="line">*打开适应图片大小的窗口</span><br><span class="line">dev_open_window (<span class="number">0</span>, <span class="number">0</span>, Width, Height, <span class="string">&#x27;black&#x27;</span>, WindowHandle)</span><br><span class="line">*显示图片</span><br><span class="line">dev_display (Image)</span><br><span class="line">*对图像进行拉普拉斯算子处理 signed代表有符号 <span class="number">3</span>代表<span class="function">MaskSize</span></span><br><span class="line"><span class="function"><span class="title">laplace</span> (<span class="params">Image, ImageLaplace, <span class="string">&#x27;signed&#x27;</span>, <span class="number">3</span>, <span class="string">&#x27;n_8_isotropic&#x27;</span></span>)</span></span><br><span class="line"><span class="function">*显示处理后的图像</span></span><br><span class="line"><span class="function"><span class="title">dev_display</span> (<span class="params">ImageLaplace</span>)</span></span><br></pre></td></tr></table></figure>





<h2 id="16、频域处理法"><a href="#16、频域处理法" class="headerlink" title="16、频域处理法"></a>16、频域处理法</h2><p>低通滤波器（Low-pass Filter）和高通滤波器（High-pass Filter）是两种常见的频域滤波器，用于图像处理中的频率分析和图像增强。</p>
<ol>
<li><p><strong>低通滤波器（Low-pass Filter）：</strong><br>低通滤波器允许低频信号通过，抑制高频信号。它的作用是平滑图像、去除高频噪声、模糊图像的细节，使图像变得更加平滑。低通滤波器通常用于图像模糊、降噪和图像压缩等应用。</p>
<p>常见的低通滤波器包括：</p>
<ul>
<li>均值滤波器（平均滤波器）：用邻域像素的平均值替代中心像素的值。</li>
<li>高斯滤波器：使用高斯函数作为权重来平滑图像，具有更好的平滑效果和较好的边缘保留性能。</li>
<li>中值滤波器：用邻域像素的中值替代中心像素的值，对于去除椒盐噪声等非常有效。</li>
</ul>
<p>低通滤波器可以通过控制滤波器的大小或频率响应来调整平滑程度。较大的滤波器将导致更强的平滑效果，但可能会损失图像的细节。</p>
</li>
<li><p><strong>高通滤波器（High-pass Filter）：</strong><br>高通滤波器允许高频信号通过，抑制低频信号。它的作用是突出图像中的细节、边缘和纹理，增强图像的锐度和边缘信息。高通滤波器通常用于图像增强、边缘检测和纹理分析等应用。</p>
<p>常见的高通滤波器包括：</p>
<ul>
<li>拉普拉斯滤波器：用于增强图像的高频部分，使边缘更加明显。</li>
<li>Sobel滤波器：用于检测图像中的边缘，通过计算梯度来突出边缘。</li>
<li>Prewitt滤波器：类似于Sobel滤波器，用于检测图像中的边缘。</li>
</ul>
<p>高通滤波器可以通过控制滤波器的大小或频率响应来调整增强效果。较小的滤波器将突出较细的边缘和细节，而较大的滤波器将突出更粗的边缘和纹理。</p>
</li>
</ol>
<p><strong>一幅图像灰度均匀的区域对应低频部分</strong></p>
<p><strong>图像中的噪声、边缘、细节对应高频部分</strong></p>
<p> <strong>比较亮的是低频</strong>    <strong>比较暗的是高频</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705161740305.png" alt="image-20240705161740305"></p>
<p>低通滤波是保留低频 过滤高频</p>
<p>高通滤波是保留高频 过滤低频</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705161340906.png" alt="image-20240705161340906"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240706115211531.png" alt="image-20240706115211531"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*进行快速傅里叶变换</span><br><span class="line">*其中<span class="string">&#x27;to_freq&#x27;</span>代表正向 ‘from_freq’代表反向</span><br><span class="line">*ResultType表示结果类型（傅里叶变换得到的结果有实部和虚部 默认为complex复数形式）</span><br><span class="line">fft_generic(Image:ImageFFT:<span class="string">&#x27;to_freq&#x27;</span>,Exponent,Norm,Mode,ResultType:)</span><br></pre></td></tr></table></figure>

<h3 id="①低通滤波器"><a href="#①低通滤波器" class="headerlink" title="①低通滤波器"></a>①低通滤波器</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">*读取带有椒盐噪声图像</span><br><span class="line">read_image (Image, <span class="string">&#x27;C:/Users/ZW/Desktop/机器视觉/资料/B站课程资料/《机器视觉案例》/案例原图/第四章/4-10.png&#x27;</span>)</span><br><span class="line">*获得图像尺寸</span><br><span class="line">get_image_size (Image, Width, Height)</span><br><span class="line">*关闭窗口</span><br><span class="line">dev_close_window ()</span><br><span class="line">*打开适应图像大小的窗口</span><br><span class="line">dev_open_window (<span class="number">0</span>, <span class="number">0</span>, <span class="number">512</span>, <span class="number">512</span>, <span class="string">&#x27;black&#x27;</span>, WindowHandle)</span><br><span class="line">*显示图像</span><br><span class="line">dev_display (Image)</span><br><span class="line">*图像转灰度化</span><br><span class="line">rgb1_to_gray (Image, GrayImage)</span><br><span class="line">*获得一个低通滤波模型 超过<span class="number">0.1</span>就去除   </span><br><span class="line">gen_lowpass (ImageLowpass, <span class="number">0.1</span>, <span class="string">&#x27;none&#x27;</span>, <span class="string">&#x27;dc_center&#x27;</span>, Width, Height)</span><br><span class="line">*对噪声图像进行傅里叶变换，得到频率图像</span><br><span class="line">fft_generic (Image, ImageFFT, <span class="string">&#x27;to_freq&#x27;</span>, <span class="number">-1</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;dc_center&#x27;</span>, <span class="string">&#x27;complex&#x27;</span>)</span><br><span class="line">*对频率图像进行低通滤波</span><br><span class="line">convol_fft (ImageFFT, ImageLowpass, ImageConvol)</span><br><span class="line">*对频率图像进行傅里叶变换</span><br><span class="line">fft_generic (ImageConvol, ImageFFT1, <span class="string">&#x27;from_freq&#x27;</span>,<span class="number">1</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;dc_center&#x27;</span>, <span class="string">&#x27;complex&#x27;</span>) </span><br></pre></td></tr></table></figure>

<h3 id="②高通滤波器"><a href="#②高通滤波器" class="headerlink" title="②高通滤波器"></a>②高通滤波器</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">*关闭窗口</span><br><span class="line">dev_close_window ()</span><br><span class="line">*读取图像</span><br><span class="line">read_image (Image, <span class="string">&#x27;C:/Users/ZW/Desktop/机器视觉/资料/B站课程资料/《机器视觉案例》/案例原图/第四章/4-11.png&#x27;</span>)</span><br><span class="line">*图像灰度化</span><br><span class="line">rgb1_to_gray (Image, GrayImage)</span><br><span class="line">*获取图像大小</span><br><span class="line">get_image_size (GrayImage, Width, Height)</span><br><span class="line">*打开图像适应大小窗口</span><br><span class="line">dev_open_window (<span class="number">0</span>, <span class="number">0</span>, Width, Height, <span class="string">&#x27;black&#x27;</span>, WindowHandle)</span><br><span class="line">*得到高通滤波模型</span><br><span class="line">gen_highpass (ImageHighpass, <span class="number">0.1</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;dc_center&#x27;</span>, Width, Height)</span><br><span class="line">*对图像进行傅里叶变换</span><br><span class="line">fft_generic(GrayImage,ImageFFT,<span class="string">&#x27;to_freq&#x27;</span>,<span class="number">-1</span>,<span class="string">&#x27;none&#x27;</span>,<span class="string">&#x27;dc_center&#x27;</span>,<span class="string">&#x27;complex&#x27;</span>)</span><br><span class="line">*对频率图像进行高通滤波</span><br><span class="line">convol_fft(ImageFFT,ImageHighpass,ImageConvol)</span><br><span class="line">*对得到的频率图像进行傅里叶反变换</span><br><span class="line">fft_generic(ImageConvol,ImageResult,<span class="string">&#x27;from_freq&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;none&#x27;</span>,<span class="string">&#x27;dc_center&#x27;</span>,<span class="string">&#x27;byte&#x27;</span>)</span><br><span class="line">*显示图像</span><br><span class="line">dev_display (ImageResult)</span><br></pre></td></tr></table></figure>

<h3 id="③同态滤波增强—解决图像照度不均匀（或者有阴影）"><a href="#③同态滤波增强—解决图像照度不均匀（或者有阴影）" class="headerlink" title="③同态滤波增强—解决图像照度不均匀（或者有阴影）"></a>③同态滤波增强—解决图像照度不均匀（或者有阴影）</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705164044137.png" alt="image-20240705164044137"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705164537471.png" alt="image-20240705164537471"></p>
<h2 id="17、图像分割"><a href="#17、图像分割" class="headerlink" title="17、图像分割"></a>17、图像分割</h2><p><strong>阈值分割</strong>（Threshold Segmentation）：</p>
<ul>
<li>阈值分割是一种简单而常用的分割方法，它基于简单的像素灰度值比较来确定目标和背景之间的阈值。</li>
<li>阈值分割将图像中的像素根据其灰度值与给定阈值的关系分为两个类别：目标和背景。</li>
<li>阈值分割通常使用整数阈值进行像素分类，将低于阈值的像素标记为背景，高于或等于阈值的像素标记为目标。</li>
<li>阈值分割是一种简单快速的分割方法，适用于许多应用场景，但对于复杂的图像或具有多个目标的情况可能效果有限。</li>
</ul>
<p><strong>亚像素阈值分割</strong>（Subpixel Thresholding）：</p>
<ul>
<li>亚像素阈值分割是一种进一步提高分割精度的技术，它允许对像素进行更精细的分类，而不仅仅是简单的目标和背景。</li>
<li>亚像素阈值分割通过使用更高精度的阈值（通常是浮点数）来对像素进行分类，从而实现更精确的分割结果。</li>
<li>亚像素阈值分割可以将像素分类为多个类别，例如目标、背景和边界区域，并且可以提供更准确的边界位置信息。</li>
<li>亚像素阈值分割通常需要更复杂的计算和处理过程，相对于传统的阈值分割方法而言，计算成本更高。</li>
</ul>
<p>阈值分割是一种简单快速的分割方法，适用于许多场景</p>
<p>亚像素阈值分割则是一种<strong>更精确的分割技术</strong>，适用于对分割精度要求更高的任务</p>
<h3 id="①全局阈值分割—根据灰度不同进行分割"><a href="#①全局阈值分割—根据灰度不同进行分割" class="headerlink" title="①全局阈值分割—根据灰度不同进行分割"></a>①全局阈值分割—根据灰度不同进行分割</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240706104513434.png" alt="image-20240706104513434"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240706104601136.png" alt="image-20240706104601136"></p>
<h4 id="（1）基于直方图谷底进行阈值分割"><a href="#（1）基于直方图谷底进行阈值分割" class="headerlink" title="（1）基于直方图谷底进行阈值分割"></a>（1）基于直方图谷底进行阈值分割</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">* 读取图像</span><br><span class="line">read_image (Image, <span class="string">&#x27;C:/Users/ZW/Desktop/机器视觉/资料/B站课程资料/《机器视觉案例》/案例原图/第五章/5-1.png&#x27;</span>)</span><br><span class="line"></span><br><span class="line">*转为单通道的灰度图</span><br><span class="line">*rgb1_to_gray (Image, GrayImage)</span><br><span class="line"></span><br><span class="line">get_image_size (Image, Width, Height)</span><br><span class="line"></span><br><span class="line">dev_close_window ()</span><br><span class="line"></span><br><span class="line">dev_open_window (<span class="number">0</span>, <span class="number">0</span>, Width, Height, <span class="string">&#x27;black&#x27;</span>, WindowHandle)</span><br><span class="line"></span><br><span class="line">*设置显示选中的颜色</span><br><span class="line">dev_set_color (<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line"></span><br><span class="line">*计算图像的灰度直方图  </span><br><span class="line">*得到绝对的AbsoluteHisto和相对的RelativeHisto（除以了灰度的总数值在<span class="number">0</span><span class="number">-1</span>之间）</span><br><span class="line">gray_histo (Image, Image, AbsoluteHisto, RelativeHisto)</span><br><span class="line"></span><br><span class="line">*从直方图中确定灰度值阈值 得到最小灰度值MinThresh和最大灰度值MaxThresh</span><br><span class="line">* 其中的<span class="number">8</span> 代表平滑度</span><br><span class="line">histo_to_thresh (RelativeHisto, <span class="number">8</span>, MinThresh, MaxThresh)</span><br><span class="line"></span><br><span class="line">*设置最多有<span class="number">12</span>种颜色</span><br><span class="line">dev_set_colored (<span class="number">12</span>)</span><br><span class="line"></span><br><span class="line">*进行阈值分割</span><br><span class="line">threshold (Image, Region, MinThresh[<span class="number">0</span>], MaxThresh[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">dev_display (Region)</span><br></pre></td></tr></table></figure>

<h4 id="（2）基于直方图的自动自动阈值分割"><a href="#（2）基于直方图的自动自动阈值分割" class="headerlink" title="（2）基于直方图的自动自动阈值分割"></a>（2）基于直方图的自动自动阈值分割</h4><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240706123906476.png" alt="image-20240706123906476"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">*获取图像</span><br><span class="line">read_image (Image, <span class="string">&#x27;C:/Users/ZW/Desktop/机器视觉/资料/B站课程资料/《机器视觉案例》/案例原图/第五章/5-2.png&#x27;</span>)</span><br><span class="line"></span><br><span class="line">*新开一个窗口</span><br><span class="line">dev_open_window_fit_image (Image, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">-1</span>, WindowHandle)</span><br><span class="line"></span><br><span class="line">dev_display (Image)</span><br><span class="line"></span><br><span class="line">rgb1_to_gray (Image, GrayImage)</span><br><span class="line"></span><br><span class="line">*自动阈值分割 <span class="number">5</span>代表的是平滑度</span><br><span class="line">auto_threshold (Image, Regions, <span class="number">5</span>)</span><br><span class="line">*显示分割区域</span><br><span class="line">dev_display (Regions)</span><br></pre></td></tr></table></figure>

<h3 id="②局部阈值分割"><a href="#②局部阈值分割" class="headerlink" title="②局部阈值分割"></a>②局部阈值分割</h3><p>在动态阈值分割方法中，基于图像和参考图像的像素值之间的差异来进行分割。具体步骤如下：</p>
<ol>
<li>对于原始图像<code>Image</code>和平滑后的图像<code>ImageMean</code>的每个像素位置(i, j)，计算它们的差值：<code>diff = abs(Image[i,j] - ImageMean[i,j])</code>。</li>
<li>根据阈值偏移量，将差值与阈值比较。如果差值大于阈值，将该位置标记为目标区域。</li>
<li>对于所有被标记为目标区域的位置，构建一个连通区域，将相邻的目标像素归为同一区域。</li>
<li>最后，将提取出的圆形区域存储在<code>RegionDynThresh</code>变量中。</li>
</ol>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240706124648875.png" alt="image-20240706124648875"></p>
<p><strong>算子为dyn_threshold</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240706124731427.png" alt="image-20240706124731427"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dyn_threshold(OrigImage,ThresholdImage:RegionDynThresh:Offset,LightDark:)</span><br><span class="line">下面是对该函数的详细解释：</span><br><span class="line">Image: 原始图像，用作分割的输入图像。</span><br><span class="line">ImageMean: 平滑处理后的图像，用来计算动态阈值的参考图像。</span><br><span class="line">RegionDynThresh: 存储分割结果的变量，提取出的圆形区域将存储在该变量中。</span><br><span class="line">15: 阈值偏移量，用于调整动态阈值的灵敏度。增加偏移量将导致更多的区域被认为是目标区域，而减少偏移量则会导致较少的区域被认为是目标区域。</span><br><span class="line">&#x27;not_equal&#x27;: 分割操作符，指定了使用不相等关系进行分割。这意味着对于图像中的每个像素，如果其值与对应位置的均值图像像素值不相等，则被视为目标区域。</span><br></pre></td></tr></table></figure>

<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">*关闭窗口</span><br><span class="line">dev_close_window ()</span><br><span class="line">*获取图像</span><br><span class="line">read_image (Image, <span class="string">&#x27;photometric_stereo/embossed_01&#x27;</span>)</span><br><span class="line">*获得图像尺寸</span><br><span class="line">get_image_size (Image, Width, Height)</span><br><span class="line"></span><br><span class="line">*打开适应图像大小的窗口</span><br><span class="line">dev_open_window (<span class="number">0</span>, <span class="number">0</span>, Width, Height, <span class="string">&#x27;black&#x27;</span>, WindowHandle1)</span><br><span class="line"></span><br><span class="line">*在图像上使用均值滤波器进行适当平滑 </span><br><span class="line">mean_image (Image, ImageMean, <span class="number">59</span>, <span class="number">59</span>)</span><br><span class="line"></span><br><span class="line">*动态阈值分割，提取圆区域 <span class="number">15</span>代表偏移量 </span><br><span class="line">* dark--代表找暗区 亮--代表亮区  equal--代表找既不是暗也不是亮区  now_equal--代表找亮和暗区</span><br><span class="line">dyn_threshold (Image, ImageMean, RegionDynThresh, <span class="number">15</span>, <span class="string">&#x27;not_equal&#x27;</span>)</span><br><span class="line"></span><br><span class="line"> * 显示图像</span><br><span class="line">dev_display (Image)</span><br><span class="line">*显示提取区域</span><br><span class="line">dev_display (RegionDynThresh)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="③边缘检测"><a href="#③边缘检测" class="headerlink" title="③边缘检测"></a>③边缘检测</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240706134335998.png" alt="image-20240706134335998"></p>
<h4 id="（1）prewitt算子"><a href="#（1）prewitt算子" class="headerlink" title="（1）prewitt算子"></a>（1）prewitt算子</h4><p><strong>(相比于sobel算子，抑制噪声的影响的效果更好)</strong></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">*读取图像</span><br><span class="line">read_image (Image, <span class="string">&#x27;fabrik&#x27;</span>)</span><br><span class="line">*用prewitt算子进行边缘提取</span><br><span class="line">prewitt_amp (Image, ImageEdgeAmp)</span><br><span class="line">*进行阈值操作</span><br><span class="line">threshold (ImageEdgeAmp, Region, <span class="number">20</span>, <span class="number">255</span>)</span><br><span class="line">*骨骼化操作</span><br><span class="line">skeleton (Region, Skeleton)</span><br><span class="line">*显示图像</span><br><span class="line">dev_display (Image)</span><br><span class="line">*设置输出颜色为红色</span><br><span class="line">dev_set_color (<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">*显示骨骼图像</span><br><span class="line">dev_display (Skeleton)</span><br></pre></td></tr></table></figure>

<h4 id="（2）kirsch算子"><a href="#（2）kirsch算子" class="headerlink" title="（2）kirsch算子"></a>（2）kirsch算子</h4><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240706135152941.png" alt="image-20240706135152941"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">*读取图像</span><br><span class="line">read_image (Image, <span class="string">&#x27;fabrik&#x27;</span>)</span><br><span class="line">*用kirsch算子进行边缘检测</span><br><span class="line">kirsch_amp (Image, ImageEdgeAmp)</span><br><span class="line">*进行阈值操作</span><br><span class="line">threshold (ImageEdgeAmp, Region, <span class="number">70</span>, <span class="number">255</span>)</span><br><span class="line">*骨骼化操作</span><br><span class="line">skeleton (Region, Skeleton)</span><br><span class="line">*显示图像</span><br><span class="line">dev_display (Image)</span><br><span class="line">*设置输出颜色为红色</span><br><span class="line">dev_set_color (<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">*显示骨骼图像</span><br><span class="line">dev_display (Skeleton)</span><br></pre></td></tr></table></figure>

<h4 id="（3）log算子（laplace-of-gauss）"><a href="#（3）log算子（laplace-of-gauss）" class="headerlink" title="（3）log算子（laplace_of_gauss）"></a>（3）log算子（laplace_of_gauss）</h4><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240706135429139.png" alt="image-20240706135429139"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240706141546230.png" alt="image-20240706141546230"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240706140539333.png" alt="image-20240706140539333"></p>
<h4 id="（4）canny算子"><a href="#（4）canny算子" class="headerlink" title="（4）canny算子"></a>（4）canny算子</h4><p>canny算子和log算子类似 都是<strong>先平滑后求导</strong></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">*获取图像</span><br><span class="line">read_image (Image, <span class="string">&#x27;fabrik&#x27;</span>)</span><br><span class="line">*使用canny算法进行边缘提取</span><br><span class="line">edges_image (Image, ImaAmp, ImaDir, <span class="string">&#x27;canny&#x27;</span>, <span class="number">0.5</span>, <span class="string">&#x27;nms&#x27;</span>, <span class="number">12</span>, <span class="number">22</span>)</span><br><span class="line">*阈值分割</span><br><span class="line">threshold (ImaAmp, Edges, <span class="number">1</span>, <span class="number">255</span>)</span><br><span class="line">*骨骼化</span><br><span class="line">skeleton (Edges, Skeleton)</span><br><span class="line">*将骨骼化的区域转化为XLD (轮廓)</span><br><span class="line">gen_contours_skeleton_xld (Skeleton, Contours, <span class="number">1</span>, <span class="string">&#x27;filter&#x27;</span>)</span><br><span class="line">*显示图像</span><br><span class="line">dev_display (Image)</span><br><span class="line">*设置<span class="number">6</span>种输出颜色</span><br><span class="line">dev_set_colored (<span class="number">6</span>)</span><br><span class="line">*显示<span class="function">XLD</span></span><br><span class="line"><span class="function"><span class="title">dev_display</span> (<span class="params">Contours</span>)</span></span><br></pre></td></tr></table></figure>

<p><strong>亚像素级别的边缘提取</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240706142804274.png" alt="image-20240706142804274"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 关闭窗口</span><br><span class="line">dev_close_window ()</span><br><span class="line">* 读取图像</span><br><span class="line">read_image (Image, <span class="string">&#x27;fabrik&#x27;</span>)</span><br><span class="line">* 打开适应图像大小的窗口</span><br><span class="line">dev_open_window_fit_image (Image, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">-1</span>, WindowHandle)</span><br><span class="line">* 对图像进行亚像素区域提取</span><br><span class="line">edges_sub_pix (Image, Edges, <span class="string">&#x27;canny&#x27;</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">22</span>)</span><br><span class="line">* 放大图像用于详细的边缘检查</span><br><span class="line">dev_set_part (<span class="number">160</span>, <span class="number">250</span>, <span class="number">210</span>, <span class="number">300</span>)</span><br><span class="line">dev_display (Image)</span><br><span class="line">dev_display (Edges)</span><br></pre></td></tr></table></figure>



<h3 id="④区域分割–将具有相同属性的像素归为同一个区域"><a href="#④区域分割–将具有相同属性的像素归为同一个区域" class="headerlink" title="④区域分割–将具有相同属性的像素归为同一个区域"></a>④区域分割–将具有相同属性的像素归为同一个区域</h3><h4 id="（1）区域生长"><a href="#（1）区域生长" class="headerlink" title="（1）区域生长"></a>（1）区域生长</h4><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240706143522490.png" alt="image-20240706143522490"></p>
<p><strong>halcon的生长算子</strong></p>
<p>  <code> regiongrowing_mean</code> 中指明了起始的生长坐标</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240706144147387.png" alt="image-20240706144147387"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240706145318441.png" alt="image-20240706145318441"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">*读取图像</span><br><span class="line">read_image (Image, <span class="string">&#x27;fabrik&#x27;</span>)</span><br><span class="line">*对图像进行均值处理，选用circle类型的中值滤波器 对图片进行去噪操作</span><br><span class="line">median_image (Image, ImageMedian, <span class="string">&#x27;circle&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;mirrored&#x27;</span>)</span><br><span class="line"></span><br><span class="line">*使用regiongrowing算子寻找颜色相近的邻域 输入ImageMedian 得到生长后的区域Regions</span><br><span class="line">*对图片进行区域生长 <span class="number">1</span>（ROW）和<span class="number">1</span>（COL）代表一个点距离下一个点之间的像素差距是多少</span><br><span class="line">*<span class="number">2</span>代表的是灰度值的差值 <span class="number">5000</span>代表的是输出区域的每个区域至少是<span class="number">5000</span></span><br><span class="line">regiongrowing (ImageMedian, Regions, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">5000</span>)</span><br><span class="line"></span><br><span class="line">*对图像进行区域分割，提取满足各个条件的各个独立区域</span><br><span class="line">*找到每一个分割好的区域的中心 存入到<span class="function">Centers</span></span><br><span class="line"><span class="function"><span class="title">shape_trans</span> (<span class="params">Regions, Centers, <span class="string">&#x27;inner_center&#x27;</span></span>)</span></span><br><span class="line"><span class="function">*将每个中心依次存入到SingleCenters</span></span><br><span class="line"><span class="function"><span class="title">connection</span> (<span class="params">Centers, SingleCenters</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">*计算出初步提取的区域的中心点坐标</span></span><br><span class="line"><span class="function"><span class="title">area_center</span> (<span class="params">SingleCenters, Area, Row, Column</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">*以均值灰度图像为输入，进行区域增长计算，计算的起始坐标为上一步的各区域中心</span></span><br><span class="line"><span class="function">*种子点为刚刚所获得的每个区域中心点坐标</span></span><br><span class="line"><span class="function"><span class="title">regiongrowing_mean</span> (<span class="params">ImageMedian, RegionsMean, Row, Column, <span class="number">25</span>, <span class="number">100</span></span>)</span></span><br></pre></td></tr></table></figure>

<h4 id="（2）区域分裂合并法"><a href="#（2）区域分裂合并法" class="headerlink" title="（2）区域分裂合并法"></a>（2）区域分裂合并法</h4><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240706151844833.png" alt="image-20240706151844833"></p>
<h4 id="（3）Hough变换–检测线"><a href="#（3）Hough变换–检测线" class="headerlink" title="（3）Hough变换–检测线"></a>（3）Hough变换–检测线</h4><p><strong>将间断的边缘链接成有意义的完整边缘，同时去除假边缘</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240706153153851.png" alt="image-20240706153153851"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">*读取图像 </span><br><span class="line">read_image (Image, <span class="string">&#x27;fabrik&#x27;</span>)</span><br><span class="line">*获得目标区域图像</span><br><span class="line">rectangle1_domain (Image, ImageReduced, <span class="number">170</span>, <span class="number">280</span>, <span class="number">310</span>, <span class="number">360</span>)</span><br><span class="line">* 用Sobel边缘检测算子提取边缘</span><br><span class="line">sobel_dir (ImageReduced, EdgeAmplitude, EdgeDirection, <span class="string">&#x27;sum_abs&#x27;</span>, <span class="number">3</span>)</span><br><span class="line">*设置输出颜色为红色</span><br><span class="line">dev_set_color (<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">*阈值分割得到图像</span><br><span class="line">threshold (EdgeAmplitude, Region, <span class="number">55</span>, <span class="number">255</span>)</span><br><span class="line">* 截取刚刚用阈值分割所覆盖的图像</span><br><span class="line">reduce_domain (EdgeDirection, Region, EdgeDirectionReduced)</span><br><span class="line"></span><br><span class="line">* 进行Hough变换</span><br><span class="line">*输入的是边缘检测得到的方向图（EdgeDirection）</span><br><span class="line">*输出的是hough变换的映射图和检测的Lines图</span><br><span class="line">*<span class="number">4</span>代表的是方向的不确定度（即可以容忍的角度偏差度为多少）</span><br><span class="line">*<span class="number">2</span>代表的是角度的分辨率</span><br><span class="line">*’mean’代表的是平滑处理（为了去除噪点） <span class="number">3</span>代表做平滑处理的模板大小</span><br><span class="line">*<span class="number">25</span>代表投票数需要达到<span class="number">25</span>才有效</span><br><span class="line">*前一个<span class="number">5</span>约束角度 后一个<span class="number">5</span>约束距离</span><br><span class="line">*‘<span class="literal">true</span>’代表是否产生Line Region</span><br><span class="line">*输出Angle（角度）和Dist（距离）</span><br><span class="line">hough_lines_dir (EdgeDirectionReduced, HoughImage, Lines, <span class="number">4</span>, <span class="number">2</span>, <span class="string">&#x27;mean&#x27;</span>, <span class="number">3</span>, <span class="number">25</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="string">&#x27;true&#x27;</span>, Angle, Dist)</span><br><span class="line"></span><br><span class="line">*将霍夫变换提取直线以普通形式描述的输入行存储为区域</span><br><span class="line">gen_region_hline (LinesHNF, Angle, Dist)</span><br><span class="line">*显示图像</span><br><span class="line">dev_display (Image)</span><br><span class="line">*设置输出颜色数目</span><br><span class="line">dev_set_colored (<span class="number">12</span>)</span><br><span class="line">*设置输出填充方式为“轮廓”</span><br><span class="line">dev_set_draw (<span class="string">&#x27;margin&#x27;</span>)</span><br><span class="line">*显示<span class="function">LinesHNF</span></span><br><span class="line"><span class="function"><span class="title">dev_display</span> (<span class="params">LinesHNF</span>) </span></span><br><span class="line"><span class="function">*设置输出填充方式为“填充”</span></span><br><span class="line"><span class="function"><span class="title">dev_set_draw</span> (<span class="params"><span class="string">&#x27;fill&#x27;</span></span>)</span></span><br><span class="line"><span class="function">*显示Lines</span></span><br><span class="line"><span class="function"><span class="title">dev_display</span> (<span class="params">Lines</span>)</span></span><br></pre></td></tr></table></figure>

<h4 id="（4）Hough变换—检测圆"><a href="#（4）Hough变换—检测圆" class="headerlink" title="（4）Hough变换—检测圆"></a>（4）Hough变换—检测圆</h4><p><strong>Halcon算子</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240706164826333.png" alt="image-20240706164826333"></p>
<p>其中Percent代表圆占整个图片的百分比</p>
<p>Mode代表确定圆位置的模式（用外圈还是内圈）</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240706164838335.png" alt="image-20240706164838335"></p>
<h3 id="⑤分水岭算法—基于边缘的图像分割"><a href="#⑤分水岭算法—基于边缘的图像分割" class="headerlink" title="⑤分水岭算法—基于边缘的图像分割"></a>⑤分水岭算法—基于边缘的图像分割</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240707104706403.png" alt="image-20240707104706403"></p>
<p>为了解决过度分割的问题，可以使用基于标记(mark)图像的分水岭算法，就是通过先验知识，来指导分水岭算法，以便获得更好的图像分段效果。</p>
<p>在这个区域的洪水淹没过程中，水平面都是从定义的高度开始的,这样可以避免一些很小的噪声极值区域的分割。</p>
<p>这个就是<strong>阈值化的提取</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240707105404681.png" alt="image-20240707105404681"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">*获取图像</span><br><span class="line">read_image (Br2, <span class="string">&#x27;particle&#x27;</span>)</span><br><span class="line"></span><br><span class="line">*对单通道图像进行高斯平滑处理，去除噪声</span><br><span class="line">gauss_filter (Br2, ImageGauss, <span class="number">9</span>)</span><br><span class="line"></span><br><span class="line">*将图像颜色进行反转</span><br><span class="line">invert_image (ImageGauss, ImageInvert)</span><br><span class="line"></span><br><span class="line">*对高斯平滑后的图像进行分数岭处理，提取出盆地区域</span><br><span class="line">*输入图像 输出分水岭和盆地</span><br><span class="line">watersheds (ImageInvert, Basins, Watersheds)</span><br><span class="line"></span><br><span class="line">*对图像进行带阈值的分水岭处理 阈值为<span class="number">30</span></span><br><span class="line">*输入图像和阈值 输出分水岭</span><br><span class="line">watersheds_threshold (ImageInvert, Basins1,<span class="number">30</span>)</span><br></pre></td></tr></table></figure>



<h2 id="18、特征提取"><a href="#18、特征提取" class="headerlink" title="18、特征提取"></a>18、特征提取</h2><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240707122525680.png" alt="image-20240707122525680"></p>
<h3 id="①特征的分类"><a href="#①特征的分类" class="headerlink" title="①特征的分类"></a>①特征的分类</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240707122833229.png" alt="image-20240707122833229"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240707123031891.png" alt="image-20240707123031891"></p>
<h3 id="②区域形状特征"><a href="#②区域形状特征" class="headerlink" title="②区域形状特征"></a>②区域形状特征</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240707123429651.png" alt="image-20240707123429651"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">*获得Regions区域的每个对象面积，中心点Row，Col信息</span><br><span class="line">area_center(Regions:::Area,Row,Column)</span><br><span class="line"></span><br><span class="line">*获得封闭区域孔洞的面积 一个区域包含多个孔洞 所以返回的是所有孔洞的面积之和</span><br><span class="line">area_holes(Regions:::Area)</span><br><span class="line"></span><br><span class="line">*根据特征提取出符合条件的区域</span><br><span class="line">select_shape(Regions:SelectedRegions:Features,Operation,Min,Max:)</span><br><span class="line"></span><br><span class="line">*计算每个区域的内接圆</span><br><span class="line">inner_circle(Regions:::Row,Column,Radius)</span><br><span class="line"></span><br><span class="line">*计算区域外接矩形</span><br><span class="line">*第一种是是平行的矩形 得到左上角点和右下角点</span><br><span class="line">smallest_rectangle1(Regions:::Row1,Column1,Row2,Column2)</span><br><span class="line">*第二种是可以旋转的矩形 得到固定点、旋转角度、半宽、半高</span><br><span class="line">smallest_rectangle1(Regions:::Row,Column,Phi,Length1,Length2)</span><br></pre></td></tr></table></figure>

<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240707130336770.png" alt="image-20240707130336770"></p>
<p><strong>选择 面积在500-2000之间 而且 区域宽和高的比值在1-1.7</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240707131135279.png" alt="image-20240707131135279"></p>
<h3 id="③基于灰度值的特征"><a href="#③基于灰度值的特征" class="headerlink" title="③基于灰度值的特征"></a>③基于灰度值的特征</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240707140247631.png" alt="image-20240707140247631"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">*用于计算指定区域的灰度值特征值</span><br><span class="line">gray_features(Regions,Image::Features:Value)</span><br><span class="line"></span><br><span class="line">*计算区域的灰度值平均值和方差</span><br><span class="line">intensity(Regions,Image:::Mean,Deviation)</span><br><span class="line"></span><br><span class="line">*计算区域的最大最小灰度值 Percent代表向内收缩的比例 因为希望去除噪声的影响 </span><br><span class="line">min_max_gray(Regions,Image::Percent:Min,Max,Range)</span><br><span class="line"></span><br><span class="line">*提取灰度区域的面积和中心(每个点的灰度值求和 其实是重心的坐标)</span><br><span class="line">area_center_gray(Regions,Image:::Area,Row,Column)</span><br><span class="line"></span><br><span class="line">*根据灰度特征值选择区域</span><br><span class="line">select_gray(Regions,Image:SelectedRegions:Features,Operation,Min,Max:)</span><br></pre></td></tr></table></figure>



<h3 id="④基于图像纹理的特征"><a href="#④基于图像纹理的特征" class="headerlink" title="④基于图像纹理的特征"></a>④基于图像纹理的特征</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240707144646146.png" alt="image-20240707144646146"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240707144819692.png" alt="image-20240707144819692"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240707151201916.png" alt="image-20240707151201916"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">*创建图像中某个区域的共生矩阵 ldGray代表灰度级 Direction代表方向（0,45,90,135）</span><br><span class="line">gen_cooc_matrix(Regions,Image:Matrix:LdGray,Direction:)</span><br><span class="line"></span><br><span class="line">*基于灰度共生矩阵计算特征值 </span><br><span class="line">* 输入灰度共生矩阵 输出 能量 相关性 局部均匀性 对比度</span><br><span class="line">cooc_feature_matrix(CoocMatrix:::Energy,Correlation,Homogeneity,Contrast)</span><br><span class="line"></span><br><span class="line">*二合一算子</span><br><span class="line">*计算共生矩阵 并且 导出灰度值特征</span><br><span class="line">cocc_feature_image(Regions,Image::LdGray,Direction:Energy,Correlation,Homogeneity,Contrast)</span><br></pre></td></tr></table></figure>





<h2 id="19、二值图像的形态学处理"><a href="#19、二值图像的形态学处理" class="headerlink" title="19、二值图像的形态学处理"></a>19、二值图像的形态学处理</h2><h3 id="①反射的概念"><a href="#①反射的概念" class="headerlink" title="①反射的概念"></a>①反射的概念</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709110345302.png" alt="image-20240709110345302"></p>
<h3 id="②腐蚀"><a href="#②腐蚀" class="headerlink" title="②腐蚀"></a>②腐蚀</h3><p>注意：</p>
<p>使用结构元素腐蚀完后 所有的中心点就构成了一个新图形（所以腐蚀区域与结构元素的大小有关）<img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709110812775.png" alt="image-20240709110812775"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">*使用圆形结构元素对区域进行腐蚀</span><br><span class="line">erosion_circle(Region:RegionErosion:Radius:)</span><br><span class="line"></span><br><span class="line">*使用矩形结构元素对区域进行腐蚀</span><br><span class="line">erosion_rectangle1(Region:RegionErosion:Width,Hright:)</span><br><span class="line"></span><br><span class="line">*使用生成的结构元素对区域进行腐蚀（参考点为结构元素的中心）</span><br><span class="line">*Iterations是迭代次数的含义 代表要腐蚀多少次</span><br><span class="line">erosion1(Region,StructElement:RegionErosion:Iterations:)</span><br><span class="line"></span><br><span class="line">*使用生成的结构元素对区域进行腐蚀（可以手动设置参考点的位置）</span><br><span class="line">erosion1(Region,StructElement:RegionErosion:Row,Column,Iterations:)</span><br></pre></td></tr></table></figure>

<h3 id="③膨胀"><a href="#③膨胀" class="headerlink" title="③膨胀"></a>③膨胀</h3><p>只要结构元素与被腐蚀图像存在交集即可</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709114534789.png" alt="image-20240709114534789"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">*使用圆形结构元素对区域进行膨胀</span><br><span class="line">dilation_circle(Region:RegionDilation:Radius:)</span><br><span class="line"></span><br><span class="line">*使用矩形结构元素对区域进行膨胀</span><br><span class="line">dilation_rectangle1(Region:RegionDilation:Width,Height:)</span><br><span class="line"></span><br><span class="line">*使用生成结构元素对区域进行膨胀（参考点为结构元素的中心）</span><br><span class="line">dilation1(Region,StructElement:RegionDilation:Iterations:)</span><br><span class="line"></span><br><span class="line">*使用生成结构元素对区域进行膨胀（参考点可以自行设置）</span><br><span class="line">dilation2(Region,StructElement:RegionDilation:Row,Column,Iterations:)</span><br></pre></td></tr></table></figure>

<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709115957881.png" alt="image-20240709115957881"></p>
<h3 id="④开闭运算"><a href="#④开闭运算" class="headerlink" title="④开闭运算"></a>④开闭运算</h3><h4 id="开运算—先腐蚀后膨胀—去毛刺杂质"><a href="#开运算—先腐蚀后膨胀—去毛刺杂质" class="headerlink" title="开运算—先腐蚀后膨胀—去毛刺杂质"></a>开运算—先腐蚀后膨胀—去毛刺杂质</h4><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709120218367.png" alt="image-20240709120218367"></p>
<h4 id="闭运算—先膨胀，后腐蚀—填空隙"><a href="#闭运算—先膨胀，后腐蚀—填空隙" class="headerlink" title="闭运算—先膨胀，后腐蚀—填空隙"></a>闭运算—先膨胀，后腐蚀—填空隙</h4><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709120426093.png" alt="image-20240709120426093"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*使用生成结构元素对区域进行开运算</span><br><span class="line">opening(Region,StructElement:RegionOpening::)</span><br><span class="line"></span><br><span class="line">*使用圆形结构元素对区域进行开运算</span><br><span class="line">opening_circle(Region:RegionOpening:Radius:)</span><br><span class="line"></span><br><span class="line">*使用矩形结构元素对区域进行开运算</span><br><span class="line">opening_rectangle1(Region:RegionOpening:Width,Height:)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*使用生成结构元素对区域进行闭运算</span><br><span class="line">closing(Region,StructElement:RegionClosing::)</span><br><span class="line"></span><br><span class="line">*使用圆形结构元素对区域进行闭运算</span><br><span class="line">closing_circle(Region:RegionClosing:Radius:)</span><br><span class="line"></span><br><span class="line">*使用矩形结构元素对区域进行闭运算</span><br><span class="line">closing_rectangle1(Region:RegionClosing:Width,Height:)</span><br></pre></td></tr></table></figure>

<h3 id="⑤击中和击不中"><a href="#⑤击中和击不中" class="headerlink" title="⑤击中和击不中"></a>⑤击中和击不中</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709121951954.png" alt="image-20240709121951954"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*击中与击不中算子</span><br><span class="line">*输入图像区域 并且输入两个结构元素 两个结构元素交集是空集 一个是击中 一个是击不中</span><br><span class="line">*Row,Column代表的是参考点的行和列坐标</span><br><span class="line">hit_or_miss(Region,StructElement1,StructElement2:RegionHitMiss:Row,Column:)</span><br></pre></td></tr></table></figure>



<h2 id="20、灰度图像的形态学处理"><a href="#20、灰度图像的形态学处理" class="headerlink" title="20、灰度图像的形态学处理"></a>20、灰度图像的形态学处理</h2><h3 id="①灰度图像的形态学操作"><a href="#①灰度图像的形态学操作" class="headerlink" title="①灰度图像的形态学操作"></a>①灰度图像的形态学操作</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709123045867.png" alt="image-20240709123045867"></p>
<h3 id="②灰度腐蚀与膨胀运算"><a href="#②灰度腐蚀与膨胀运算" class="headerlink" title="②灰度腐蚀与膨胀运算"></a>②灰度腐蚀与膨胀运算</h3><p>灰度腐蚀能够被用来 <strong>分开相互连接的亮物体</strong> 和 <strong>连接支离破碎的暗物体</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709123239326.png" alt="image-20240709123239326"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*使用生成结构元素对灰度图像进行腐蚀操作</span><br><span class="line">gray_erosion(Image,SE:ImageErosion::)</span><br><span class="line"></span><br><span class="line">*使用矩形结构元素对灰度图像进行腐蚀操作</span><br><span class="line">gray_erosion_rect(Image:ImageMin:MaskHeight,MaskWidth:)</span><br><span class="line"></span><br><span class="line">*使用多边形结构元素对灰度图像进行腐蚀操作</span><br><span class="line">gray_erosion_shape(Image:ImageMin:MaskHeight,MaskWidth,MaskShape:)</span><br></pre></td></tr></table></figure>



<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709123501895.png" alt="image-20240709123501895"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*使用生成结构元素对灰度图像进行膨胀操作</span><br><span class="line">gray_dilation(Image,SE:ImageDilation::)</span><br><span class="line"></span><br><span class="line">*使用矩形结构元素对灰度图像进行膨胀操作</span><br><span class="line">gray_dilation_rect(Image:ImageMax:MaskHeight,MaskWidth:)</span><br><span class="line"></span><br><span class="line">*使用多边形结构元素对灰度图像进行膨胀操作</span><br><span class="line">gray_dilation_shape(Image:ImageMax:MaskHeight,MaskWidth,MaskShape:)</span><br></pre></td></tr></table></figure>

<h3 id="③灰度开运算与闭运算"><a href="#③灰度开运算与闭运算" class="headerlink" title="③灰度开运算与闭运算"></a>③灰度开运算与闭运算</h3><p>经过 <strong>开运算</strong> 后，图片 <strong>先腐蚀后膨胀</strong></p>
<p>图片的<strong>整体色调变暗</strong>，但是图片中<strong>阴影和明亮处的界限并未改变</strong>，每一部分的<strong>亮部和暗部都更加平滑</strong>了</p>
<p><strong>Gray Opening Shape（灰度开运算）</strong>是先对图像进行腐蚀操作，再进行膨胀操作。它的作用是消除图像中的细小尖锐物体、噪点或细小连接区域。灰度开运算可以使图像中<strong>较亮的区域变得更暗</strong>，而<strong>较暗的区域则不会有太大的变化，<code>也就是会增加暗的像素点</code></strong>———-<strong>灰度开运算用于去除细小的尖锐物体或噪点</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709124350318.png" alt="image-20240709124350318"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*使用生成结构元素对灰度图像进行开运算</span><br><span class="line">gray_opening(Image,SE:ImageOpening::)</span><br><span class="line"></span><br><span class="line">*使用矩形结构元素对灰度图像进行开运算</span><br><span class="line">gray_opening_rect(Image:ImageOpening:MaskHeight,MaskWidth:)</span><br><span class="line"></span><br><span class="line">*使用多边形结构元素对灰度图像进行开运算</span><br><span class="line">gray_opening_shape(Image:ImageOpening:MaskHeight,MaskWidth,MaskShape:)</span><br></pre></td></tr></table></figure>



<p>经过 <strong>闭运算</strong> 后，图片 <strong>先膨胀后腐蚀</strong></p>
<p>图片的<strong>整体色调变亮</strong>，<strong>界限没有改变</strong>，<strong>明亮也更加平滑</strong>了</p>
<p><strong>Gray Closing Shape（灰度闭运算）</strong>是先对图像进行膨胀操作，再进行腐蚀操作。它的作用是填充图像中的小孔洞，平滑图像的边界并连接相邻的区域。灰度闭运算可以使图像中<strong>较暗的区域变得更亮</strong>，而<strong>较亮的区域则不会有太大的变化，<code>也就是会增加亮的像素点</code></strong>——-<strong>灰度闭运算用于填充小孔洞、连接相邻区域</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709124400077.png" alt="image-20240709124400077"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*使用生成结构元素对灰度图像进行闭运算</span><br><span class="line">gray_closing(Image,SE:ImageClosing::)</span><br><span class="line"></span><br><span class="line">*使用矩形结构元素对灰度图像进行闭运算</span><br><span class="line">gray_closing_rect(Image:ImageClosing:MaskHeight,MaskWidth:)</span><br><span class="line"></span><br><span class="line">*使用多边形结构元素对灰度图像进行闭运算</span><br><span class="line">gray_closing_shape(Image:ImageClosing:MaskHeight,MaskWidth,MaskShape:)</span><br></pre></td></tr></table></figure>

<h3 id="④顶帽和底帽运算"><a href="#④顶帽和底帽运算" class="headerlink" title="④顶帽和底帽运算"></a>④顶帽和底帽运算</h3><p>顶帽和底帽运算就是在开运算和闭运算的基础上，来处理图像中出现的各种杂点、空洞、小的间隙、毛躁的边缘等</p>
<p>顶帽操作的效果等同于<strong>原图-开运算</strong>，即原图减去开运算的图像——-<strong>通常用来去除背景</strong></p>
<p>底帽操作的效果等同于<strong>原图-闭运算</strong>，即原图减去闭运算的图像</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709125953839.png" alt="image-20240709125953839"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*顶帽运算</span><br><span class="line">gray_tophat(Image, SE : ImageTopHat : : )</span><br><span class="line"></span><br><span class="line">*底帽运算</span><br><span class="line">gray_bothat(Image, SE : ImageBotHat : : )</span><br></pre></td></tr></table></figure>



<h2 id="21、边界提取"><a href="#21、边界提取" class="headerlink" title="21、边界提取"></a>21、边界提取</h2><p>边界提取得到的仍然是region类型</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709130945037.png" alt="image-20240709130945037"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 提取边界的算子</span><br><span class="line">* BoundaryType可选inner(内边界)，outer（外边界），inner_filled(内边界，并且将内部孔洞填充)；</span><br><span class="line">boundary(Region:RegionBorder:BoundaryType:)</span><br></pre></td></tr></table></figure>



<h2 id="22、孔洞填充"><a href="#22、孔洞填充" class="headerlink" title="22、孔洞填充"></a>22、孔洞填充</h2><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709131630770.png" alt="image-20240709131630770"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*孔洞填充</span><br><span class="line">fIll_up(Region:RegionFillUp)c</span><br><span class="line"></span><br><span class="line">*选择一些特定区域进行填充</span><br><span class="line">fill_uo_shape(Region:RegionFillUp:Frature,min,max)</span><br></pre></td></tr></table></figure>



<h2 id="23、骨架提取"><a href="#23、骨架提取" class="headerlink" title="23、骨架提取"></a>23、骨架提取</h2><p>骨架提取得到的仍然是region类型</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709132246949.png" alt="image-20240709132246949"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*骨架骨骼提取</span><br><span class="line">skeleton(Region:Skeleton::)</span><br></pre></td></tr></table></figure>



<h2 id="24、图像模板匹配"><a href="#24、图像模板匹配" class="headerlink" title="24、图像模板匹配"></a>24、图像模板匹配</h2><p>图像模板匹配:在整个图像区域发现与给定子图像匹配的小块区域</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709134057720.png" alt="image-20240709134057720"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709134434371.png" alt="image-20240709134434371"></p>
<h3 id="①基于相关性匹配"><a href="#①基于相关性匹配" class="headerlink" title="①基于相关性匹配"></a>①基于相关性匹配</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709135454785.png" alt="image-20240709135454785"></p>
<p><strong>适用于光照不均匀 光线明暗变化较大的 但背景不是特别复杂的场景</strong></p>
<p>注意：</p>
<p><strong>在相关性匹配的过程中 模板图片的角度会归为0度 所以仿射变换的过程中是从0度开始变换的</strong></p>
<p><strong>并且 在创建模板和寻找的过程中 做好是360度匹配（rad(0)–rad(360)）(但是圆不需要)</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240712114057290.png" alt="image-20240712114057290"></p>
<p>基于相关性的匹配算法模板</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">*抠图 抠出模板图片</span><br><span class="line"></span><br><span class="line">*创建NCC匹配模板</span><br><span class="line">create_ncc_model(Template::NumLevels,AngleStart,AngleExtent,AngleStep,MetricLModelID)</span><br><span class="line"></span><br><span class="line">*搜索NCC最佳匹配</span><br><span class="line">find_ncc_model(Image::ModelID,AngleStart,AngleExtent,MinScore,NumMatches,MaxOverlap,SubPixel,Numlevels:Row.Column,Angle,Score)</span><br><span class="line"></span><br><span class="line">*进行仿射变换（把原先画的区域移到找到区域的位置）</span><br><span class="line">vector_angle_to_rigid (ModelRow, ModelColumn, <span class="number">0</span>, Row, Column, Angle, HomMat2D)</span><br><span class="line">affine_trans_region (ModelRegion, RegionAffineTrans, HomMat2D, <span class="string">&#x27;nearest_neighbor&#x27;</span>)</span><br><span class="line"></span><br><span class="line">*释放模板资源</span><br><span class="line">clear_ncc_model(ModelID)</span><br></pre></td></tr></table></figure>



<h3 id="②基于像素灰度值的模板匹配"><a href="#②基于像素灰度值的模板匹配" class="headerlink" title="②基于像素灰度值的模板匹配"></a>②基于像素灰度值的模板匹配</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709134606814.png" alt="image-20240709134606814"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">*创建带旋转角度的灰度匹配模板</span><br><span class="line">create_template(Template : : FirstError, NumLevel, Optimize, GrayValues : TemplateID)</span><br><span class="line">*创建不带旋转角度的灰度匹配模板</span><br><span class="line">create_template_rot(Template : : NumLevel, AngleStart, AngleExtend, AngleStep, Optimize, GrayValues : TemplateID)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*搜索最佳匹配 _rot代表带角度的 _mg代表带金字塔层数的</span><br><span class="line">best_match_rot_mg(Image : : TemplateID, AngleStart, AngleExtend, MaxError, SubPixel, NumLevels : Row, Column, Angle, Error)</span><br><span class="line"></span><br><span class="line">*再进行划线展示（仿射变换 或者 disp直接显示)</span><br><span class="line"></span><br><span class="line">*释放模板资源</span><br><span class="line">clear_ncc_model(ModelID)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*计算区域与图像的平均值和差值 看这个区域的差别在哪里</span><br><span class="line">intensity(Regions, Image : : : Mean, Deviation)</span><br><span class="line"></span><br><span class="line">*根据均值进行自适应调整 </span><br><span class="line">set_offset_template( : : TemplateID, GrayOffset : )</span><br></pre></td></tr></table></figure>



<h3 id="③基于特征的模板匹配——不变矩匹配法"><a href="#③基于特征的模板匹配——不变矩匹配法" class="headerlink" title="③基于特征的模板匹配——不变矩匹配法"></a>③基于特征的模板匹配——不变矩匹配法</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709144356449.png" alt="image-20240709144356449"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709144512598.png" alt="image-20240709144512598"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709150615789.png" alt="image-20240709150615789"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709145456907.png" alt="image-20240709145456907"></p>
<h3 id="④基于形状特征的匹配"><a href="#④基于形状特征的匹配" class="headerlink" title="④基于形状特征的匹配"></a>④基于形状特征的匹配</h3><p><strong>注意</strong></p>
<p>轮廓的位置会自动移到（0，0)的位置 所以起始变化点是（0，0)</p>
<p><strong>XLD</strong>（eXtended Line Descriptions）：换句话说XLD就是一个轮廓函数，它不是基于像素，人们通常称他为亚像素，只不过它比像素更精确，可以精确到像素内部的一种描述。<br>       在Halcon中，使用XLD表示亚像素的轮廓和多边形。常用edges_sub_pix算子来提取亚像素轮廓。<br>       我们都知道图片是由像素组成，当我们用halcon读取图像Image或者region的时候，获得的数据就是像素。这些数据结构都是像素级别的。<br>       获得图像后，我们可以通过亚像素阈值分割或者亚像素边缘提取，这样这些处理得到的结果其实就是用亚像素轮廓来表示。。<br>       上述所述亚像素轮廓其实在halcon中指的就是xld，它可以表示直线或多边形，是一组有序的控制点集合，控制点顺序用来说明彼此相连的关系。</p>
<p><strong>多模板匹配例程所在位置</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240712151816925.png" alt="image-20240712151816925"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">可以获得区域的轮廓</span><br><span class="line">inspect_shape_model (Image, ModelImages, ModelRegions, 1, 30)</span><br></pre></td></tr></table></figure>

<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709151005939.png" alt="image-20240709151005939"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709151243326.png" alt="image-20240709151243326"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">*抠图 抠出模板图片</span><br><span class="line"></span><br><span class="line">--------------------------创建形状匹配模板-----------------；</span><br><span class="line">create_shape_model(Template : : NumLevels, AngleStart, AngleExtent, AngleStep, Optimization, Metric, Contrast, MinContrast : ModelID)</span><br><span class="line">*创建行和列均匀收缩变化的形状匹配模板</span><br><span class="line">create_scaled_shape_model(Template : : NumLevels, AngleStart, AngleExtent, AngleStep, ScaleMin, ScaleMax, ScaleStep, Optimization, Metric, Contrast, MinContrast : ModelID)</span><br><span class="line">*创建行和列不均匀收缩变化的形状匹配模板</span><br><span class="line">create_aniso_shape_model(Template : : NumLevels, AngleStart, AngleExtent, AngleStep, ScaleRMin, ScaleRMax, ScaleRStep, ScaleCMin, ScaleCMax, ScaleCStep, Optimization, Metric, Contrast, MinContrast : ModelID)</span><br><span class="line"></span><br><span class="line">-----------------------------获取形状模板的轮廓------------------；</span><br><span class="line">get_shape_model_contours( : ModelContours : ModelID, Level : )</span><br><span class="line"></span><br><span class="line">-------------------------------*寻找最佳匹配--------------------</span><br><span class="line">------注意find_shape_models代表多个模板匹配 在model后面加一个s-----------；</span><br><span class="line">find_shape_model(Image : : ModelID, AngleStart, AngleExtent, MinScore, NumMatches, MaxOverlap, SubPixel, NumLevels, Greediness : Row, Column, Angle, Score)</span><br><span class="line">*寻找最佳匹配（这个模板是进行等比例大小缩放过的）</span><br><span class="line">find_scaled_shape_model(Image : : ModelID, AngleStart, AngleExtent, ScaleMin, ScaleMax, MinScore, NumMatches, MaxOverlap, SubPixel, NumLevels, Greediness : Row, Column, Angle, Scale, Score)</span><br><span class="line">*寻找最佳匹配（这个模板是进行非等比例大小缩放过的）</span><br><span class="line">find_aniso_shape_model(Image : : ModelID, AngleStart, AngleExtent, ScaleRMin, ScaleRMax, ScaleCMin, ScaleCMax, MinScore, NumMatches, MaxOverlap, SubPixel, NumLevels, Greediness : Row, Column, Angle, ScaleR, ScaleC, Score)</span><br><span class="line"></span><br><span class="line">----------------------将形状模板的轮廓进行仿射变换最佳匹配的位置------------；</span><br><span class="line">vector_angle_to_rigid (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, RowRef, ColumnRef, <span class="number">0</span>, HomMat2D)</span><br><span class="line">affine_trans_contour_xld (Model, ModelTrans, HomMat2D)</span><br></pre></td></tr></table></figure>

<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Metric (input_control)  <span class="built_in">string</span> → (<span class="built_in">string</span>)</span><br><span class="line">Match metric.</span><br><span class="line">Default <span class="keyword">value</span>: <span class="string">&#x27;use_polarity&#x27;</span></span><br><span class="line">List of values: <span class="string">&#x27;ignore_color_polarity&#x27;</span>, <span class="string">&#x27;ignore_global_polarity&#x27;</span>, <span class="string">&#x27;ignore_local_polarity&#x27;</span>, <span class="string">&#x27;use_polarity&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;ignore_color_polarity&#x27;</span>（忽略颜色极性）：在这种模式下，匹配过程中将忽略图像中物体的颜色信息，仅考虑物体的形状信息。这意味着无论物体是亮色还是暗色，都将被视为相同的形状进行匹配。这种模式适用于只关注物体的形状特征，而对颜色不敏感的应用场景。</span><br><span class="line"><span class="string">&#x27;ignore_global_polarity&#x27;</span>（忽略全局极性）：在这种模式下，匹配过程中将忽略图像中物体的全局极性信息，只考虑局部极性和形状信息。全局极性指的是整个物体区域的亮度变化趋势，而局部极性指的是物体局部区域的亮度变化趋势。通过忽略全局极性，匹配算法将主要关注物体的局部形状信息，而不受整体亮度变化的影响。这种模式适用于物体具有局部形状特征并且整体亮度可能变化较大的情况。</span><br><span class="line"><span class="string">&#x27;ignore_local_polarity&#x27;</span>（忽略局部极性）：在这种模式下，匹配过程中将忽略物体的局部极性信息，只考虑全局极性和形状信息。与上述模式相反，它将主要关注物体的全局形状信息，而不受局部亮度变化的影响。这种模式适用于物体的整体形状特征对匹配更重要，而局部亮度变化对匹配结果影响较小的情况。</span><br><span class="line"><span class="string">&#x27;use_polarity&#x27;</span>（使用极性信息和形状信息进行匹配，默认选项）：这是默认的匹配度量标准选项。在这种模式下，匹配过程中同时考虑物体的极性信息（包括全局和局部极性）和形状信息。极性信息指的是物体区域的亮度变化趋势，包括明暗变化、边缘方向等。这种模式综合考虑了颜色、亮度和形状等多个特征，适用于大多数情况下的模板匹配任务。</span><br></pre></td></tr></table></figure>



<h3 id="⑤Matching助手工具"><a href="#⑤Matching助手工具" class="headerlink" title="⑤Matching助手工具"></a>⑤Matching助手工具</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709150024054.png" alt="image-20240709150024054"></p>
<h2 id="25、图像金字塔"><a href="#25、图像金字塔" class="headerlink" title="25、图像金字塔"></a>25、图像金字塔</h2><p>低分辨率关注的是基础纹理（大纹理)</p>
<p>高分辨率下关注的是更精细的纹理</p>
<p><strong>根据金字塔层数和对比度检查要生成的模板是否合适</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">*读取图像的新算子</span><br><span class="line">open_framegrabber (&#x27;File&#x27;, 1, 1, 0, 0, 0, 0, &#x27;default&#x27;, -1, &#x27;default&#x27;, -1, &#x27;default&#x27;, &#x27;rings/rings.seq&#x27;, &#x27;default&#x27;, -1, 1, FGHandle)</span><br><span class="line"></span><br><span class="line">*创建基于金字塔层数的模型表示</span><br><span class="line">inspect_shape_model</span><br></pre></td></tr></table></figure>

<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240709155253690.png" alt="image-20240709155253690"></p>
<h2 id="26、相机标定（Camera-Calibration–标定，校准）"><a href="#26、相机标定（Camera-Calibration–标定，校准）" class="headerlink" title="26、相机标定（Camera Calibration–标定，校准）"></a>26、相机标定（Camera Calibration–标定，校准）</h2><h3 id="①标定的概念"><a href="#①标定的概念" class="headerlink" title="①标定的概念"></a>①标定的概念</h3><p>标定的主要目标是获得相机的内部参数和外部参数，以便将图像像素坐标转换为真实世界中的物理坐标。</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240710111159354.png" alt="image-20240710111159354"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240710113557854.png" alt="image-20240710113557854"></p>
<h3 id="②标定的流程"><a href="#②标定的流程" class="headerlink" title="②标定的流程"></a>②标定的流程</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240710121942179.png" alt="image-20240710121942179"></p>
<h2 id="27、-双目立体视觉—-模拟人的双眼"><a href="#27、-双目立体视觉—-模拟人的双眼" class="headerlink" title="27、 双目立体视觉—-模拟人的双眼"></a>27、 双目立体视觉—-模拟人的双眼</h2><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240710131313225.png" alt="image-20240710131313225"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240710134134709.png" alt="image-20240710134134709"></p>
<h3 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240710141037584.png" alt="image-20240710141037584"></p>
<h3 id="例程"><a href="#例程" class="headerlink" title="例程"></a>例程</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240710141104040.png" alt="image-20240710141104040"></p>
<h2 id="28、OCR识别"><a href="#28、OCR识别" class="headerlink" title="28、OCR识别"></a>28、OCR识别</h2><p><strong>注意Halcon自带的字体默认字体是黑色背景是亮色</strong></p>
<h3 id="①常用的将断开字符连接上的方法"><a href="#①常用的将断开字符连接上的方法" class="headerlink" title="①常用的将断开字符连接上的方法"></a>①常用的将断开字符连接上的方法</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 膨胀</span><br><span class="line">dilation_circle (Region, RegionDilation, <span class="number">3.5</span>)</span><br><span class="line">* 连接（打散成单个区域）</span><br><span class="line">connection (RegionDilation, ConnectedRegions)</span><br><span class="line">* 求交集（将字母i和j断开的区域连接上）</span><br><span class="line">intersection (ConnectedRegions, Region, RegionIntersection)</span><br></pre></td></tr></table></figure>

<h3 id="②ocr的识别流程"><a href="#②ocr的识别流程" class="headerlink" title="②ocr的识别流程"></a>②ocr的识别流程</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">*创建并且存储训练集</span><br><span class="line">write_ocr_trainf (Characters, Image, Classes, TrainFile)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*创建 OCR 分类器</span><br><span class="line">------从训练文件中读取类别名称</span><br><span class="line">read_ocr_trainf_names (TrainFile, CharacterNames, CharacterCount)</span><br><span class="line">------创建 MLP OCR 分类器</span><br><span class="line">create_ocr_class_mlp (<span class="number">8</span>, <span class="number">10</span>, <span class="string">&#x27;constant&#x27;</span>, <span class="string">&#x27;default&#x27;</span>, CharacterNames, <span class="number">20</span>, <span class="string">&#x27;canonical_variates&#x27;</span>, <span class="number">26</span>, <span class="number">42</span>, OCRHandle)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*使用训练文件进行训练分类器</span><br><span class="line">trainf_ocr_class_mlp (OCRHandle, TrainFile, <span class="number">100</span>, <span class="number">0.01</span>, <span class="number">0.01</span>, Error, ErrorLog)</span><br><span class="line">*从文件中直接读取一个分类器</span><br><span class="line">read_ocr_class_mlp (FontName, OCRHandle)</span><br><span class="line"></span><br><span class="line">*单个匹配或者多个匹配</span><br><span class="line">do_ocr_single_class_mlp(Character, Image : : OCRHandle, Num : Class, Confidence)</span><br><span class="line">do_ocr_multi_class_mlp(Character, Image : : OCRHandle : Class, Confidence)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="③对于弯曲的字符可以进行极坐标旋转"><a href="#③对于弯曲的字符可以进行极坐标旋转" class="headerlink" title="③对于弯曲的字符可以进行极坐标旋转"></a>③对于弯曲的字符可以进行极坐标旋转</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">polar_trans_image_ext (Image, ImagePolar, Row, Column, <span class="number">0</span>, rad(<span class="number">360</span>), Radius - <span class="number">30</span>, Radius - <span class="number">5</span>, WidthP, HeightP, <span class="string">&#x27;bilinear&#x27;</span>)</span><br><span class="line"></span><br><span class="line">dev_open_window (<span class="number">0</span>, <span class="number">0</span>, WidthP, HeightP, <span class="string">&#x27;black&#x27;</span>, WindowHandle2)</span><br><span class="line"></span><br><span class="line">rotate_image (ImagePolar, ImageRotate, <span class="number">180</span>, <span class="string">&#x27;constant&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="④OCR识别字符的流程"><a href="#④OCR识别字符的流程" class="headerlink" title="④OCR识别字符的流程"></a>④OCR识别字符的流程</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240713161411369.png" alt="image-20240713161411369"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">read_image (Image11, <span class="string">&#x27;C:/Users/ZW/Desktop/机器视觉/Halcon视频教程 第2套初级班+强化班/初级班视频/实战图片/字符.bmp&#x27;</span>)</span><br><span class="line">dev_close_window ()</span><br><span class="line">get_image_size (Image11, Width, Height)</span><br><span class="line">dev_open_window (<span class="number">0</span>, <span class="number">0</span>, Width/<span class="number">4</span>, Height/<span class="number">4</span>, <span class="string">&#x27;black&#x27;</span>, WindowID)</span><br><span class="line">set_display_font (WindowID, <span class="number">40</span>, <span class="string">&#x27;mono&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="string">&#x27;false&#x27;</span>)</span><br><span class="line"></span><br><span class="line">*图片翻转为正向</span><br><span class="line">mirror_image (Image11, ImageMirror, <span class="string">&#x27;row&#x27;</span>)</span><br><span class="line">mirror_image (ImageMirror, ImageMirror1, <span class="string">&#x27;column&#x27;</span>)</span><br><span class="line"></span><br><span class="line">*选择感兴趣的区域</span><br><span class="line">scale_image (ImageMirror1, ImageScaled, <span class="number">3.98438</span>, <span class="number">-749</span>)</span><br><span class="line">threshold (ImageScaled, Regions, <span class="number">0</span>, <span class="number">52</span>)</span><br><span class="line">connection (Regions, ConnectedRegions)</span><br><span class="line">select_shape (ConnectedRegions, SelectedRegions, [<span class="string">&#x27;area&#x27;</span>,<span class="string">&#x27;rectangularity&#x27;</span>], <span class="string">&#x27;and&#x27;</span>, [<span class="number">111408</span>,<span class="number">0.61765</span>], [<span class="number">5e+006</span>,<span class="number">1</span>])</span><br><span class="line">reduce_domain (ImageMirror1, SelectedRegions, ImageReduced)</span><br><span class="line"></span><br><span class="line">*选择需要识别的内容（<span class="number">26</span>）</span><br><span class="line">threshold (ImageReduced, Regions1, <span class="number">0</span>, <span class="number">144</span>)</span><br><span class="line">connection (Regions1, ConnectedRegions1)</span><br><span class="line">select_shape (ConnectedRegions1, SelectedRegions1, [<span class="string">&#x27;area&#x27;</span>,<span class="string">&#x27;width&#x27;</span>,<span class="string">&#x27;rectangularity&#x27;</span>], <span class="string">&#x27;and&#x27;</span>, [<span class="number">0</span>,<span class="number">54.23</span>,<span class="number">0</span>], [<span class="number">9647.27</span>,<span class="number">204.14</span>,<span class="number">0.8545</span>])</span><br><span class="line">union1 (SelectedRegions1, RegionUnion)</span><br><span class="line"></span><br><span class="line">*将断开区域进行连接</span><br><span class="line">gen_rectangle2 (Rectangle, <span class="number">16</span>, <span class="number">16</span>, rad(<span class="number">45</span>), <span class="number">4</span>, <span class="number">4</span>)</span><br><span class="line">closing (RegionUnion, Rectangle, RegionClosing)</span><br><span class="line">*注意要将连通好的单个区域 与 二值化后的区域 进行交集运算</span><br><span class="line">connection (RegionClosing, ConnectedRegions2)</span><br><span class="line">intersection (ConnectedRegions2, Regions1, RegionIntersection)</span><br><span class="line"></span><br><span class="line">read_ocr_class_mlp (<span class="string">&#x27;Industrial_0-9A-Z_NoRej.omc&#x27;</span>, OCRHandle)</span><br><span class="line">do_ocr_multi_class_mlp (RegionIntersection, ImageReduced, OCRHandle, Class, Confidence)</span><br><span class="line"></span><br><span class="line">smallest_rectangle1 (RegionIntersection, Row11, Column1, Row2, Column21)</span><br><span class="line">count_obj (RegionIntersection, NumberFinal)</span><br><span class="line">dev_display (ImageMirror1)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span> to NumberFinal <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line">    disp_message (WindowID, Class[i - <span class="number">1</span>], <span class="string">&#x27;image&#x27;</span>,Row2[i - <span class="number">1</span>], Column1[i - <span class="number">1</span>], <span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;false&#x27;</span>)</span><br><span class="line">endfor</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="⑤OCR识别环形字体"><a href="#⑤OCR识别环形字体" class="headerlink" title="⑤OCR识别环形字体"></a>⑤OCR识别环形字体</h3><p><strong>区别点主要在于将圆形区域进行极坐标转换（拉直操作）</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240713165746300.png" alt="image-20240713165746300"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">*读取图像</span><br><span class="line">read_image (Image,<span class="string">&#x27;C:/Users/ZW/Desktop/机器视觉/Halcon视频教程 第2套初级班+强化班/初级班视频/实战图片/1.1.bmp&#x27;</span>)</span><br><span class="line">dev_close_window ()</span><br><span class="line">dev_open_window (<span class="number">0</span>,<span class="number">0</span>,<span class="number">480</span>,<span class="number">480</span>,<span class="string">&#x27;black&#x27;</span>, WindowHandle)</span><br><span class="line">dev_display (Image)</span><br><span class="line">rgb1_to_gray (Image, GrayImage)</span><br><span class="line"></span><br><span class="line">*提取外圆的半径</span><br><span class="line">threshold (GrayImage, Regions, <span class="number">4</span>, <span class="number">103</span>)</span><br><span class="line">*得到外圆的圆心和半径</span><br><span class="line">smallest_circle (Regions, Row, Column, OuterRadius)</span><br><span class="line"></span><br><span class="line">*得到整个外圆</span><br><span class="line">shape_trans (Regions, outcircle, <span class="string">&#x27;outer_circle&#x27;</span>)</span><br><span class="line"></span><br><span class="line">*求外环的补集 也就是得到内圆</span><br><span class="line">complement (Regions, RegionComplement)</span><br><span class="line">connection (RegionComplement, InnerCircle)</span><br><span class="line">select_shape (InnerCircle, SelectedRegions, [<span class="string">&#x27;area&#x27;</span>,<span class="string">&#x27;circularity&#x27;</span>], <span class="string">&#x27;and&#x27;</span>, [<span class="number">200</span>,<span class="number">0.8422</span>], [<span class="number">2.29055e+006</span>,<span class="number">1</span>])</span><br><span class="line">*得到内圆的圆心和半径</span><br><span class="line">smallest_circle (SelectedRegions, InnerRow, InnerColumn, InnerRadius)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*极坐标转换</span><br><span class="line">*输入的参数 </span><br><span class="line">* Image---输入原图片  PolarTransImage--得到的转换后的图</span><br><span class="line">* Row, Column圆心的坐标</span><br><span class="line">* rad(<span class="number">360</span>), <span class="number">0</span> 这个表示需要处理哪些角度的 （这个就代表<span class="number">360</span>度均处理）</span><br><span class="line">* OuterRadius - <span class="number">100</span> 这个表示字体的顶部到圆心的距离</span><br><span class="line">* InnerRadius + <span class="number">40</span> 这个表示字体的底部到圆心的距离</span><br><span class="line">* <span class="number">1440</span>代表极坐标的宽度</span><br><span class="line">* <span class="number">100</span>代表待识别字体的高度</span><br><span class="line">polar_trans_image_ext (Image, PolarTransImage, Row, Column, rad(<span class="number">360</span>), <span class="number">0</span>, OuterRadius - <span class="number">100</span>, InnerRadius + <span class="number">40</span>, <span class="number">1440</span>, <span class="number">100</span>, <span class="string">&#x27;bilinear&#x27;</span>)</span><br><span class="line"></span><br><span class="line">*接下来就和之前一样 对字体进行处理</span><br><span class="line">*颜色翻转</span><br><span class="line">invert_image (PolarTransImage, ImageInvert)</span><br><span class="line">*对比度改变</span><br><span class="line">scale_image (ImageInvert, ImageScaled1, <span class="number">6.71053</span>, <span class="number">-1429</span>)</span><br><span class="line">*字符分割</span><br><span class="line">binary_threshold (ImageScaled1, Region2, <span class="string">&#x27;max_separability&#x27;</span>, <span class="string">&#x27;light&#x27;</span>, UsedThreshold2)</span><br><span class="line">connection (Region2, ConnectedRegions3)</span><br><span class="line">select_shape (ConnectedRegions3, SelectedRegions1, <span class="string">&#x27;area&#x27;</span>, <span class="string">&#x27;and&#x27;</span>, <span class="number">64.69</span>, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line">*对字符进行膨胀处理 然后connection连通后求交集</span><br><span class="line">dilation_rectangle1 (SelectedRegions1, RegionDilation, <span class="number">5</span>, <span class="number">5</span>)</span><br><span class="line">union1 (RegionDilation, RegionUnion)</span><br><span class="line">connection (RegionUnion, ConnectedRegions2)</span><br><span class="line">dev_clear_window ()</span><br><span class="line">dev_display (ConnectedRegions2)</span><br><span class="line">intersection (ConnectedRegions2, Region2, RegionIntersection)</span><br><span class="line">sort_region (RegionIntersection, SortedRegions1, <span class="string">&#x27;character&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="string">&#x27;column&#x27;</span>)</span><br><span class="line"></span><br><span class="line">*识别</span><br><span class="line">read_ocr_class_mlp (<span class="string">&#x27;C:/Program Files/MVTec/HALCON-12.0/ocr/Industrial_0-9A-Z_NoRej.omc&#x27;</span>, OCRHandle)</span><br><span class="line">do_ocr_multi_class_mlp (SortedRegions1, PolarTransImage, OCRHandle, Class, Confidence)</span><br><span class="line"></span><br><span class="line">*显示</span><br><span class="line">count_obj (SortedRegions1, Number)</span><br><span class="line">area_center (SortedRegions1, Area, Row2, Column2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> Index := <span class="number">1</span> to Number <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line">    disp_message (WindowHandle, Class[Index<span class="number">-1</span>], <span class="string">&#x27;PolarTransImage&#x27;</span>, <span class="number">40</span>, Column2[Index<span class="number">-1</span>]<span class="number">-20</span>, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span>)</span><br><span class="line">endfor</span><br></pre></td></tr></table></figure>





<h2 id="29、测量和拟合"><a href="#29、测量和拟合" class="headerlink" title="29、测量和拟合"></a>29、测量和拟合</h2><h3 id="①测量矩形边缘宽度的过程"><a href="#①测量矩形边缘宽度的过程" class="headerlink" title="①测量矩形边缘宽度的过程"></a>①测量矩形边缘宽度的过程</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">*形成测量矩形</span><br><span class="line">gen_rectangle2 (Rectangle1, Row + Rect1Row, Column + Rect1Col, RectPhi, RectLength1, RectLength2)</span><br><span class="line">gen_measure_rectangle2( : : Row, Column, Phi, Length1, Length2, Width, Height, Interpolation : MeasureHandle)</span><br><span class="line"></span><br><span class="line">*进行边缘对测量</span><br><span class="line">*sigma代表平滑参数</span><br><span class="line">*Threshold 边缘幅度  Transition 边缘方向</span><br><span class="line">*IntraDistance 两个边缘之间的距离</span><br><span class="line">*InterDistance 相邻边缘对之间的距离</span><br><span class="line">measure_pairs(Image : : MeasureHandle, Sigma, Threshold, Transition, Select : RowEdgeFirst, ColumnEdgeFirst, AmplitudeFirst, RowEdgeSecond, ColumnEdgeSecond, AmplitudeSecond, IntraDistance, InterDistance)</span><br><span class="line">    </span><br><span class="line">*释放测量矩形</span><br><span class="line">close_measure(MeasureHandle)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*以单个边缘的形式进行测量 而不是边缘对 </span><br><span class="line">measure_pos(Image : : MeasureHandle, Sigma, Threshold, Transition, Select : RowEdge, ColumnEdge, Amplitude, Distance)</span><br></pre></td></tr></table></figure>

<p>例程：<code>fuse.hdev</code></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">* fuse.hdev: measuring the width of a fuse wire</span><br><span class="line">* </span><br><span class="line">dev_update_window (<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">dev_close_window ()</span><br><span class="line">* ****</span><br><span class="line">* step: acquire image</span><br><span class="line">* ****</span><br><span class="line">read_image (Fuse, <span class="string">&#x27;fuse&#x27;</span>)</span><br><span class="line">get_image_size (Fuse, Width, Height)</span><br><span class="line">dev_open_window_fit_image (Fuse, <span class="number">0</span>, <span class="number">0</span>, Width, Height, WindowID)</span><br><span class="line">set_display_font (WindowID, <span class="number">12</span>, <span class="string">&#x27;mono&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="string">&#x27;false&#x27;</span>)</span><br><span class="line">dev_set_draw (<span class="string">&#x27;margin&#x27;</span>)</span><br><span class="line">dev_set_line_width (<span class="number">3</span>)</span><br><span class="line">dev_display (Fuse)</span><br><span class="line">set_display_font (WindowID, <span class="number">12</span>, <span class="string">&#x27;mono&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="string">&#x27;false&#x27;</span>)</span><br><span class="line">disp_continue_message (WindowID, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span>)</span><br><span class="line">stop ()</span><br><span class="line">* ****</span><br><span class="line">* step: create measure <span class="built_in">object</span></span><br><span class="line">* ****</span><br><span class="line">* -&gt; specify ROI</span><br><span class="line">Row := <span class="number">297</span></span><br><span class="line">Column := <span class="number">545</span></span><br><span class="line">Length1 := <span class="number">80</span></span><br><span class="line">Length2 := <span class="number">10</span></span><br><span class="line">Angle := rad(<span class="number">90</span>)</span><br><span class="line">gen_rectangle2 (ROI, Row, Column, Angle, Length1, Length2)</span><br><span class="line">* -&gt; <span class="function">create measure <span class="built_in">object</span></span></span><br><span class="line"><span class="function"><span class="title">gen_measure_rectangle2</span> (<span class="params">Row, Column, Angle, Length1, Length2, Width, Height, <span class="string">&#x27;bilinear&#x27;</span>, MeasureHandle</span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_display</span> (<span class="params">ROI</span>)</span></span><br><span class="line"><span class="function"><span class="title">disp_continue_message</span> (<span class="params">WindowID, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">stop</span> ()</span></span><br><span class="line"><span class="function">* ****</span></span><br><span class="line"><span class="function">* step: measure</span></span><br><span class="line"><span class="function">* ****</span></span><br><span class="line"><span class="function"><span class="title">measure_pairs</span> (<span class="params">Fuse, MeasureHandle, <span class="number">1</span>, <span class="number">1</span>, <span class="string">&#x27;negative&#x27;</span>, <span class="string">&#x27;all&#x27;</span>, RowEdgeFirst, ColumnEdgeFirst, AmplitudeFirst, RowEdgeSecond, ColumnEdgeSecond, AmplitudeSecond, IntraDistance, InterDistance</span>)</span></span><br><span class="line"><span class="function"><span class="title">disp_continue_message</span> (<span class="params">WindowID, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">stop</span> ()</span></span><br><span class="line"><span class="function">* ****</span></span><br><span class="line"><span class="function">* step: visualize results</span></span><br><span class="line"><span class="function">* ****</span></span><br><span class="line"><span class="function"><span class="keyword">for</span> i :</span>= <span class="number">0</span> to |RowEdgeFirst| - <span class="number">1</span> <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line">    gen_contour_polygon_xld (EdgeFirst, [-sin(Angle + rad(<span class="number">90</span>)) * Length2 + RowEdgeFirst[i],-sin(Angle - rad(<span class="number">90</span>)) * Length2 + RowEdgeFirst[i]], [cos(Angle + rad(<span class="number">90</span>)) * Length2 + ColumnEdgeFirst[i],cos(Angle - rad(<span class="number">90</span>)) * Length2 + ColumnEdgeFirst[i]])</span><br><span class="line">    gen_contour_polygon_xld (EdgeSecond, [-sin(Angle + rad(<span class="number">90</span>)) * Length2 + RowEdgeSecond[i],-sin(Angle - rad(<span class="number">90</span>)) * Length2 + RowEdgeSecond[i]], [cos(Angle + rad(<span class="number">90</span>)) * Length2 + ColumnEdgeSecond[i],cos(Angle - rad(<span class="number">90</span>)) * Length2 + ColumnEdgeSecond[i]])</span><br><span class="line">    dev_set_color (<span class="string">&#x27;cyan&#x27;</span>)</span><br><span class="line">    dev_display (EdgeFirst)</span><br><span class="line">    dev_set_color (<span class="string">&#x27;magenta&#x27;</span>)</span><br><span class="line">    dev_display (EdgeSecond)</span><br><span class="line">    dev_set_color (<span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">0</span>)</span><br><span class="line">        set_tposition (WindowID, RowEdgeFirst[i] + <span class="number">5</span>, ColumnEdgeFirst[i] + <span class="number">20</span>)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        set_tposition (WindowID, RowEdgeFirst[i] - <span class="number">40</span>, ColumnEdgeFirst[i] + <span class="number">20</span>)</span><br><span class="line">    <span class="function">endif</span></span><br><span class="line"><span class="function">    <span class="title">write_string</span> (<span class="params">WindowID, <span class="string">&#x27;width: &#x27;</span> + IntraDistance[i] + <span class="string">&#x27; pix&#x27;</span></span>)</span></span><br><span class="line"><span class="function">endfor</span></span><br><span class="line"><span class="function"><span class="title">disp_continue_message</span> (<span class="params">WindowID, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">stop</span> ()</span></span><br><span class="line"><span class="function">* ****</span></span><br><span class="line"><span class="function">* step: destroy measure <span class="built_in">object</span></span></span><br><span class="line"><span class="function">* ****</span></span><br><span class="line"><span class="function"><span class="title">close_measure</span> (<span class="params">MeasureHandle</span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_update_window</span> (<span class="params"><span class="string">&#x27;on&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_clear_window</span> ()</span></span><br></pre></td></tr></table></figure>



<h3 id="②measure助手"><a href="#②measure助手" class="headerlink" title="②measure助手"></a>②measure助手</h3><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240714110713319.png" alt="image-20240714110713319">



<h3 id="③定位测量的思路（先做模板匹配定位-然后-再进行测量）"><a href="#③定位测量的思路（先做模板匹配定位-然后-再进行测量）" class="headerlink" title="③定位测量的思路（先做模板匹配定位 然后 再进行测量）"></a>③定位测量的思路（先做模板匹配定位 然后 再进行测量）</h3><p>例程：<code>pm_measure_board.hdev</code></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240714115307174.png" alt="image-20240714115307174"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">dev_update_pc (<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">dev_update_window (<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">dev_update_var (<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">open_framegrabber (<span class="string">&#x27;File&#x27;</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="string">&#x27;default&#x27;</span>, <span class="number">-1</span>, <span class="string">&#x27;default&#x27;</span>, <span class="number">-1</span>, <span class="string">&#x27;default&#x27;</span>, <span class="string">&#x27;board/board.seq&#x27;</span>, <span class="string">&#x27;default&#x27;</span>, <span class="number">-1</span>, <span class="number">1</span>, FGHandle)</span><br><span class="line">grab_image (Image, FGHandle)</span><br><span class="line">get_image_size (Image, Width, Height)</span><br><span class="line">dev_close_window ()</span><br><span class="line">dev_open_window (<span class="number">0</span>, <span class="number">0</span>, Width, Height, <span class="string">&#x27;black&#x27;</span>, WindowHandle)</span><br><span class="line">dev_open_window (Height + <span class="number">70</span>, <span class="number">0</span>, Width, <span class="number">120</span>, <span class="string">&#x27;black&#x27;</span>, WindowHandleText)</span><br><span class="line">dev_set_window (WindowHandle)</span><br><span class="line">set_display_font (WindowHandle, <span class="number">16</span>, <span class="string">&#x27;mono&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="string">&#x27;false&#x27;</span>)</span><br><span class="line">set_display_font (WindowHandleText, <span class="number">16</span>, <span class="string">&#x27;mono&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="string">&#x27;false&#x27;</span>)</span><br><span class="line">dev_set_color (<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">dev_display (Image)</span><br><span class="line">Row1 := <span class="number">188</span></span><br><span class="line">Column1 := <span class="number">182</span></span><br><span class="line">Row2 := <span class="number">298</span></span><br><span class="line">Column2 := <span class="number">412</span></span><br><span class="line">gen_rectangle1 (Rectangle, Row1, Column1, Row2, Column2)</span><br><span class="line">area_center (Rectangle, Area, Row, Column)</span><br><span class="line">Rect1Row := <span class="number">-102</span></span><br><span class="line">Rect1Col := <span class="number">5</span></span><br><span class="line">Rect2Row := <span class="number">107</span></span><br><span class="line">Rect2Col := <span class="number">5</span></span><br><span class="line">RectPhi := <span class="number">0</span></span><br><span class="line">RectLength1 := <span class="number">170</span></span><br><span class="line">RectLength2 := <span class="number">5</span></span><br><span class="line">gen_rectangle2 (Rectangle1, Row + Rect1Row, Column + Rect1Col, RectPhi, RectLength1, RectLength2)</span><br><span class="line">gen_rectangle2 (Rectangle2, Row + Rect2Row, Column + Rect2Col, RectPhi, RectLength1, RectLength2)</span><br><span class="line">reduce_domain (Image, Rectangle, ImageReduced)</span><br><span class="line">create_shape_model (ImageReduced, <span class="number">4</span>, <span class="number">0</span>, rad(<span class="number">360</span>), rad(<span class="number">1</span>), <span class="string">&#x27;none&#x27;</span>, <span class="string">&#x27;use_polarity&#x27;</span>, <span class="number">30</span>, <span class="number">10</span>, ModelID)</span><br><span class="line">get_shape_model_contours (ShapeModel, ModelID, <span class="number">1</span>)</span><br><span class="line">hom_mat2d_identity (HomMat2DIdentity)</span><br><span class="line">hom_mat2d_translate (HomMat2DIdentity, Row, Column, HomMat2DTranslate)</span><br><span class="line">affine_trans_contour_xld (ShapeModel, ShapeModelTrans, HomMat2DTranslate)</span><br><span class="line">dev_display (Image)</span><br><span class="line">dev_set_color (<span class="string">&#x27;green&#x27;</span>)</span><br><span class="line">dev_display (ShapeModelTrans)</span><br><span class="line">dev_set_color (<span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line">dev_set_draw (<span class="string">&#x27;margin&#x27;</span>)</span><br><span class="line">dev_set_line_width (<span class="number">3</span>)</span><br><span class="line">dev_display (Rectangle1)</span><br><span class="line">dev_display (Rectangle2)</span><br><span class="line">dev_set_draw (<span class="string">&#x27;fill&#x27;</span>)</span><br><span class="line">dev_set_line_width (<span class="number">1</span>)</span><br><span class="line">dev_set_color (<span class="string">&#x27;yellow&#x27;</span>)</span><br><span class="line">disp_message (WindowHandle, [<span class="string">&#x27;Press left button to start&#x27;</span>,<span class="string">&#x27;and stop the demo&#x27;</span>], <span class="string">&#x27;image&#x27;</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span>)</span><br><span class="line">get_mbutton (WindowHandle, Row3, Column3, Button1)</span><br><span class="line">wait_seconds (<span class="number">0.5</span>)</span><br><span class="line">Button := <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> (Button != <span class="number">1</span>)</span><br><span class="line">    dev_set_window (WindowHandle)</span><br><span class="line">    dev_set_part (<span class="number">0</span>, <span class="number">0</span>, Height - <span class="number">1</span>, Width - <span class="number">1</span>)</span><br><span class="line">    grab_image (ImageCheck, FGHandle)</span><br><span class="line">    dev_display (ImageCheck)</span><br><span class="line">    count_seconds (S1)</span><br><span class="line">    find_shape_model (ImageCheck, ModelID, <span class="number">0</span>, rad(<span class="number">360</span>), <span class="number">0.7</span>, <span class="number">1</span>, <span class="number">0.5</span>, <span class="string">&#x27;least_squares&#x27;</span>, <span class="number">4</span>, <span class="number">0.7</span>, RowCheck, ColumnCheck, AngleCheck, Score)</span><br><span class="line">    count_seconds (S2)</span><br><span class="line">    dev_display (ImageCheck)</span><br><span class="line">    <span class="keyword">if</span> (|Score| &gt; <span class="number">0</span>)</span><br><span class="line">        dev_set_color (<span class="string">&#x27;green&#x27;</span>)</span><br><span class="line">        hom_mat2d_identity (HomMat2DIdentity)</span><br><span class="line">        hom_mat2d_translate (HomMat2DIdentity, RowCheck, ColumnCheck, HomMat2DTranslate)</span><br><span class="line">        hom_mat2d_rotate (HomMat2DTranslate, AngleCheck, RowCheck, ColumnCheck, HomMat2DRotate)</span><br><span class="line">        affine_trans_contour_xld (ShapeModel, ShapeModelTrans, HomMat2DRotate)</span><br><span class="line">        dev_display (ShapeModelTrans)</span><br><span class="line">        affine_trans_pixel (HomMat2DRotate, Rect1Row, Rect1Col, Rect1RowCheck, Rect1ColCheck)</span><br><span class="line">        affine_trans_pixel (HomMat2DRotate, Rect2Row, Rect2Col, Rect2RowCheck, Rect2ColCheck)</span><br><span class="line">        gen_rectangle2 (Rectangle1Check, Rect1RowCheck, Rect1ColCheck, AngleCheck, RectLength1, RectLength2)</span><br><span class="line">        gen_rectangle2 (Rectangle2Check, Rect2RowCheck, Rect2ColCheck, AngleCheck, RectLength1, RectLength2)</span><br><span class="line">        dev_set_color (<span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line">        dev_set_draw (<span class="string">&#x27;margin&#x27;</span>)</span><br><span class="line">        dev_set_line_width (<span class="number">3</span>)</span><br><span class="line">        dev_display (Rectangle1Check)</span><br><span class="line">        dev_display (Rectangle2Check)</span><br><span class="line">        dev_set_draw (<span class="string">&#x27;fill&#x27;</span>)</span><br><span class="line">        count_seconds (S3)</span><br><span class="line">        gen_measure_rectangle2 (Rect1RowCheck, Rect1ColCheck, AngleCheck, RectLength1, RectLength2, Width, Height, <span class="string">&#x27;bilinear&#x27;</span>, MeasureHandle1)</span><br><span class="line">        gen_measure_rectangle2 (Rect2RowCheck, Rect2ColCheck, AngleCheck, RectLength1, RectLength2, Width, Height, <span class="string">&#x27;bilinear&#x27;</span>, MeasureHandle2)</span><br><span class="line">        measure_pairs (ImageCheck, MeasureHandle1, <span class="number">2</span>, <span class="number">90</span>, <span class="string">&#x27;positive&#x27;</span>, <span class="string">&#x27;all&#x27;</span>, RowEdgeFirst1, ColumnEdgeFirst1, AmplitudeFirst1, RowEdgeSecond1, ColumnEdgeSecond1, AmplitudeSecond1, IntraDistance1, InterDistance1)</span><br><span class="line">        measure_pairs (ImageCheck, MeasureHandle2, <span class="number">2</span>, <span class="number">90</span>, <span class="string">&#x27;positive&#x27;</span>, <span class="string">&#x27;all&#x27;</span>, RowEdgeFirst2, ColumnEdgeFirst2, AmplitudeFirst2, RowEdgeSecond2, ColumnEdgeSecond2, AmplitudeSecond2, IntraDistance2, InterDistance2)</span><br><span class="line">        close_measure (MeasureHandle1)</span><br><span class="line">        close_measure (MeasureHandle2)</span><br><span class="line">        count_seconds (S4)</span><br><span class="line">        dev_set_color (<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">        disp_line (WindowHandle, RowEdgeFirst1 - RectLength2 * cos(AngleCheck), ColumnEdgeFirst1 - RectLength2 * sin(AngleCheck), RowEdgeFirst1 + RectLength2 * cos(AngleCheck), ColumnEdgeFirst1 + RectLength2 * sin(AngleCheck))</span><br><span class="line">        disp_line (WindowHandle, RowEdgeSecond1 - RectLength2 * cos(AngleCheck), ColumnEdgeSecond1 - RectLength2 * sin(AngleCheck), RowEdgeSecond1 + RectLength2 * cos(AngleCheck), ColumnEdgeSecond1 + RectLength2 * sin(AngleCheck))</span><br><span class="line">        disp_line (WindowHandle, RowEdgeFirst2 - RectLength2 * cos(AngleCheck), ColumnEdgeFirst2 - RectLength2 * sin(AngleCheck), RowEdgeFirst2 + RectLength2 * cos(AngleCheck), ColumnEdgeFirst2 + RectLength2 * sin(AngleCheck))</span><br><span class="line">        disp_line (WindowHandle, RowEdgeSecond2 - RectLength2 * cos(AngleCheck), ColumnEdgeSecond2 - RectLength2 * sin(AngleCheck), RowEdgeSecond2 + RectLength2 * cos(AngleCheck), ColumnEdgeSecond2 + RectLength2 * sin(AngleCheck))</span><br><span class="line">        dev_set_line_width (<span class="number">1</span>)</span><br><span class="line">        NumLeads := |IntraDistance1| + |IntraDistance2|</span><br><span class="line">        MinDistance := min([InterDistance1,InterDistance2])</span><br><span class="line">        dev_set_window (WindowHandleText)</span><br><span class="line">        dev_set_part (<span class="number">0</span>, <span class="number">0</span>, <span class="number">119</span>, Width - <span class="number">1</span>)</span><br><span class="line">        dev_clear_window ()</span><br><span class="line">        disp_message (WindowHandleText, <span class="string">&#x27;Matching: Time: &#x27;</span> + ((S2 - S1) * <span class="number">1000</span>)$<span class="string">&#x27;5.2f&#x27;</span> + <span class="string">&#x27;ms , Score: &#x27;</span> + Score$<span class="string">&#x27;7.5f&#x27;</span>, <span class="string">&#x27;image&#x27;</span>, <span class="number">20</span>, <span class="number">20</span>, <span class="string">&#x27;green&#x27;</span>, <span class="string">&#x27;false&#x27;</span>)</span><br><span class="line">        disp_message (WindowHandleText, <span class="string">&#x27;Measure:  Time: &#x27;</span> + ((S4 - S3) * <span class="number">1000</span>)$<span class="string">&#x27;5.2f&#x27;</span> + <span class="string">&#x27; ms, Num. leads: &#x27;</span> + NumLeads$<span class="string">&#x27;2d&#x27;</span>, <span class="string">&#x27;image&#x27;</span>, <span class="number">50</span>, <span class="number">20</span>, <span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;false&#x27;</span>)</span><br><span class="line">        disp_message (WindowHandleText, <span class="string">&#x27;          Min. lead dist: &#x27;</span> + MinDistance$<span class="string">&#x27;6.3f&#x27;</span>, <span class="string">&#x27;image&#x27;</span>, <span class="number">80</span>, <span class="number">20</span>, <span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;false&#x27;</span>)</span><br><span class="line">    <span class="function">endif</span></span><br><span class="line"><span class="function">    <span class="title">dev_error_var</span> (<span class="params">Error, <span class="number">1</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">dev_set_check</span> (<span class="params"><span class="string">&#x27;~give_error&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">get_mposition</span> (<span class="params">WindowHandle, R, C, Button</span>)</span></span><br><span class="line"><span class="function">    <span class="title">dev_error_var</span> (<span class="params">Error, <span class="number">0</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">dev_set_check</span> (<span class="params"><span class="string">&#x27;give_error&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">if</span> (<span class="params">Error != H_MSG_TRUE</span>)</span></span><br><span class="line"><span class="function">        Button :</span>= <span class="number">0</span></span><br><span class="line">    <span class="function">endif</span></span><br><span class="line"><span class="function">endwhile</span></span><br><span class="line"><span class="function"><span class="title">dev_set_window</span> (<span class="params">WindowHandleText</span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_close_window</span> ()</span></span><br><span class="line"><span class="function"><span class="title">clear_shape_model</span> (<span class="params">ModelID</span>)</span></span><br><span class="line"><span class="function"><span class="title">close_framegrabber</span> (<span class="params">FGHandle</span>)</span></span><br></pre></td></tr></table></figure>



<h3 id="④测量弧形边缘宽度的过程"><a href="#④测量弧形边缘宽度的过程" class="headerlink" title="④测量弧形边缘宽度的过程"></a>④测量弧形边缘宽度的过程</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240714122503803.png" alt="image-20240714122503803"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">*形成测量弧形</span><br><span class="line">disp_arc (WindowHandle, Row, Column, AngleExtent, RowPoint, ColPoint)</span><br><span class="line">gen_measure_arc( : : CenterRow, CenterCol, Radius, AngleStart, AngleExtent, AnnulusRadius, Width, Height, Interpolation : MeasureHandle)</span><br><span class="line"></span><br><span class="line">*进行边缘测量</span><br><span class="line">measure_pos(Image : : MeasureHandle, Sigma, Threshold, Transition, Select : RowEdge, ColumnEdge, Amplitude, Distance)</span><br><span class="line">    </span><br><span class="line">*释放测量弧形</span><br><span class="line">close_measure(MeasureHandle)</span><br></pre></td></tr></table></figure>

<p>例程：<code>measure_arc.hdev</code></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">*  Example <span class="keyword">for</span> the application of the measure package</span><br><span class="line">* including a lot of visualization operators</span><br><span class="line">* </span><br><span class="line">read_image (Zeiss1, <span class="string">&#x27;zeiss1&#x27;</span>)</span><br><span class="line">get_image_size (Zeiss1, Width, Height)</span><br><span class="line">dev_close_window ()</span><br><span class="line">dev_open_window (<span class="number">0</span>, <span class="number">0</span>, Width / <span class="number">2</span>, Height / <span class="number">2</span>, <span class="string">&#x27;black&#x27;</span>, WindowHandle)</span><br><span class="line">set_display_font (WindowHandle, <span class="number">14</span>, <span class="string">&#x27;mono&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="string">&#x27;false&#x27;</span>)</span><br><span class="line">dev_display (Zeiss1)</span><br><span class="line">disp_continue_message (WindowHandle, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span>)</span><br><span class="line">stop ()</span><br><span class="line">* draw_circle (WindowHandle, Row, Column, Radius)</span><br><span class="line">Row := <span class="number">275</span></span><br><span class="line">Column := <span class="number">335</span></span><br><span class="line">Radius := <span class="number">107</span></span><br><span class="line">AngleStart := -rad(<span class="number">55</span>)</span><br><span class="line">AngleExtent := rad(<span class="number">170</span>)</span><br><span class="line">dev_set_draw (<span class="string">&#x27;fill&#x27;</span>)</span><br><span class="line">dev_set_color (<span class="string">&#x27;green&#x27;</span>)</span><br><span class="line">dev_set_line_width (<span class="number">1</span>)</span><br><span class="line">get_points_ellipse (AngleStart + AngleExtent, Row, Column, <span class="number">0</span>, Radius, Radius, RowPoint, ColPoint)</span><br><span class="line">disp_arc (WindowHandle, Row, Column, AngleExtent, RowPoint, ColPoint)</span><br><span class="line">dev_set_line_width (<span class="number">3</span>)</span><br><span class="line">gen_measure_arc (Row, Column, Radius, AngleStart, AngleExtent, <span class="number">10</span>, Width, Height, <span class="string">&#x27;nearest_neighbor&#x27;</span>, MeasureHandle)</span><br><span class="line">disp_continue_message (WindowHandle, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span>)</span><br><span class="line">stop ()</span><br><span class="line">count_seconds (Seconds1)</span><br><span class="line">n := <span class="number">10</span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">1</span> to n <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line">    measure_pos (Zeiss1, MeasureHandle, <span class="number">1</span>, <span class="number">10</span>, <span class="string">&#x27;all&#x27;</span>, <span class="string">&#x27;all&#x27;</span>, RowEdge, ColumnEdge, Amplitude, Distance)</span><br><span class="line"><span class="function">endfor</span></span><br><span class="line"><span class="function"><span class="title">count_seconds</span> (<span class="params">Seconds2</span>)</span></span><br><span class="line"><span class="function">Time :</span>= (Seconds2 - Seconds1) / <span class="function">n</span></span><br><span class="line"><span class="function"><span class="title">disp_continue_message</span> (<span class="params">WindowHandle, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function">* <span class="title">stop</span> ()</span></span><br><span class="line"><span class="function"><span class="title">distance_pp</span> (<span class="params">RowEdge[<span class="number">1</span>], ColumnEdge[<span class="number">1</span>], RowEdge[<span class="number">2</span>], ColumnEdge[<span class="number">2</span>], IntermedDist</span>)</span></span><br><span class="line"><span class="function">* <span class="title">dev_display</span> (<span class="params">Zeiss1</span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_set_color</span> (<span class="params"><span class="string">&#x27;red&#x27;</span></span>)</span></span><br><span class="line"><span class="function">* <span class="title">disp_circle</span> (<span class="params">WindowHandle, RowEdge, ColumnEdge, RowEdge - RowEdge + <span class="number">1</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">disp_line</span> (<span class="params">WindowHandle, RowEdge[<span class="number">1</span>], ColumnEdge[<span class="number">1</span>], RowEdge[<span class="number">2</span>], ColumnEdge[<span class="number">2</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_set_color</span> (<span class="params"><span class="string">&#x27;yellow&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">disp_message</span> (<span class="params">WindowHandle, <span class="string">&#x27;Distance: &#x27;</span> + IntermedDist, <span class="string">&#x27;image&#x27;</span>, <span class="number">250</span>, <span class="number">80</span>, <span class="string">&#x27;yellow&#x27;</span>, <span class="string">&#x27;false&#x27;</span></span>)</span></span><br><span class="line"><span class="function">* <span class="title">dump_window</span> (<span class="params">WindowHandle, <span class="string">&#x27;tiff_rgb&#x27;</span>, <span class="string">&#x27;C:\\Temp\\zeiss_result&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">close_measure</span> (<span class="params">MeasureHandle</span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_set_line_width</span> (<span class="params"><span class="number">1</span></span>)</span></span><br><span class="line"><span class="function">* <span class="title">disp_continue_message</span> (<span class="params">WindowHandle, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">stop</span> ()</span></span><br><span class="line"><span class="function"><span class="title">dev_clear_window</span> ()</span></span><br></pre></td></tr></table></figure>



<h3 id="⑤边缘轮廓拟合的方法"><a href="#⑤边缘轮廓拟合的方法" class="headerlink" title="⑤边缘轮廓拟合的方法"></a>⑤边缘轮廓拟合的方法</h3><p><strong>拟合就是为了得到各种想要的参数</strong></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">*读入图像并且预处理</span><br><span class="line"></span><br><span class="line">*亚像素边缘提取</span><br><span class="line">edges_sub_pix(Image : Edges : Filter, Alpha, Low, High : )</span><br><span class="line">*从输入图像Image中以亚像素精度提取阈值为Threshold的水平交叉线</span><br><span class="line">*提取的水平交叉线以XLD轮廓的形式返回到Border中</span><br><span class="line">*threshold_sub_pix不返回区域</span><br><span class="line">*而是返回将灰度值低于Threshold的区域与灰度值高于Threshold的区域分隔开的线条。</span><br><span class="line">threshold_sub_pix(Image : Border : Threshold : )</span><br><span class="line"></span><br><span class="line">*根据具体需求对轮廓进行处理</span><br><span class="line">*例如：分割轮廓</span><br><span class="line">segment_contours_xld(Contours : ContoursSplit : Mode, SmoothCont, MaxLineDist1, MaxLineDist2 : )</span><br><span class="line">*例如：联合轮廓</span><br><span class="line">*联合共圆的轮廓</span><br><span class="line">union_cocircular_contours_xld(Contours : UnionContours : MaxArcAngleDiff, MaxArcOverlap, MaxTangentAngle, MaxDist, MaxRadiusDiff, MaxCenterDist, MergeSmallContours, Iterations : )</span><br><span class="line">*联合临近的轮廓</span><br><span class="line">union_adjacent_contours_xld(Contours : UnionContours : MaxDistAbs, MaxDistRel, Mode : )</span><br><span class="line">*联合直线的轮廓</span><br><span class="line">union_collinear_contours_xld(Contours : UnionContours : MaxDistAbs, MaxDistRel, MaxShift, MaxAngle, Mode : )</span><br><span class="line"></span><br><span class="line">*拟合轮廓（其实就是用一条边缘 拟合出最符合的形状）（校正形状）</span><br><span class="line">*圆形拟合</span><br><span class="line">fit_circle_contour_xld(Contours : : Algorithm, MaxNumPoints, MaxClosureDist, ClippingEndPoints, Iterations, ClippingFactor : Row, Column, Radius, StartPhi, EndPhi, PointOrder)</span><br><span class="line">*椭圆拟合</span><br><span class="line">fit_ellipse_contour_xld(Contours : : Algorithm, MaxNumPoints, MaxClosureDist, ClippingEndPoints, VossTabSize, Iterations, ClippingFactor : Row, Column, Phi, Radius1, Radius2, StartPhi, EndPhi, PointOrder)</span><br><span class="line">    </span><br><span class="line">*根据得到的参数画出图形</span><br><span class="line">gen_circle_contour_xld</span><br><span class="line">gen_ellipse_contour_xld</span><br><span class="line"></span><br><span class="line">*距离计算</span><br></pre></td></tr></table></figure>

<p>例程：<code>circles.hdev</code></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">read_image (Image, <span class="string">&#x27;double_circle&#x27;</span>)</span><br><span class="line">* </span><br><span class="line">* <span class="function">Init window</span></span><br><span class="line"><span class="function"><span class="title">dev_close_window</span> ()</span></span><br><span class="line"><span class="function"><span class="title">get_image_size</span> (<span class="params">Image, Width, Height</span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_open_window</span> (<span class="params"><span class="number">0</span>, <span class="number">0</span>, Width, Height, <span class="string">&#x27;black&#x27;</span>, WindowHandle</span>)</span></span><br><span class="line"><span class="function">* </span></span><br><span class="line"><span class="function">* Segment a region containing the edges</span></span><br><span class="line"><span class="function"><span class="title">fast_threshold</span> (<span class="params">Image, Region, <span class="number">0</span>, <span class="number">120</span>, <span class="number">7</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">boundary</span> (<span class="params">Region, RegionBorder, <span class="string">&#x27;inner&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">clip_region_rel</span> (<span class="params">RegionBorder, RegionClipped, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">dilation_circle</span> (<span class="params">RegionClipped, RegionDilation, <span class="number">2.5</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">reduce_domain</span> (<span class="params">Image, RegionDilation, ImageReduced</span>)</span></span><br><span class="line"><span class="function">* </span></span><br><span class="line"><span class="function">* In the subdomain of the image containing the edges,</span></span><br><span class="line"><span class="function">* extract subpixel precise edges.</span></span><br><span class="line"><span class="function"><span class="title">edges_sub_pix</span> (<span class="params">ImageReduced, Edges, <span class="string">&#x27;canny&#x27;</span>, <span class="number">2</span>, <span class="number">20</span>, <span class="number">60</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">segment_contours_xld</span> (<span class="params">Edges, ContoursSplit, <span class="string">&#x27;lines_circles&#x27;</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">count_obj</span> (<span class="params">ContoursSplit, Number</span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_display</span> (<span class="params">Image</span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_set_draw</span> (<span class="params"><span class="string">&#x27;margin&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_set_color</span> (<span class="params"><span class="string">&#x27;white&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_update_window</span> (<span class="params"><span class="string">&#x27;off&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">for</span> I :</span>= <span class="number">1</span> to Number <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line">    select_obj (ContoursSplit, ObjectSelected, I)</span><br><span class="line">    get_contour_global_attrib_xld (ObjectSelected, <span class="string">&#x27;cont_approx&#x27;</span>, Attrib)</span><br><span class="line">    * <span class="function">Fit a circle to the line segment that are arcs of a circle</span></span><br><span class="line"><span class="function">    <span class="title">if</span> (<span class="params">Attrib &gt; <span class="number">0</span></span>)</span></span><br><span class="line"><span class="function">        <span class="title">fit_circle_contour_xld</span> (<span class="params">ObjectSelected, <span class="string">&#x27;ahuber&#x27;</span>, <span class="number">-1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">2</span>, Row, Column, Radius, StartPhi, EndPhi, PointOrder</span>)</span></span><br><span class="line"><span class="function">        <span class="title">gen_circle_contour_xld</span> (<span class="params">ContCircle, Row, Column, Radius, <span class="number">0</span>, rad(<span class="number">360</span></span>), &#x27;positive&#x27;, 1.0)</span></span><br><span class="line"><span class="function">        <span class="title">dev_display</span> (<span class="params">ContCircle</span>)</span></span><br><span class="line"><span class="function">    endif</span></span><br><span class="line"><span class="function">endfor</span></span><br><span class="line"><span class="function"><span class="title">dev_set_colored</span> (<span class="params"><span class="number">12</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_set_line_width</span> (<span class="params"><span class="number">3</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_display</span> (<span class="params">ContoursSplit</span>)</span></span><br></pre></td></tr></table></figure>

<h3 id="⑥边缘联合"><a href="#⑥边缘联合" class="headerlink" title="⑥边缘联合"></a>⑥边缘联合</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*联合共圆的轮廓</span><br><span class="line">union_cocircular_contours_xld(Contours : UnionContours : MaxArcAngleDiff, MaxArcOverlap, MaxTangentAngle, MaxDist, MaxRadiusDiff, MaxCenterDist, MergeSmallContours, Iterations : )</span><br><span class="line">*联合临近的轮廓</span><br><span class="line">union_adjacent_contours_xld(Contours : UnionContours : MaxDistAbs, MaxDistRel, Mode : )</span><br><span class="line">*联合直线的轮廓</span><br><span class="line">union_collinear_contours_xld(Contours : UnionContours : MaxDistAbs, MaxDistRel, MaxShift, MaxAngle, Mode : )</span><br></pre></td></tr></table></figure>

<p>例程：<code>close_contour_gaps.hdev</code></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">dev_close_window ()</span><br><span class="line">dev_update_window (<span class="string">&#x27;off&#x27;</span>)</span><br><span class="line">* ****</span><br><span class="line">* step: create synthetic image</span><br><span class="line">* ****</span><br><span class="line">gen_rectangle1 (Rectangle, <span class="number">30</span>, <span class="number">20</span>, <span class="number">100</span>, <span class="number">100</span>)</span><br><span class="line">region_to_bin (Rectangle, BinImage, <span class="number">130</span>, <span class="number">100</span>, <span class="number">120</span>, <span class="number">130</span>)</span><br><span class="line">rectangle1_domain (BinImage, ImageReduced, <span class="number">20</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">52</span>)</span><br><span class="line">mean_image (ImageReduced, SmoothedImage, <span class="number">15</span>, <span class="number">15</span>)</span><br><span class="line">paint_gray (SmoothedImage, BinImage, Image)</span><br><span class="line">get_image_size (Image, Width, Height)</span><br><span class="line">dev_open_window_fit_image (Image, <span class="number">0</span>, <span class="number">0</span>, Width, Height, WindowID)</span><br><span class="line">dev_set_draw (<span class="string">&#x27;margin&#x27;</span>)</span><br><span class="line">dev_set_line_width (<span class="number">3</span>)</span><br><span class="line">dev_display (Image)</span><br><span class="line">stop ()</span><br><span class="line">* ****</span><br><span class="line">* step: create contours</span><br><span class="line">* ****</span><br><span class="line">rectangle1_domain (Image, ImageReduced, <span class="number">5</span>, <span class="number">5</span>, <span class="number">125</span>, <span class="number">115</span>)</span><br><span class="line">edges_sub_pix (ImageReduced, Edges, <span class="string">&#x27;lanser2&#x27;</span>, <span class="number">1.1</span>, <span class="number">22</span>, <span class="number">30</span>)</span><br><span class="line">dev_display (Image)</span><br><span class="line">dev_display (Edges)</span><br><span class="line">stop ()</span><br><span class="line">* ****</span><br><span class="line">* step: process contours</span><br><span class="line">* ****</span><br><span class="line">segment_contours_xld (Edges, LineSegments, <span class="string">&#x27;lines&#x27;</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>)</span><br><span class="line">* LineSegments 是用于表示线段的数据类型 </span><br><span class="line">* regress_contours_xld 函数用于将线段进行线性回归，得到最佳拟合的直线</span><br><span class="line">* 返回的结果是一个轮廓对象 <span class="function">RegressContours</span></span><br><span class="line"><span class="function"><span class="title">regress_contours_xld</span> (<span class="params">LineSegments, RegressContours, <span class="string">&#x27;no&#x27;</span>, <span class="number">1</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">union_collinear_contours_xld</span> (<span class="params">RegressContours, UnionContours, <span class="number">10</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0.1</span>, <span class="string">&#x27;attr_keep&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">sort_contours_xld</span> (<span class="params">UnionContours, SortedContours, <span class="string">&#x27;upper_left&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="string">&#x27;column&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_display</span> (<span class="params">Image</span>)</span></span><br><span class="line"><span class="function"><span class="title">colored_display</span> (<span class="params">SortedContours, [<span class="string">&#x27;yellow&#x27;</span>,<span class="string">&#x27;white&#x27;</span>,<span class="string">&#x27;white&#x27;</span>,<span class="string">&#x27;yellow&#x27;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_update_window</span> (<span class="params"><span class="string">&#x27;on&#x27;</span></span>)</span></span><br></pre></td></tr></table></figure>

<h3 id="⑦预处理"><a href="#⑦预处理" class="headerlink" title="⑦预处理"></a>⑦预处理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">预处理方法有：</span><br><span class="line">1.去噪声</span><br><span class="line"></span><br><span class="line">2.增强</span><br><span class="line">对灰度进行缩放</span><br><span class="line">对图像灰度进行腐蚀</span><br></pre></td></tr></table></figure>

<h3 id="⑧同心度"><a href="#⑧同心度" class="headerlink" title="⑧同心度"></a>⑧同心度</h3><p><a target="_blank" rel="noopener" href="https://www.baidu.com/s?wd=%E5%90%8C%E5%BF%83%E5%BA%A6&tn=15007414_5_dg&usm=1&ie=utf-8&rsv_pq=d062dccf034035f9&oq=%E5%90%8C%E5%BF%83%E5%BA%A6%E6%98%AF%E4%BB%80%E4%B9%88&rsv_t=8408LTBWcCinLnPchVIsiPVKt5MCTtX00veggCco6X4gXiSKi+h33qrxU6cJvfNkPcwVXg&sa=re_dqa_zy">同心度</a>是评价‌<a target="_blank" rel="noopener" href="https://www.baidu.com/s?wd=%E5%9C%86%E6%9F%B1%E5%BD%A2%E5%B7%A5%E4%BB%B6&tn=15007414_5_dg&usm=1&ie=utf-8&rsv_pq=d062dccf034035f9&oq=%E5%90%8C%E5%BF%83%E5%BA%A6%E6%98%AF%E4%BB%80%E4%B9%88&rsv_t=8408LTBWcCinLnPchVIsiPVKt5MCTtX00veggCco6X4gXiSKi+h33qrxU6cJvfNkPcwVXg&sa=re_dqa_zy">圆柱形工件</a>的一项重要技术指标，它指的是圆心的偏移程度，是同轴度的特殊形式。</p>
<h2 id="30、一维码"><a href="#30、一维码" class="headerlink" title="30、一维码"></a>30、一维码</h2><h3 id="①理论介绍"><a href="#①理论介绍" class="headerlink" title="①理论介绍"></a>①理论介绍</h3><p>窄单元（条纹或间隔）表示逻辑值“0”</p>
<p>宽单元（条纹或间隔）表示逻辑值“1”</p>
<p>宽单元通常是窄单元的2~3倍。</p>
<p>条码码制即指条码条和空的排列规则</p>
<p>常用的一维码的码制包括：EAN码、39码、交叉25码、UPC码、128码、93码，及Codabar（库德巴码）等。</p>
<p>不同的码制有它们各自的应用领域</p>
<ol>
<li><p>EAN 码：是国际通用的符号体系，是一种长度固定、无含意的条码，所表达的信息全部为数字，主要应用于商品标识</p>
</li>
<li><p>39码和128码：为目前国内企业内部自定义码制，可以根据需要确定条码的长度和信息，它编码的信息可以是数字，也可以包含字母，主要应用于工业生产线领域、图书管理等　　</p>
</li>
<li><p>93码：是一种类似于39码的条码，它的密度较高，能够替代39码　　</p>
</li>
<li><p>25码：只要应用于包装、运输以及国际航空系统的机票顺序编号等　　</p>
</li>
<li><p>Codabar码：应用于血库、图书馆、包裹等的跟踪管理</p>
</li>
</ol>
<p>将 Code 39 条形码转换为 Code 32 条形码可以扩展可编码的字符范围，使得条形码可以包含更多类型的数据</p>
<p><code>convert_decoded_string_code39_to_code32( : : DecodedDataStringCode39 : ConvertedDataStringCode32)</code></p>
<h3 id="②识别的过程"><a href="#②识别的过程" class="headerlink" title="②识别的过程"></a>②识别的过程</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">*创建一维码识别模板</span><br><span class="line">create_bar_code_model( : : GenParamNames, GenParamValues : BarCodeHandle)</span><br><span class="line"></span><br><span class="line">*设置一维码识别模板选择的参数</span><br><span class="line">set_bar_code_param( : : BarCodeHandle, GenParamNames, GenParamValues : )</span><br><span class="line"></span><br><span class="line">*在图像中检测和读取条形码符号</span><br><span class="line">find_bar_code(Image : SymbolRegions : BarCodeHandle, CodeType : DecodedDataStrings)</span><br><span class="line"></span><br><span class="line">*获得条形码的信息</span><br><span class="line">*得到条码符号的解码过程中的信息</span><br><span class="line">get_bar_code_result( : : BarCodeHandle, CandidateHandle, ResultName : BarCodeResults)</span><br><span class="line">*得到条码符号的解码过程中的对象</span><br><span class="line">get_bar_code_object( : BarCodeObjects : BarCodeHandle, CandidateHandle, ObjectName : )</span><br><span class="line">*得到条码符号的解码过程中的参数</span><br><span class="line">get_bar_code_param( : : BarCodeHandle, GenParamNames : GenParamValues)</span><br></pre></td></tr></table></figure>

<h3 id="③一维码识别算子的一些参数的解释"><a href="#③一维码识别算子的一些参数的解释" class="headerlink" title="③一维码识别算子的一些参数的解释"></a>③一维码识别算子的一些参数的解释</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240716112143489.png" alt="image-20240716112143489"></p>
<p>（1） 在Halcon中，<code>set_bar_code_param</code>函数用于设置条形码参数。具体而言，<code>&#39;check_char&#39;</code>参数用于设置条形码中的校验字符（Check Character）的要求。</p>
<ol>
<li><code>set_bar_code_param(BarCodeHandle, &#39;check_char&#39;, &#39;absent&#39;)</code>：这行代码将<code>BarCodeHandle</code>对应的条形码对象的校验字符要求设置为“absent”（缺失）。这意味着条形码中的校验字符可以被省略，即不强制要求存在校验字符。</li>
<li><code>set_bar_code_param(BarCodeHandle, &#39;check_char&#39;, &#39;present&#39;)</code>：这行代码将<code>BarCodeHandle</code>对应的条形码对象的校验字符要求设置为“present”（存在）。这意味着条形码中的校验字符是必需的，即要求条形码中包含校验字符。</li>
</ol>
<p>（2）<code> element_size_variable</code>它用于控制条形码读取器在处理某些具有形变的条形码图像时的行为。</p>
<p>这些形变可能是由于透视投影或条形码所打印的表面的形变（例如瓶子上的桶形畸变）引起的。</p>
<p>默认情况下，条形码读取器无法处理此类形变。</p>
<p>然而，如果将 <code> element_size_variable</code>设置为 <code>true</code>，条形码读取器会尝试对这些形变进行补偿。</p>
<p>（3） <code>majority_voting</code> 的参数，它控制解码结果的选择模式。</p>
<p>如果该参数的值为 <code>false</code>，那么当找到最小数量的相同解码扫描线时，将返回一个成功的解码结果。</p>
<p>如果将该参数设置为<code>true</code>，将使用多数投票方案来在不同的扫描线结果之间进行选择，由大多数扫描线解码的结果将被选为最终结果。</p>
<p>请注意，将该参数设置为 <code>true</code> 会导致运行时间略微增加，因为需要考虑几乎所有的扫描线，而不仅仅是最小相同的扫描线。该参数仅对非堆叠条形码类型支持。</p>
<p>为了减少错误的解码结果，建议启用该参数。</p>
<p>（4） <code>persistence</code> 是一个控制条形码模型是否在解码过程中存储一些中间结果的参数。</p>
<p>当将  <code>persistence</code> 设置为 1 时，模型会存储一些中间结果，以便进行条形码打印质量评估（使用 ‘get_bar_code_result’ 和 ‘quality_isoiec15416’）或检查解码扫描线（使用 ‘get_bar_code_object’ 和 ‘scanlines_all’ 或 ‘scanlines_valid’）。启用<code>persistence</code>  模式会增加条形码模型结构的内存需求。</p>
<p>默认情况下，它的值是 0，这意味着模型不会存储中间结果。</p>
<p>（5）<code>meas_param_estimation</code> 是一个控制条形码阅读器是否使用参数估计来处理候选区域的参数。</p>
<p>当 <code>meas_param_estimation</code>设置为 <code>false</code> 时，扫描线上的灰度值会根据参数 <code>element_size_min</code> 的值进行平滑处理。简单来说，灰度值的变化会被平滑处理，以减少噪声对解码的影响。这在处理大多数情况下是有效的。</p>
<p>当 <code>meas_param_estimation</code>设置为 <code>true</code>  时，条形码阅读器会使用不同的方法。它会估计每个条形码候选区域的元素大小，并在候选处理过程中使用该估计值。<strong>这对于条形码元素非常小（小于1.5个像素）的情况特别有用</strong>。通过估计元素大小，可以更好地适应小尺寸的条形码，提高解码的准确性。</p>
<p>默认情况下，<code>meas_param_estimation</code>的值是 <code>false</code>，这意味着条形码阅读器将使用平滑处理的方法。如果您的条形码具有非常小的元素大小，并且您希望利用参数估计的方法来处理候选区域，您可以将 <code>meas_param_estimation</code>设置为 <code>true</code> 。</p>
<p>注意，启用参数估计的方法会稍微增加运行时间，因为需要进行更复杂的处理步骤来估计元素大小。</p>
<p>（6）<code>meas_thresh_abs</code> 是一个用于防止在图像区域中没有或只有非常小的灰度值动态范围（例如，在所有灰度值接近255的白色区域）时，基于<code>meas_thresh</code> 计算出不合理小的边缘检测阈值的参数。</p>
<p><strong>就是为了把边缘变化明显的才提取出来，不明显的就不提取</strong></p>
<p>通常情况下，如果基于 <code>meas_thresh</code> 计算出的阈值比 <code>meas_thresh_abs</code> 的值更小，那么将使用 <code>meas_thresh_abs</code> 作为阈值。这是为了防止误检测，因为在上述情况下，使用较小的阈值可能会导致大量错误的边缘检测结果。</p>
<p>默认情况下，<code>meas_thresh_abs</code> 的值为 5.0。对于噪声水平较高的图像，可能需要使用更大的值。</p>
<p>在无噪声且对比度非常弱的图像中，该参数可能会干扰对真实边缘的检测，因此可能需要减小或完全禁用它，将其设置为 0.0</p>
<p><code>meas_thresh_abs</code>  值范围是 [0.0 … 10.0]。您可以根据图像的噪声水平和对比度情况来调整该值，以获得准确的边缘检测结果。</p>
<p>（7）<code>stop_after_result_num</code> 是一个控制解码过程何时停止的参数。它表示成功解码的条形码数量达到一定值后，解码过程将停止。</p>
<p>通常情况下，如果预先知道期望的条形码数量，可以设置该参数。</p>
<p>这样，当找到一定数量的条形码后，条形码阅读器可以终止进一步的解码过程，从而减少整体的解码时间。</p>
<p>默认情况下，<code>stop_after_result_num</code> 的值是 0，表示不设置解码停止条件，解码过程将解码所有的候选区域。</p>
<p> <code>stop_after_result_num</code> 值范围是 [0, 1, 2, …]。您可以根据预期的条形码数量来设置该值，以控制解码过程的停止时机。例如，如果预期只有一个条形码，您可以将 <code>stop_after_result_num</code> 设置为 1，以在找到一个条形码后停止解码过程。</p>
<p>（8）<code>check_char</code> 是一个控制条形码解码过程中如何处理校验字符的参数。</p>
<p>某些条形码类型（例如Code 39、Codabar、2&#x2F;5 Industrial和2&#x2F;5 Interleaved）可以包含一个可选的校验字符。根据 <code>check_char</code>参数的设置，对这些条形码类型进行解释。</p>
<p>默认设置为 <code>absent</code>，表示假定没有校验字符。在这种情况下，不进行校验，并将<strong>所有字符</strong>作为数据返回。</p>
<p>当 <code>check_char</code> 设置为 <code>present</code> 时，期望存在一个校验字符，并用于验证条形码的正确性。如果校验和不匹配，将不返回条形码结果，并且从数据中<strong>去除校验字符</strong>。</p>
<p>如果不希望去除校验字符，可以使用 <code>preserved</code> 模式，在保留校验字符的同时验证条形码。</p>
<p>请注意，对于必须包含校验字符的条形码类型，始终将其视为  <code>present</code> 模式。这包括Code 128、EAN-8、EAN-13和UPC-A等类型的条形码。</p>
<p>该参数可以使用 ‘set_bar_code_param_specific’ 操作符针对不同类型的条形码进行特定设置。</p>
<p><code>check_char</code>参数的可选值列表为 [‘absent’, ‘present’, ‘preserved’]。</p>
<p>（9）<code>composite_code</code> 是一个用于控制是否解码附加的 2D GS1 Composite Code 组件的参数。</p>
<p>大多数符合 GS1 标准的条形码可以附加一个额外的 2D GS1 Composite Code 组件。</p>
<p>如果将 <code>composite_code</code>  设置为 ‘CC-A&#x2F;B’，则会查找和解码这个 Composite Code 组件。</p>
<p><code>composite_code</code>  设置为 ‘none’，即禁用这个功能。如果搜索的条形码符号没有附加的 Composite Code 组件，那么只返回条形码本身的结果。目前，Composite Code 仅适用于 GS1 DataBar 系列的条形码。</p>
<p>该参数可以使用 ‘set_bar_code_param_specific’ 操作符针对不同类型的条形码进行特定设置。</p>
<p><code>composite_code</code> 参数的可选值列表为 [‘none’, ‘CC-A&#x2F;B’]。</p>
<p>默认情况下，<code>composite_code</code> 的值为 ‘none’，表示不解码附加的 Composite Code 组件</p>
<p>（10）<code>barcode_width_min</code> 是一个用于设置最小条形码宽度的参数。</p>
<p>该参数用于指定条形码的最小宽度。当设置了<code>barcode_width_min</code> 参数时，将启用该参数的训练模式。</p>
<p>训练模式是一种用于调整和优化参数的机制。在这种情况下，通过设置<code>barcode_width_min</code> 参数并启用训练模式，系统会根据当前的条形码图像数据来自动学习并确定一个合适的最小条形码宽度。系统可能会根据训练数据中的条形码图像的特征和要求，自动调整最小宽度的阈值，以适应不同的条形码类型和应用场景。</p>
<p>（11）<code>barcode_height_min</code> 是一个用于设置最小条形码高度的参数。</p>
<p>该参数的值以像素为单位定义。默认值为 -1，表示条形码阅读器会根据其他参数自动确定一个合理的高度。只有在非常扁平或非常高的条形码情况下，可能需要手动调整该参数。</p>
<p>对于高度小于 16 像素的条形码，用户应该手动设置相应的高度。需要注意的是，最小值为 8 像素。如果条形码非常高，即 70 像素或更高，则手动调整到相应的高度可能会加快后续的查找和读取操作速度。</p>
<p><code>barcode_height_min</code> 参数允许您指定条形码图像中的最小高度。这在读取和解码条形码时非常重要，因为条形码的可靠性和准确性与条形码的高度相关。</p>
<p>（12）<code>orientation</code> 代表条形码方向角度的参数</p>
<p><code>orientation_tol</code> 代表的是条形码总的角度范围</p>
<p>（13）<code>contrast_min</code> 是一个用于设置条形码元素的前景与背景之间最小对比度的参数。</p>
<p><code>contrast_min</code> 参数用于定义条形码元素的前景（条纹）与背景之间的最小对比度。设置此参数为大于5的值将帮助操作员优化候选区域的搜索过程。find_bar_code 将拒绝所有对比度值低于<code>contrast_min</code>  的候选区域。因此，设置较高的<code>contrast_min</code>  值将提高 find_bar_code 的运行性能。</p>
<p>但是，请注意，所有对比度值低于 <code>contrast_min</code> 的条形码都将无法被读取。计算的对比度值是为了加快执行时间而进行的近似值。尝试将<code>contrast_min</code> 的阈值设置较低，以找到可能被拒绝的、对比度接近指定 <code>contrast_min</code> 的条形码。</p>
<p>可以选择在 [0, 40, 90, 120, … ] 等范围内的值来设置 ‘contrast_min’。</p>
<p>默认情况下，<code>contrast_min</code>参数的值为 0，表示没有设置最小对比度的要求。这意味着 find_bar_code 将接受任何对比度的条形码进行解码。</p>
<p>（14）<code>num_scanlines</code> 是一个用于设置在扫描（候选）条形码时使用的最大扫描线数的参数。</p>
<p><code>num_scanlines</code> 参数用于定义扫描（候选）条形码时使用的最大扫描线数。</p>
<p>如果未设置 ‘num_scanlines’（参数值为0），则最大扫描线数将在内部确定。</p>
<p>对于所有单行条形码，最大扫描线数为10</p>
<p>对于 GS1 DataBar Stacked Omnidirectional 条形码为20</p>
<p>对于 GS1 DataBar Expanded Stacked 条形码为55。</p>
<p>通过设置此参数，您可以在两种情况下提高性能：</p>
<p><strong>第一种情况</strong>是图像中包含许多错误的候选区域。尽管条形码本身通常在一两个扫描后解码成功（除了堆叠条形码，见下文），但默认情况下，错误的候选区域会使用默认值为10的扫描线进行扫描，这会不必要地增加运行时间。减少扫描线数可以在具有许多错误候选区域的图像中提高性能。作为经验法则，质量较高的图像需要较少的扫描线，而质量较低的图像需要更多的扫描线。对于一般图像，值在2到5之间应该足够。然而，如果减少扫描线数后无法检测到条形码，则需要增加扫描线数。</p>
<p><strong>第二种情况</strong>涉及堆叠条形码（目前包括 GS1 DataBar Stacked、GS1 DataBar Stacked Omnidirectional 和 GS1 DataBar Expanded Stacked）。在这种情况下，会评估所有扫描线，而不是像单行条形码（如Code 128、EAN 13或GS1 DataBar Limited）那样在成功解码后停止扫描。由于扫描扫描线实际上是 find_bar_code 算法中耗时最长的部分之一，调整 <code>num_scanlines</code>  可能会导致重要的性能改进。这对于 GS1 DataBar Expanded Stacked 尤为有效。GS1 DataBar Expanded Stacked 符号可能有多达11行，因此需要55条扫描线来稳定地检测所有行。如果预期只有较少行数的符号，则可以减少 <code>num_scanlines</code> ，保留每行1.5到5条扫描线。</p>
<p>可以使用 set_bar_code_param_specific 操作符针对不同类型的条形码单独设置该参数。</p>
<p>可以选择在 [0, 5, 10, 20 …] 等范围内的值来设置 <code>num_scanlines</code> </p>
<h3 id="④弯曲的条形码的识别方法"><a href="#④弯曲的条形码的识别方法" class="headerlink" title="④弯曲的条形码的识别方法"></a>④弯曲的条形码的识别方法</h3><p>例程：<code>grid_rectification.hdev</code></p>
<p>根据棋盘格的弯曲映射得到Map 然后对图片进行相同的Map处理即可</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">* This example illustrates how to use the operators <span class="keyword">for</span> the grid-rectification.</span><br><span class="line">* </span><br><span class="line">* The following command creates a postscript file</span><br><span class="line">* that contains the rectification grid. This grid must be</span><br><span class="line">* printed. Then it must be mounted <span class="keyword">on</span> the <span class="built_in">object</span> surface.</span><br><span class="line">WidthOfGrid := <span class="number">0.17</span></span><br><span class="line">NumSquares := <span class="number">17</span></span><br><span class="line">create_rectification_grid (WidthOfGrid, NumSquares, <span class="string">&#x27;rectification_grid.ps&#x27;</span>)</span><br><span class="line">* </span><br><span class="line">* Read the image of the <span class="built_in">object</span> wrapped <span class="keyword">by</span> the rectification grid</span><br><span class="line">* <span class="keyword">and</span> reopen the window <span class="keyword">with</span> an appropriate size.</span><br><span class="line">read_image (Image, <span class="string">&#x27;can_with_grid&#x27;</span>)</span><br><span class="line">get_image_size (Image, ImageWidth, ImageHeight)</span><br><span class="line">dev_close_window ()</span><br><span class="line">dev_open_window (<span class="number">0</span>, <span class="number">0</span>, ImageWidth * <span class="number">0.75</span>, ImageHeight * <span class="number">0.75</span>, <span class="string">&#x27;black&#x27;</span>, WindowID1)</span><br><span class="line">dev_display (Image)</span><br><span class="line">dev_update_off ()</span><br><span class="line">set_display_font (WindowID1, <span class="number">14</span>, <span class="string">&#x27;mono&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="string">&#x27;false&#x27;</span>)</span><br><span class="line">* </span><br><span class="line">* </span><br><span class="line">* Part <span class="number">1</span>: Determination of the image map</span><br><span class="line">* The surface to be rectified <span class="keyword">is</span> wrapped <span class="keyword">by</span> a checkered pattern, which</span><br><span class="line">* <span class="keyword">is</span> used to determine the mapping between the distorted image <span class="keyword">and</span></span><br><span class="line">* the rectified image. Note the orientation of the two circular marks. When</span><br><span class="line">* <span class="function"><span class="keyword">in</span> <span class="title">gen_grid_rectification_map</span>() the parameter Rotation <span class="keyword">is</span> &#x27;auto&#x27;, the rectified</span></span><br><span class="line"><span class="function">* image <span class="keyword">is</span> rotated such that the black mark <span class="keyword">is</span> left of the white mark.</span></span><br><span class="line"><span class="function">* </span></span><br><span class="line"><span class="function">* Determine region of interest</span></span><br><span class="line"><span class="function">*确定图像映射的第一部分：确定感兴趣区域和网格点</span></span><br><span class="line"><span class="function">MinContrast :</span>= <span class="number">25</span></span><br><span class="line">Radius := <span class="number">10</span></span><br><span class="line">find_rectification_grid (Image, GridRegion, MinContrast, Radius)</span><br><span class="line">* </span><br><span class="line">dev_display (GridRegion)</span><br><span class="line">disp_message (WindowID1, <span class="string">&#x27;Grid region&#x27;</span>, <span class="string">&#x27;window&#x27;</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span>)</span><br><span class="line">disp_continue_message (WindowID1, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span>)</span><br><span class="line">stop ()</span><br><span class="line">reduce_domain (Image, GridRegion, ImageReduced)</span><br><span class="line">* </span><br><span class="line">* Determine grid points</span><br><span class="line">SigmaSaddlePoints := <span class="number">1.5</span></span><br><span class="line">Threshold := <span class="number">5</span></span><br><span class="line">*saddle_points_sub_pix特别适用于检测角点，即不同强度的区域如象棋棋盘上的黑白方块相接的位置。</span><br><span class="line">*由于角点具有高对比度和特定的形状，因此可以更容易地定位和确定其精确位置。</span><br><span class="line">saddle_points_sub_pix (ImageReduced, <span class="string">&#x27;facet&#x27;</span>, SigmaSaddlePoints, Threshold, Row, Col)</span><br><span class="line">* </span><br><span class="line">dev_set_color (<span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line">*通过指定输入点的坐标（Row，Col），可以生成一个由两条长度为Size的线段组成的轮廓</span><br><span class="line">*这两条线段在输入点处精确相交。线段的方向由Angle确定。生成的十字轮廓存储在Cross参数中。</span><br><span class="line">gen_cross_contour_xld (SaddlePoints, Row, Col, <span class="number">6</span>, <span class="number">0.785398</span>)</span><br><span class="line">dev_display (Image)</span><br><span class="line">dev_display (SaddlePoints)</span><br><span class="line">disp_message (WindowID1, <span class="string">&#x27;Grid points&#x27;</span>, <span class="string">&#x27;window&#x27;</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span>)</span><br><span class="line">disp_continue_message (WindowID1, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span>)</span><br><span class="line">stop ()</span><br><span class="line">* </span><br><span class="line">* Connect points to grid</span><br><span class="line">SigmaConnectGridPoints := <span class="number">0.9</span></span><br><span class="line">MaxDist := <span class="number">5.0</span></span><br><span class="line">GridSpacing := <span class="number">20</span></span><br><span class="line">dev_set_color (<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">connect_grid_points (ImageReduced, ConnectingLines, Row, Col, SigmaConnectGridPoints, MaxDist)</span><br><span class="line">* </span><br><span class="line">dev_display (ConnectingLines)</span><br><span class="line">disp_message (WindowID1, <span class="string">&#x27;Connected grid points&#x27;</span>, <span class="string">&#x27;window&#x27;</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span>)</span><br><span class="line">disp_continue_message (WindowID1, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span>)</span><br><span class="line">stop ()</span><br><span class="line">* </span><br><span class="line">* Determine image map</span><br><span class="line">*用于根据规则网格上的点计算畸变图像与矫正图像之间的映射关系。</span><br><span class="line">*Map：输出的映射数据，可以是多通道图像或矢量场图像</span><br><span class="line">gen_grid_rectification_map (ImageReduced, ConnectingLines, Map, Meshes, GridSpacing, <span class="number">0</span>, Row, Col, <span class="string">&#x27;bilinear&#x27;</span>)</span><br><span class="line">map_image (ImageReduced, Map, ImageMapped)</span><br><span class="line">* </span><br><span class="line">get_image_size (Map, MapWidth, MapHeight)</span><br><span class="line">dev_open_window (<span class="number">0</span>, (ImageWidth * <span class="number">0.75</span>) + <span class="number">12</span>, MapWidth, MapHeight, <span class="string">&#x27;black&#x27;</span>, WindowID2)</span><br><span class="line">set_display_font (WindowID2, <span class="number">14</span>, <span class="string">&#x27;mono&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="string">&#x27;false&#x27;</span>)</span><br><span class="line">dev_display (ImageMapped)</span><br><span class="line">disp_message (WindowID2, <span class="string">&#x27;Rectified grid&#x27;</span>, <span class="string">&#x27;window&#x27;</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span>)</span><br><span class="line">stop ()</span><br><span class="line">* </span><br><span class="line">* </span><br><span class="line">* Part <span class="number">2</span>: Application of the image map</span><br><span class="line">* <span class="function">The original <span class="title">surface</span> (<span class="params">without the checkered pattern</span>) <span class="keyword">is</span> rectified</span></span><br><span class="line"><span class="function">* <span class="keyword">using</span> the previously calculated image map.</span></span><br><span class="line"><span class="function">* </span></span><br><span class="line"><span class="function">* Read <span class="keyword">in</span> the image to be rectified</span></span><br><span class="line"><span class="function"><span class="title">read_image</span> (<span class="params">Image, <span class="string">&#x27;can&#x27;</span></span>)</span></span><br><span class="line"><span class="function">* </span></span><br><span class="line"><span class="function">* Rectify image <span class="keyword">using</span> the previously calculated image map</span></span><br><span class="line"><span class="function"><span class="title">dev_set_window</span> (<span class="params">WindowID2</span>)</span></span><br><span class="line"><span class="function">*使用之前生成的图像映射Map对原始图像进行校正。</span></span><br><span class="line"><span class="function"><span class="title">map_image</span> (<span class="params">Image, Map, ImageMapped</span>)</span></span><br><span class="line"><span class="function">* </span></span><br><span class="line"><span class="function"><span class="title">dev_set_window</span> (<span class="params">WindowID1</span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_display</span> (<span class="params">Image</span>)</span></span><br><span class="line"><span class="function"><span class="title">disp_message</span> (<span class="params">WindowID1, <span class="string">&#x27;Original image&#x27;</span>, <span class="string">&#x27;window&#x27;</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_set_window</span> (<span class="params">WindowID2</span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_display</span> (<span class="params">ImageMapped</span>)</span></span><br><span class="line"><span class="function"><span class="title">disp_message</span> (<span class="params">WindowID2, <span class="string">&#x27;Rectified image&#x27;</span>, <span class="string">&#x27;window&#x27;</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br></pre></td></tr></table></figure>

<h3 id="⑤Halcon联合Vs显示完整的图片区域"><a href="#⑤Halcon联合Vs显示完整的图片区域" class="headerlink" title="⑤Halcon联合Vs显示完整的图片区域"></a>⑤Halcon联合Vs显示完整的图片区域</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">GetImageSize</span>(ho_Image, &amp;hv_Width, &amp;hv_Height);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (HDevWindowStack::<span class="built_in">IsOpen</span>())</span><br><span class="line">	<span class="built_in">SetPart</span>(HDevWindowStack::<span class="built_in">GetActive</span>(), <span class="number">0</span>, <span class="number">0</span>, hv_Height<span class="number">-1</span>, hv_Width<span class="number">-1</span>);</span><br></pre></td></tr></table></figure>



<h2 id="31、二维码"><a href="#31、二维码" class="headerlink" title="31、二维码"></a>31、二维码</h2><h3 id="①理论介绍-1"><a href="#①理论介绍-1" class="headerlink" title="①理论介绍"></a>①理论介绍</h3><p>二维条码：指在一维条码的基础上扩展出另一维具有可读性的条码，使用黑白矩形图案表示二进制数据，被设备扫描后可获取其中所包含的信息。</p>
<p>一维条码的宽度记载着数据，而其长度没有记载数据。<strong>二维条码的长度、宽度均记载着数据</strong>。</p>
<p>二维条码有一维条码没有的“<strong>定位点</strong>”和“<strong>容错机制</strong>”。容错机制在即使没有辨识到全部的条码、或是说条码有污损时，也可以正确地还原条码上的信息。</p>
<p>二维条码的种类很多，不同的机构开发出的二维条码具有不同的结构以及编写、读取方法。堆叠式&#x2F;行排式二维条码，如，Code 16K、Code 49、PDF417等矩阵式二维码，最流行莫过于QR CODE。</p>
<p>二维码存储的数据量更大；可以包含数字、字符，及中文文本等混合内容；有一定的容错性,（在部分损坏以后可以正常读取），空间利用率高等。</p>
<h3 id="②识别的过程-1"><a href="#②识别的过程-1" class="headerlink" title="②识别的过程"></a>②识别的过程</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">*创建二维码识别模板</span><br><span class="line">create_data_code_2d_model( : : SymbolType, GenParamNames, GenParamValues : DataCodeHandle)</span><br><span class="line"></span><br><span class="line">*设置二维码识别模板选择的参数</span><br><span class="line">set_data_code_2d_param( : : DataCodeHandle, GenParamNames, GenParamValues : )</span><br><span class="line"></span><br><span class="line">*在图像中检测和读取二维码符号</span><br><span class="line">find_data_code_2d(Image : SymbolXLDs : DataCodeHandle, GenParamNames, GenParamValues : ResultHandles, DecodedDataStrings)</span><br><span class="line"></span><br><span class="line">*获得二维码的信息</span><br><span class="line">*得到二维码的解码过程中的信息</span><br><span class="line">get_data_code_2d_results( : : DataCodeHandle, CandidateHandle, ResultNames : ResultValues)</span><br><span class="line">*得到条二维码的解码过程中的对象</span><br><span class="line">get_data_code_2d_objects( : DataCodeObjects : DataCodeHandle, CandidateHandle, ObjectName : )</span><br><span class="line">*得到条二维码的解码过程中的参数</span><br><span class="line">get_data_code_2d_param( : : DataCodeHandle, GenParamNames : GenParamValues)</span><br></pre></td></tr></table></figure>

<h3 id="③二维码识别算子的一些参数的解释"><a href="#③二维码识别算子的一些参数的解释" class="headerlink" title="③二维码识别算子的一些参数的解释"></a>③二维码识别算子的一些参数的解释</h3><p>（1）二维码的最小单位是模块</p>
<p> <code>module_gap_*</code> 参数来设置模块之间的间隙：</p>
<p>可以指定相邻的前景模块是否连接在一起，或者它们之间是否存在或可能存在间隙。</p>
<p>如果前景模块是连接在一起并完全填充模块空间的，间隙参数可以设置为 <code>no</code>（无）。</p>
<p>如果两个模块之间存在非常小的间隙，即&lt;模块尺寸的10%，则将该参数设置为 <code>small</code>（小）。</p>
<p>如果间隙较大（相对于模块尺寸而言：&lt;模块尺寸的50%），则可以将其设置为 <code>big</code>（大）。</p>
<p>即使前景模块是连接在一起的，但如果它们在外观上显得较细，比如由于亮光引起的绽放效果，最后两个设置也可能会有用。</p>
<p>如果前景模块只是非常小的点，通常需要对图像进行适当的预处理以检测或放大模块（例如，通过 <code>gray_erosion_shape 或 gray_dilation_shape</code> ）。</p>
<p><code>module_gap_min</code> 表示最小模块间隙，含义是将’module_gap_col_min’和’module_gap_row_min’设置为相同的值。</p>
<p><code>module_gap_max</code> 表示最大模块间隙，含义是将’module_gap_col_max’和’module_gap_row_max’设置为相同的值。</p>
<p>（2）<code>default_parameters</code> 的作用是将模型的所有参数重置为三种基本的默认设置之一：标准（standard）、增强（enhanced）或最大（maximum）。除了参数值之外，模型的训练状态也会被重置。</p>
<p>可选的取值为’standard_recognition’（标准识别）、’enhanced_recognition’（增强识别）和’maximum_recognition’（最大识别）。</p>
<p>默认值是’standard_recognition’（标准识别设置）。</p>
<p>需要注意的是，如果将此参数与其他参数的列表一起设置，那么此参数必须位于列表的第一个位置。</p>
<blockquote>
<p> <strong>maximum_recognition  &gt; enhanced_recognition &gt; standard_recognition</strong></p>
</blockquote>
<p>可以参考例程：<code>2d_data_codes_default_settings.hdev</code></p>
<p>（3）<code>module_size_min</code> 参数用于设置图像中模块的最小尺寸，单位为像素。需要注意的是，为了获得最佳的识别性能，建议将模块的尺寸设置为至少3-4个像素。</p>
<p>取值范围：[1 .. 100]</p>
<p>默认值：6（增强模式下为2，最大模式下为1）</p>
<p><code>module_size_max</code> 参数用于设置图像中模块的最大尺寸，单位为像素。</p>
<p>取值范围：[2 .. 100]</p>
<p>默认值：20（增强模式下为100）</p>
<p><code>module_size</code> 参数用于将<code>module_size_min</code> 和<code>module_size_max</code> 设置为相同的值。</p>
<p>这些参数的作用是控制图像中模块的尺寸范围。模块是指二维码或其他类似的矩阵形式的图像中的小方块或小元素。通过设置最小和最大尺寸，您可以限制模块的大小范围，并根据应用需求进行调整。</p>
<p>例如，如果您将<code>module_size</code> 参数设置为10，那么<code>module_size_min</code> 和<code>module_size_max</code> 将都被设置为10。</p>
<p>这样做的目的是确保模块的尺寸保持一致，以便在图像处理和识别算法中使用。</p>
<p>（4）<code>polarity</code> 参数描述了图像中符号的极性，即参数确定符号是在黑色背景上显示为亮色还是在亮色背景上显示为暗色。</p>
<p>取值：<code>dark_on_light</code>（暗色在亮色背景上）、<code>light_on_dark</code>（亮色在暗色背景上）、<code>any</code>（任意）。</p>
<p>默认值：<code>dark_on_light</code>（增强模式下为’any’）。</p>
<p>这个参数用于指定符号在图像中的颜色对比度。例如，如果您将<code>polarity</code> 参数设置为<code>dark_on_light</code>，那么符号将被假设为在亮色背景上显示为暗色。相反，如果将其设置为<code>light_on_dark</code>，则符号将被假设为在暗色背景上显示为亮色。而选择<code>any</code>选项则表示符号的颜色对比度可以是任意的，即无论背景颜色如何，都能正确处理。</p>
<p>默认情况下，推荐使用<code>dark_on_light</code>作为常规设置，因为大多数二维码和条形码通常在白色背景上显示为黑色。在增强模式下，<code>any</code>选项可以更灵活地处理不同颜色对比度的符号。</p>
<p>（5）<code>mirrored</code> 参数描述了符号是否或可能是镜像的（即交换符号的行和列）。</p>
<p>取值：<code>no</code>（不是镜像）、<code>yes</code>（是镜像）、<code>any</code>（任意）。</p>
<p>默认值：<code>any</code>。</p>
<p>这个参数用于指定符号是否允许镜像或是否可能存在镜像的情况。</p>
<p>如果将<code>mirrored</code>参数设置为<code>no</code>，则表示符号不是镜像的，不允许进行镜像操作。</p>
<p>如果将其设置为<code>yes</code>，则表示符号是镜像的，可以进行镜像操作。</p>
<p>选择<code>any</code>选项则表示符号可能是镜像的，无论是否镜像都可以进行处理。</p>
<p>默认情况下，<code>any</code>选项是推荐设置，因为在某些情况下，符号可能会出现镜像的情况。通过设置为<code>any</code>，可以灵活地处理符号是否镜像的情况。</p>
<p>（6）<code>contrast_min</code> 参数用于设置符号的前景与背景之间的最小对比度（即符号的前景与背景之间的最小梯度）。</p>
<p>取值范围：[1 .. 100]</p>
<p>默认值：30（增强模式下为10）</p>
<p>这个参数用于控制符号前景和背景之间的对比度，即前景元素与背景之间的明暗差异。通过设置最小对比度，可以限制符号的清晰度和可识别性。</p>
<p>取较高的对比度值（例如设置为100），意味着要求前景和背景之间的明暗差异非常明显，符号的清晰度要求更高。</p>
<p>取较低的对比度值（例如设置为1），则意味着允许前景和背景之间的明暗差异非常微弱，符号的清晰度要求较低。</p>
<p>默认情况下，推荐使用较高的对比度值（30）作为常规设置，以确保符号的清晰度和可识别性。在增强模式下，可以使用较低的对比度值（10）以适应更宽范围的图像条件。</p>
<p>（7）<code>symbol_size</code> 是控制整个二维码的大小的</p>
<p>（8）<code>small_modules_robustness</code> 参数用于控制对具有非常小模块尺寸的数据码的解码鲁棒性。</p>
<p>当将参数<code>small_modules_robustness</code> 设置为<code>high</code> 时，增加了解码具有非常小模块尺寸的数据码的可能性。在这种情况下，还应相应地调整最小模块尺寸，即将<code>module_size_min</code> 和 <code>module_width_min</code>（对于PDF417）设置为预期的最小模块尺寸和宽度。</p>
<p>将<code>small_modules_robustness</code> 设置为 <code>high</code> 可能会显著增加find_data_code_2d函数的内存使用量。</p>
<p>参数取值范围：<code>low</code>（低）、<code>high</code> （高）</p>
<p>默认情况下，在常规设置中，推荐将<code>small_modules_robustness</code> 设置为<code>low</code>（低）。这意味着默认情况下，函数将使用较少的内存，并对非常小的模块尺寸的数据码的解码鲁棒性较低。</p>
<p>在增强模式下，也建议将<code>small_modules_robustness</code> 设置为<code>low</code>（低）。</p>
<p>而在最大模式下，可以将<code>small_modules_robustness</code> 设置为<code>high</code> （高）以提高对非常小模块尺寸数据码的解码鲁棒性，但需要注意这会增加内存使用量。</p>
<p>（9）<code>finder_pattern_tolerance</code> 参数用于控制对于有缺陷或部分遮挡的查找图案的容忍度。</p>
<p>查找图案包括L形边和相对的交替边。取决于该参数，在 <code>find_data_code_2d</code> 函数中的符号搜索过程中使用不同的算法。</p>
<p>在一种情况下（ <code>low</code> ），假设查找图案存在且几乎没有任何扰动。</p>
<p>在另一种情况下（<code>high</code>），查找图案可能存在缺陷或部分遮挡，但不会影响符号的识别和读取。</p>
<p>然而，请注意，在这种模式下，应通过使用 <code>set_data_code_2d_param</code> 来尽可能限制符号搜索的参数范围，否则<code>find_data_code_2d</code> 函数的运行时间可能会显著增加。</p>
<p>注意，这两种算法在鲁棒性方面略有差异。这可能会导致不同的结果，具体取决于<code>finder_pattern_tolerance</code> 的值，即使符号的查找图案没有受到干扰。例如，如果选择了<code>high</code>，则只能找到具有等距模块网格的符号，因此对于透视畸变的鲁棒性会降低。最后，如果将<code>finder_pattern_tolerance</code> 设置为<code>any</code>，则两种算法都会应用。</p>
<p>参数取值范围： <code>low</code> （低）、<code>high</code>（高）、<code>any</code>（任意）</p>
<p>默认情况下，在常规设置中，推荐将<code>finder_pattern_tolerance</code> 设置为 <code>low</code> （低）。这意味着默认情况下，假设查找图案存在且几乎没有扰动。</p>
<p>在增强模式下，也建议将<code>finder_pattern_tolerance</code> 设置为 <code>low</code> （低）。</p>
<p>而在最大模式下，可以将<code>finder_pattern_tolerance</code> 设置为<code>any</code>（任意），以应用两种算法并提高对于有缺陷或部分遮挡的查找图案的容忍度。</p>
<p>（10）<code>contrast_tolerance</code> 参数用于描述对于局部对比度变化（例如，光晕或反射）的搜索容忍度。</p>
<p>如果将<code>contrast_tolerance</code>设置为<code>high</code>，则在存在强烈的局部对比度变化时可以提高鲁棒性。</p>
<p>如果将<code>contrast_tolerance</code>设置为<code>low</code>，则算法在存在强烈的局部对比度变化时的鲁棒性较低，但速度较快，并且仍然能够在正常情况下处理对比度变化，因此在大多数情况下应使用该选项。</p>
<p>如果将<code>contrast_tolerance</code>设置为<code>any</code>，则会应用两种算法。</p>
<p>参数取值范围：<code>low</code>（低）、<code>high</code>（高）、<code>any</code>（任意）</p>
<p>默认情况下，在常规设置中，推荐将<code>contrast_tolerance</code>设置为<code>low</code>（低）。这意味着默认情况下，算法在强烈的局部对比度变化下的鲁棒性较低，但速度较快，并且仍然能够处理正常情况下的对比度变化。</p>
<p>在增强模式下，也建议将<code>contrast_tolerance</code>设置为<code>low</code>（低）。</p>
<p>而在最大模式下，可以将<code>contrast_tolerance</code>设置为<code>any</code>（任意），以应用两种算法并提高在存在强烈的局部对比度变化时的鲁棒性。</p>
<p>（11）<code>strict_quiet_zone</code> 参数用于控制 <code>find_data_code_2d</code> 函数在检测到可能可读但在其静默区域中显示缺陷的符号时的行为。</p>
<p>如果将<code>strict_quiet_zone</code> 设置为<code>yes</code>，则会对所有解码的符号的静默区域进行验证，类似于用于打印质量检查的方法。静默区域评分较低的符号不会作为结果返回。它们的 <code>status</code> 将设置为 <code>quiet zone is missing</code>（静默区域缺失）。</p>
<p>如果将<code>strict_quiet_zone</code> 设置为<code>no</code>（默认情况），则所有可读的符号将作为结果返回。</p>
<p>参数取值范围：<code>yes</code>（是）、<code>no</code>（否）</p>
<p>默认情况下，在常规设置中，<code>strict_quiet_zone</code> 参数的默认值为<code>no</code>（否）。这意味着默认情况下，所有可读的符号都将作为结果返回，而不管其静默区域的质量如何。</p>
<h2 id="32、联合相机的sdk开发"><a href="#32、联合相机的sdk开发" class="headerlink" title="32、联合相机的sdk开发"></a>32、联合相机的sdk开发</h2><p>需要拷贝的文件有头文件（include）、链接文件（lib）、dll文件</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">*根据RGB创建一个halcon的三通道图像对象</span><br><span class="line">gen_image3_extern( : Image : Type, Width, Height, PointerRed, PointerGreen, PointerBlue, ClearProc : )</span><br><span class="line">Image（输出对象）：创建的HALCON图像。</span><br><span class="line">Type（输入控制）：像素类型。</span><br><span class="line">Width（输入控制）：图像的宽度。</span><br><span class="line">Height（输入控制）：图像的高度。</span><br><span class="line">PointerRed（输入控制）：指向第一个通道的第一个灰度值的指针。</span><br><span class="line">PointerGreen（输入控制）：指向第二个通道的第一个灰度值的指针。</span><br><span class="line">PointerBlue（输入控制）：指向第三个通道的第一个灰度值的指针。</span><br><span class="line">ClearProc（输入控制）：用于在删除图像对象时释放图像内存的过程。</span><br></pre></td></tr></table></figure>

<h3 id="①vc-图像转为halcon图像"><a href="#①vc-图像转为halcon图像" class="headerlink" title="①vc++图像转为halcon图像"></a>①vc++图像转为halcon图像</h3><p>（1）初始化相机</p>
<p>（2）枚举相机类</p>
<p>（3）设置回调函数</p>
<p>（4）定义回调函数</p>
<p>（5） 基于RGB或者Gray转为halcon图像（ <code>gen_image1_extern</code> 或者 <code>gen_image3_extern</code>  ）</p>
<h3 id="②halcon图像转vc-图像"><a href="#②halcon图像转vc-图像" class="headerlink" title="②halcon图像转vc++图像"></a>②halcon图像转vc++图像</h3><p>（1）在halcon中利用相机助手导出c++代码</p>
<p>（2）使用 <code>GetImagePointer1</code> 或 <code>GetImagePointer3</code> 得到halcon中图像的指针</p>
<p>（3）进行一系列的转换和赋值</p>
<p>（将halcon的 height 和 width转为vc++的数据 并且将 RGB三通道指针 转为 vc++的指针 ）</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240718122325576.png" alt="image-20240718122325576"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240718122308301.png" alt="image-20240718122308301"></p>
<h2 id="33、Vs2022配置Halcon环境"><a href="#33、Vs2022配置Halcon环境" class="headerlink" title="33、Vs2022配置Halcon环境"></a>33、Vs2022配置Halcon环境</h2><h3 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h3><p>选择 <strong>C&#x2F;C++</strong> 下的 <strong>常规</strong> 选项</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240718113714621.png" alt="image-20240718113714621"></p>
<p>将</p>
<p><code>C:\Program Files\MVTec\HALCON-12.0\include</code></p>
<p><code>C:\Program Files\MVTec\HALCON-12.0\include\halconcpp</code></p>
<p>两个目录添加到 <strong>附加包含目录</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240718113839855.png" alt="image-20240718113839855"></p>
<h3 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h3><p>选择 <strong>链接器</strong> 下的 <strong>常规</strong> 选项</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240718114006833.png" alt="image-20240718114006833"></p>
<p>将</p>
<p><code>C:\Program Files\MVTec\HALCON-12.0\lib\x64-win64</code></p>
<p>添加到<strong>附加库目录</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240718114124693.png" alt="image-20240718114124693"></p>
<h3 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h3><p>选择 <strong>链接器</strong> 下的 <strong>输入</strong> 选项</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240718114240903.png" alt="image-20240718114240903"></p>
<p>将</p>
<p><code>halconcpp.lib</code></p>
<p>添加到 <strong>附加依赖项</strong></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240718114444247.png" alt="image-20240718114444247"></p>
<h3 id="第四步"><a href="#第四步" class="headerlink" title="第四步"></a>第四步</h3><p>在  **文件名+Dlg.h ** 的最上方加上</p>
<p><code>#include&quot;HalconCpp.h&quot; using namespace HalconCpp;</code></p>
<h2 id="34、串口通信"><a href="#34、串口通信" class="headerlink" title="34、串口通信"></a>34、串口通信</h2><h3 id="①理论"><a href="#①理论" class="headerlink" title="①理论"></a>①理论</h3><p>（1）串口和并口</p>
<p>串口就是我们的数据是一位一位传输出去的 串口传输效率低，但是传输距离长</p>
<p>并口就是我们的数据通过多条数据线同时传输出去  并口传输的速度快，效率快缺点是长距离传输有困难</p>
<p>（2）同步通信和异步通信</p>
<p>同步通信（SYNC :synchronous data communication)是指在约定的通信速率下，发送端和接收端的时钟信号频率和相位始终保持一致（同步)，这样就保证了通信双方在发送和接收数据时具有完全一致的定时关系。同步通信把许多字符组成一个信息组（信息帧)，每帧的开始用同步字符来指示，一次通信只传送一帧信息。在传输数据的同时还需要传输时钟信号,以便接收方可以用时针信号来确定每个信息位。</p>
<blockquote>
<p>同步通信的<strong>优点</strong>是：</p>
<p>传送信息的位数几乎不受限制，一次通信传输的数据有几十到几千个字节，通信效率较高。</p>
</blockquote>
<blockquote>
<p>同步通信的<strong>缺点</strong>是：</p>
<p>要求在通信中始终保持精确的同步时钟，即发送时钟和接收时钟要严格的同步（常用的做法是两个设备使用同一个时钟源)。打个比喻，同步通信就像两个人实时打电话一样，必须同时实时保搏通话沟通，整个节奏是一致的，就像两个人在同一个指挥棒下通话。</p>
</blockquote>
<p>异步通信（ASYNC:asynchronous data communication)，又称为起止式异步通信,是以字符为单位进行传输的,字符之间没有固定的时间间隔要求，而每个字符中的各位则以固定的时间传送。在异步通信中，收发双方取得同步是通过在字符格式中设置起始位和停止位的方法来实现的。具体来说就是，在一个有效字符正式发送之前，发送器先发送一个起始位，然后发送有效字符位，在字符结束时再发送一个停止位，起始位至停止位构成一帧。停止位至下一个起始位之间是不定长的空闲位，并且规定起始位为低电平（逻辑值为0)，停止位和空闲位都是高电平（逻辑值为1)，这样就保证了起始位开始处一定会有一个下跳沿，由此就可以标志一个字符传输的起始。而根据起始位和停止位也就很容易的实现了字符的界定和同步。</p>
<p>显然，采用异步通信时，发送端和接收端可以由各自的时钟来控制数据的发送和接收，这两个时钟源彼此独立，可以互不同步。再来打个比喻，异步通信就像两个人玩微信语音一样，各自一套自己的机制发送和接收机制，两个人在不同的指挥棒下通话。</p>
<h3 id="②串口通信一般调用步骤"><a href="#②串口通信一般调用步骤" class="headerlink" title="②串口通信一般调用步骤"></a>②串口通信一般调用步骤</h3><p>（1）初始化串口（配置波特率，数据位，校验位，停止位等）</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">CString temp;</span><br><span class="line">CString m_bote=<span class="string">&quot;2400&quot;</span>;</span><br><span class="line">CString m_data=<span class="string">&quot;8&quot;</span>;</span><br><span class="line">CString m_jiaoyan=<span class="string">&quot;None“;</span></span><br><span class="line"><span class="string">CString m_stop=&quot;</span><span class="number">1</span><span class="string">&quot;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">int SelPortNo,SelBaudRate,SelDataBits,SelStopBits;</span></span><br><span class="line"><span class="string">char SelParity;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">temp = &quot;</span>COM6<span class="string">&quot;;</span></span><br><span class="line"><span class="string">temp.Delete(0,3);</span></span><br><span class="line"><span class="string">SelPortNo=atoi(temp);</span></span><br><span class="line"><span class="string">SelBaudRate=atoi(m_bote);</span></span><br><span class="line"><span class="string">SelDataBits=atoi(m_data);</span></span><br><span class="line"><span class="string">SelStopBits=atoi(m_stop);</span></span><br><span class="line"><span class="string">SelParity=m_jiaoyan.GetAt(0);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if(m_SerialPort.InitPort(this,SelPortNo,SelBaudRate,SelDataBits,SelStopBits,EV_RXCHAR|EV_CTS，512))</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    m_SerialPort.StartMonitoring();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    AfxMessageBox(&quot;</span>该串口已经被占用！<span class="string">&quot;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>（2）发送 或 接受 数据</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CString data;</span><br><span class="line">data = <span class="string">&quot;FF 01 00 02 40 00 43&quot;</span>;</span><br><span class="line"><span class="comment">//如果发送的数据是16进制 那么需要进行数据转换</span></span><br><span class="line">data=pMainFrame-&gt;<span class="built_in">ChangeCharstr2Hexstr</span>(data);</span><br><span class="line"><span class="comment">//发送数据</span></span><br><span class="line">PmainFrame-&gt;m_SerialPort.<span class="built_in">WriteToPort</span>(data.<span class="built_in">GetBuffer</span>(data.<span class="built_in">GetLength</span>()),data.<span class="built_in">GetLength</span>());</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CString str;</span><br><span class="line">str.<span class="built_in">Format</span>(<span class="string">&quot;%c&quot;</span>,ch);</span><br><span class="line"><span class="comment">//16进制转换</span></span><br><span class="line">str.<span class="built_in">Format</span>(<span class="string">&quot;%02X&quot;</span>,ch);</span><br><span class="line"></span><br><span class="line">m_ReceiveData+=str;</span><br></pre></td></tr></table></figure>

<p>（3）关闭串口</p>
<h3 id="③halcon串口通信例程"><a href="#③halcon串口通信例程" class="headerlink" title="③halcon串口通信例程"></a>③halcon串口通信例程</h3><p><code>serial.hdev</code></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">*初始化串口</span><br><span class="line">OpSystem := environment(<span class="string">&#x27;OS&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> (OpSystem == <span class="string">&#x27;Windows_NT&#x27;</span>)</span><br><span class="line">    open_serial (<span class="string">&#x27;COM1&#x27;</span>, SerialHandle)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    open_serial (<span class="string">&#x27;/dev/tty&#x27;</span>, SerialHandle)</span><br><span class="line">endif</span><br><span class="line">    </span><br><span class="line">*设置各种参数</span><br><span class="line">set_serial_param (SerialHandle, <span class="number">9600</span>, <span class="number">8</span>, <span class="string">&#x27;none&#x27;</span>, <span class="string">&#x27;none&#x27;</span>, <span class="number">1</span>, <span class="number">1000</span>, <span class="string">&#x27;unchanged&#x27;</span>)</span><br><span class="line"></span><br><span class="line">*发送数据</span><br><span class="line">write_serial (SerialHandle, ords(<span class="string">&#x27;Hello world!\n\r&#x27;</span>))</span><br><span class="line"></span><br><span class="line">*接受数据</span><br><span class="line">read_serial (SerialHandle, <span class="number">10</span>, Data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (|Data| &gt; <span class="number">0</span>)</span><br><span class="line">    Read := chrt(Data)</span><br><span class="line">endif</span><br><span class="line"></span><br><span class="line">*关闭串口</span><br><span class="line">close_serial (SerialHandle)</span><br></pre></td></tr></table></figure>



<h2 id="35、网络通信"><a href="#35、网络通信" class="headerlink" title="35、网络通信"></a>35、网络通信</h2><h3 id="①理论-1"><a href="#①理论-1" class="headerlink" title="①理论"></a>①理论</h3><p>（1）UDP全称为<strong>用户数据报协议</strong>。UDP 为应用程序提供了一种<strong>无需建立连接</strong>就可以发送封装的 IP 数据包的方法</p>
<blockquote>
<p>特点：</p>
<p><strong>无连接</strong>：只知道对端的IP和端口号就可以发送，不需要实现建立连接。(就像寄信)。<br><strong>不可靠</strong>：没有确认机制， 没有重传机制。如果因为网络故障该段无法发到对方， UDP协议层也不会给应用层返回任何错误信息。<br><strong>面向数据报</strong>： 应用层交给UDP多长的报文， UDP原样发送既不会拆分，也不会合并。所以UDP不能够灵活的控制读写数据的次数和数量。<br><strong>UDP存在接收缓冲区，但不存在发送缓冲区</strong>。UDP没有发送缓冲区，在调用send to时会直接将数据交给内核，由内核将数据传给网络层协议进行后续的传输动作。UDP具有接收缓冲区，但是这个接收缓冲区不能保证收到的UDP报文的顺序和发送UDP报的顺序一致，如果缓冲区满了再到达的UDP数据报就会被丢弃。</p>
</blockquote>
<p>（2）TCP全称传输控制协议，必须对数据的传输进行控制</p>
<blockquote>
<p>特点：</p>
<p><strong>面向连接</strong>：必须建立连接</p>
<p><strong>可靠</strong>：可靠传输的话就像你在淘宝跟客服小姐姐聊天，你发出的信息下面会有一个状态就是<strong>未读</strong>或者<strong>已读</strong>这么两个状态，这就代表我发出的消息是已经传输到对方那的，不存在说我消息没有发送过去，在聊天框中会出现这条消息标识为&lt;已读&gt;状态，就是能够感知到消息是否传输过去了（传输失败的时候软件会提醒你的），这就是可靠传输</p>
<p><strong>面向字节流</strong>： TCP和文件操作类型，都是“流”式的（由于这里传输的都是字节，所以称为字节流）</p>
</blockquote>
<h3 id="②TCP服务器端和客户端编写流程"><a href="#②TCP服务器端和客户端编写流程" class="headerlink" title="②TCP服务器端和客户端编写流程"></a>②TCP服务器端和客户端编写流程</h3><blockquote>
<p>服务器端：</p>
<p>1、进行版本协商（WSAStartup）</p>
<p>2、创建一个套接字（socket）</p>
<p>3、将套接字设置为监听状态(listen)</p>
<p>4、接受客户端的发送请求( accept )</p>
<p>5、发送或者接受数据 ( send &#x2F; recv )</p>
<p>6、关闭套接字 ( closesocket ),一次通信结束</p>
<p>7、继续等待接受客户端的发送请求</p>
</blockquote>
<blockquote>
<p>客户端</p>
<p>1、进行版本协商（WSAStartup）</p>
<p>2、创建一个套接字（socket）</p>
<p>3、连接到服务器 （connect）</p>
<p>4、发送或者接受消息 ( send &#x2F; recv )</p>
<p>5、关闭套接字 ( closesocket )</p>
<p>6、释放资源( WSACleanup)</p>
</blockquote>
<h3 id="③UDP服务器端和客户端编写流程"><a href="#③UDP服务器端和客户端编写流程" class="headerlink" title="③UDP服务器端和客户端编写流程"></a>③UDP服务器端和客户端编写流程</h3><blockquote>
<p>服务器端：</p>
<p>1、进行版本协商（WSAStartup）</p>
<p>2、创建一个套接字（socket）</p>
<p>3、绑定套接字（bind）</p>
<p>4、发送或者接受数据 ( sendto &#x2F; recvfrom )</p>
<p>5、关闭套接字 ( closesocket )</p>
<p>6、释放资源（WSACleanup）</p>
</blockquote>
<blockquote>
<p>客户端</p>
<p>1、进行版本协商（WSAStartup）</p>
<p>2、创建一个套接字（socket）</p>
<p>3、发送或者接受消息 ( sendto &#x2F; recvfrom )</p>
<p>4、关闭套接字 ( closesocket )</p>
<p>5、释放资源( WSACleanup)</p>
</blockquote>
<h2 id="36、缺陷检测"><a href="#36、缺陷检测" class="headerlink" title="36、缺陷检测"></a>36、缺陷检测</h2><h3 id="①常见的缺陷"><a href="#①常见的缺陷" class="headerlink" title="①常见的缺陷"></a>①常见的缺陷</h3><p>凹凸、污点、瑕疵、孔洞、破损、划痕</p>
<h3 id="②处理的方法"><a href="#②处理的方法" class="headerlink" title="②处理的方法"></a>②处理的方法</h3><h4 id="1、blob分析-特征检测"><a href="#1、blob分析-特征检测" class="headerlink" title="1、blob分析+特征检测"></a>1、blob分析+特征检测</h4><p>例程：<code>check_hazelnut_wafers.hdev </code></p>
<p>例程：<code>inspect_bottle_mouth.hdev</code>（极坐标转换）</p>
<p>例程：<code>novelty_detection_dyn_threshold.hdev </code>（动态&#x2F;局部 二值化dyn_threshold）</p>
<p>例程：<code>check_blister.hdev</code>（定位）</p>
<h4 id="2、blob分析-特征检测-差分"><a href="#2、blob分析-特征检测-差分" class="headerlink" title="2、blob分析+特征检测+差分"></a>2、blob分析+特征检测+差分</h4><p>例程：<code>fin.hdev </code></p>
<p>例程：<code>pcb_inspection.hdev </code>（灰度开运算和灰度闭运算）</p>
<p>例程：<code>novelty_detection_dyn_threshold.hdev </code></p>
<h4 id="3、频域-空间域"><a href="#3、频域-空间域" class="headerlink" title="3、频域+空间域"></a>3、频域+空间域</h4><p>例程：<code>detect_indent_fft.hdev </code> (检测缺陷随机，缺陷较小)</p>
<p>例程：<code>detect_mura_blur.hdev</code>(频域+空间域+差分)</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 测图像中的线条及其宽度的操作符</span><br><span class="line">* 用高斯平滑核的偏导数来提取线条，并将线条以亚像素精度的XLD轮廓形式返回</span><br><span class="line">lines_gauss(Image : Lines : Sigma, Low, High, LightDark, ExtractWidth, LineModel, CompleteJunctions : )</span><br></pre></td></tr></table></figure>



<h4 id="4、光度立体法"><a href="#4、光度立体法" class="headerlink" title="4、光度立体法"></a>4、光度立体法</h4><h4 id="5、测量-拟合"><a href="#5、测量-拟合" class="headerlink" title="5、测量+拟合"></a>5、测量+拟合</h4><p>例程：<code>measure_fill_level.hdev </code></p>
<p>例程：<code>fit_rectangle2_contour_xld.hdev </code></p>
<h4 id="6、特征训练的过程"><a href="#6、特征训练的过程" class="headerlink" title="6、特征训练的过程"></a>6、特征训练的过程</h4><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">*创建 MLP 分类器</span><br><span class="line">create_class_mlp( : : NumInput, NumHidden, NumOutput, OutputFunction, Preprocessing, NumComponents, RandSeed : MLPHandle)</span><br><span class="line"></span><br><span class="line">*将图像Image中的训练样本添加到 MLP 的训练数据中</span><br><span class="line">add_samples_image_class_mlp(Image, ClassRegions : : MLPHandle : )</span><br><span class="line"></span><br><span class="line">*设置 MLP 分类器的参数</span><br><span class="line">set_rejection_params_class_mlp( : : MLPHandle, GenParamName, GenParamValue : )</span><br><span class="line"></span><br><span class="line">*训练分类器</span><br><span class="line">train_class_mlp( : : MLPHandle, MaxIterations, WeightTolerance, ErrorTolerance : Error, ErrorLog)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*进行识别分类</span><br><span class="line">classify_image_class_mlp(Image : ClassRegions : MLPHandle, RejectionThreshold : )</span><br></pre></td></tr></table></figure>

<p>例程：<code>novelty_detection_mlp.hdev </code></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">* This example program shows how to use the MLP classifier <span class="keyword">for</span> novelty</span><br><span class="line">* detection to perform a web inspection task.  To perform the novelty detection,</span><br><span class="line">* a rejection <span class="keyword">class</span> <span class="title">is</span> <span class="title">trained</span> <span class="title">internally</span>.</span><br><span class="line">* <span class="title">For</span> <span class="title">the</span> <span class="title">web</span> <span class="title">inspection</span> <span class="title">task</span>, <span class="title">the</span> <span class="title">MLP</span> <span class="title">can</span> <span class="title">subsequently</span> <span class="title">be</span> <span class="title">used</span> <span class="title">to</span> <span class="title">detect</span></span><br><span class="line">* <span class="title">textures</span> <span class="title">that</span> <span class="title">do</span> <span class="title">not</span> <span class="title">correspond</span> <span class="title">to</span> <span class="title">the</span> <span class="title">texture</span> <span class="title">of</span> <span class="title">the</span> <span class="title">trained</span> <span class="title">good</span> <span class="title">objects</span>.</span><br><span class="line">* </span><br><span class="line"><span class="title">dev_update_off</span> ()</span><br><span class="line">* </span><br><span class="line"><span class="title">ReadPretrainedClassifier</span> := <span class="literal">false</span></span><br><span class="line">* Uncomment the following line to read the pretrained classifier <span class="keyword">from</span></span><br><span class="line">* disk. The training may last up to half a minute.</span><br><span class="line">* ReadPretrainedClassifier := <span class="literal">true</span></span><br><span class="line">SaveClassifier := <span class="literal">false</span></span><br><span class="line">* Uncomment the following line to write the MLP classifier to disk after training.</span><br><span class="line">* SaveClassifier := <span class="literal">true</span></span><br><span class="line">* </span><br><span class="line">read_image (Image, <span class="string">&#x27;plastic_mesh/plastic_mesh_01&#x27;</span>)</span><br><span class="line">get_image_size (Image, Width, Height)</span><br><span class="line">dev_close_window ()</span><br><span class="line">dev_open_window (<span class="number">0</span>, <span class="number">0</span>, Width, Height, <span class="string">&#x27;black&#x27;</span>, WindowHandle)</span><br><span class="line">dev_set_color (<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">set_display_font (WindowHandle, <span class="number">16</span>, <span class="string">&#x27;mono&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="string">&#x27;false&#x27;</span>)</span><br><span class="line">get_system (<span class="string">&#x27;example_dir&#x27;</span>, HalconExamples)</span><br><span class="line">* The texture filters used <span class="keyword">for</span> the classification will <span class="keyword">return</span> artifacts at the image</span><br><span class="line">* borders because the images of the plastic mesh to be inspected <span class="keyword">do</span> <span class="keyword">not</span></span><br><span class="line">* contain an integer number of mesh cells.  Because <span class="keyword">this</span> would lead to wrongly</span><br><span class="line">* detected errors at the image borders, we must exclude the area close to the</span><br><span class="line">* image border <span class="keyword">from</span> the training <span class="keyword">and</span> classification.  This <span class="keyword">is</span> done <span class="keyword">with</span> the following</span><br><span class="line">* rectangle.  Note that the image <span class="keyword">is</span> later scaled down <span class="keyword">by</span> a factor of two.</span><br><span class="line">gen_rectangle1 (Rectangle, <span class="number">10</span>, <span class="number">10</span>, Height / <span class="number">2</span> - <span class="number">11</span>, Width / <span class="number">2</span> - <span class="number">11</span>)</span><br><span class="line"><span class="keyword">if</span> (ReadPretrainedClassifier)</span><br><span class="line">    * Read the pretrained classifier <span class="keyword">from</span> disk.</span><br><span class="line">    dev_display (Image)</span><br><span class="line">    disp_message (WindowHandle, <span class="string">&#x27;Reading classifier from disk...&#x27;</span>, <span class="string">&#x27;window&#x27;</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span>)</span><br><span class="line">    read_class_mlp (HalconExamples + <span class="string">&#x27;/hdevelop/Segmentation/Classification/novelty_detection.gmc&#x27;</span>, MLPHandle)</span><br><span class="line">    wait_seconds (<span class="number">1.5</span>)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    * Create the MLP classifier.</span><br><span class="line">    create_class_mlp (<span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="string">&#x27;softmax&#x27;</span>, <span class="string">&#x27;principal_components&#x27;</span>, <span class="number">3</span>, <span class="number">42</span>, MLPHandle)</span><br><span class="line">    * The training <span class="keyword">is</span> based <span class="keyword">on</span> five images that contain no errors.</span><br><span class="line">    gen_empty_region (EmptyRegion)</span><br><span class="line">    concat_obj (Rectangle, EmptyRegion, ObjectsConcat)</span><br><span class="line">    <span class="keyword">for</span> J := <span class="number">1</span> to <span class="number">5</span> <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line">        read_image (Image, <span class="string">&#x27;plastic_mesh/plastic_mesh_&#x27;</span> + J$<span class="string">&#x27;02&#x27;</span>)</span><br><span class="line">        * The images are zoomed down because the resolution of the mesh <span class="keyword">is</span> very</span><br><span class="line">        * high.  This saves a large amount of processing time.</span><br><span class="line">        zoom_image_factor (Image, ImageZoomed, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="string">&#x27;constant&#x27;</span>)</span><br><span class="line">        dev_display (ImageZoomed)</span><br><span class="line">        disp_message (WindowHandle, <span class="string">&#x27;Adding training samples...&#x27;</span>, <span class="string">&#x27;window&#x27;</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span>)</span><br><span class="line">        * Generate the texture image.</span><br><span class="line">        gen_texture_image (ImageZoomed, ImageTexture)</span><br><span class="line">        * Add the samples to the classifier.</span><br><span class="line">        add_samples_image_class_mlp (ImageTexture, ObjectsConcat, MLPHandle)</span><br><span class="line">    <span class="function">endfor</span></span><br><span class="line"><span class="function">    <span class="title">dev_display</span> (<span class="params">ImageZoomed</span>)</span></span><br><span class="line"><span class="function">    * Now configure the MLP that a rejection <span class="keyword">class</span> will be added during training.</span></span><br><span class="line"><span class="function">    <span class="title">set_rejection_params_class_mlp</span> (<span class="params">MLPHandle, <span class="string">&#x27;sampling_strategy&#x27;</span>, <span class="string">&#x27;hyperbox_ring_around_each_class&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">set_rejection_params_class_mlp</span> (<span class="params">MLPHandle, <span class="string">&#x27;rejection_sample_factor&#x27;</span>, <span class="number">.3</span></span>)</span></span><br><span class="line"><span class="function">    * Train the MLP.</span></span><br><span class="line"><span class="function">    <span class="title">disp_message</span> (<span class="params">WindowHandle, <span class="string">&#x27;Training MLP...&#x27;</span>, <span class="string">&#x27;window&#x27;</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">train_class_mlp</span> (<span class="params">MLPHandle, <span class="number">200</span>, <span class="number">1</span>, <span class="number">0.01</span>, Error, ErrorLog</span>)</span></span><br><span class="line"><span class="function">    <span class="title">if</span> (<span class="params">SaveClassifier</span>)</span></span><br><span class="line"><span class="function">        <span class="title">write_class_mlp</span> (<span class="params">MLPHandle, HalconExamples + <span class="string">&#x27;/hdevelop/Segmentation/Classification/novelty_detection.gmc&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    endif</span></span><br><span class="line"><span class="function">endif</span></span><br><span class="line"><span class="function">* Now detect errors <span class="keyword">in</span> the plastic meshes.</span></span><br><span class="line"><span class="function"><span class="keyword">for</span> J :</span>= <span class="number">1</span> to <span class="number">14</span> <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line">    read_image (Image, <span class="string">&#x27;plastic_mesh/plastic_mesh_&#x27;</span> + J$<span class="string">&#x27;02&#x27;</span>)</span><br><span class="line">    zoom_image_factor (Image, ImageZoomed, <span class="number">0.5</span>, <span class="number">0.5</span>, <span class="string">&#x27;constant&#x27;</span>)</span><br><span class="line">    dev_display (ImageZoomed)</span><br><span class="line">    *给图像添加纹理</span><br><span class="line">    gen_texture_image (ImageZoomed, ImageTexture)</span><br><span class="line">    reduce_domain (ImageTexture, Rectangle, ImageTextureReduced)</span><br><span class="line">    * Classify samples belonging to the trained <span class="keyword">class</span> <span class="title">with</span> <span class="title">the</span> <span class="title">MLP</span>.</span><br><span class="line">    <span class="title">classify_image_class_mlp</span> (<span class="title">ImageTextureReduced</span>, <span class="title">ClassRegions</span>, <span class="title">MLPHandle</span>, 0.5)</span><br><span class="line">    * <span class="title">Post</span> <span class="title">process</span> <span class="title">the</span> <span class="title">returned</span> <span class="title">raw</span> <span class="title">errors</span> <span class="title">to</span> <span class="title">remove</span> <span class="title">insignificant</span> <span class="title">parts</span> <span class="title">of</span> <span class="title">the</span></span><br><span class="line">    * <span class="title">detected</span> <span class="title">errors</span>.</span><br><span class="line">    <span class="title">select_obj</span> (<span class="title">ClassRegions</span>, <span class="title">Correct</span>, 1)</span><br><span class="line">    <span class="title">select_obj</span> (<span class="title">ClassRegions</span>, <span class="title">Errors</span>, 2)</span><br><span class="line">    <span class="title">opening_circle</span> (<span class="title">Errors</span>, <span class="title">ErrorsOpening</span>, 4.5)</span><br><span class="line">    <span class="title">closing_circle</span> (<span class="title">ErrorsOpening</span>, <span class="title">ErrorsClosing</span>, 10.5)</span><br><span class="line">    <span class="title">connection</span> (<span class="title">ErrorsClosing</span>, <span class="title">ErrorsConnected</span>)</span><br><span class="line">    <span class="title">select_shape</span> (<span class="title">ErrorsConnected</span>, <span class="title">FinalErrors</span>, &#x27;<span class="title">area</span>&#x27;, &#x27;<span class="title">and</span>&#x27;, 100, 1000000)</span><br><span class="line">    <span class="title">count_obj</span> (<span class="title">FinalErrors</span>, <span class="title">NumErrors</span>)</span><br><span class="line">    <span class="title">dev_set_color</span> (&#x27;<span class="title">red</span>&#x27;)</span><br><span class="line">    <span class="title">dev_set_draw</span> (&#x27;<span class="title">margin</span>&#x27;)</span><br><span class="line">    <span class="title">dev_set_line_width</span> (5)</span><br><span class="line">    <span class="title">dev_display</span> (<span class="title">FinalErrors</span>)</span><br><span class="line">    <span class="title">if</span> (<span class="title">NumErrors</span> &gt; 0)</span><br><span class="line">        <span class="title">disp_message</span> (<span class="title">WindowHandle</span>, &#x27;<span class="title">Mesh</span> <span class="title">not</span> <span class="title">OK</span>&#x27;, &#x27;<span class="title">window</span>&#x27;, 10, 10, &#x27;<span class="title">black</span>&#x27;, &#x27;<span class="title">true</span>&#x27;)</span><br><span class="line">    <span class="title">else</span></span><br><span class="line">        <span class="title">disp_message</span> (<span class="title">WindowHandle</span>, &#x27;<span class="title">Mesh</span> <span class="title">OK</span>&#x27;, &#x27;<span class="title">window</span>&#x27;, 10, 10, &#x27;<span class="title">black</span>&#x27;, &#x27;<span class="title">true</span>&#x27;)</span><br><span class="line">    <span class="title">endif</span></span><br><span class="line">    <span class="title">if</span> (<span class="title">J</span> &lt; 14)</span><br><span class="line">        <span class="title">disp_continue_message</span> (<span class="title">WindowHandle</span>, &#x27;<span class="title">black</span>&#x27;, &#x27;<span class="title">true</span>&#x27;)</span><br><span class="line">    <span class="title">endif</span></span><br><span class="line">    <span class="title">stop</span> ()</span><br><span class="line"><span class="title">endfor</span></span><br><span class="line"><span class="title">clear_class_mlp</span> (<span class="title">MLPHandle</span>)</span><br></pre></td></tr></table></figure>



<h3 id="③药品检测的代码"><a href="#③药品检测的代码" class="headerlink" title="③药品检测的代码"></a>③药品检测的代码</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">*读入图片</span><br><span class="line">dev_close_window ()</span><br><span class="line">read_image (Image, <span class="string">&#x27;C:/Users/ZW/Desktop/机器视觉/Halcon视频教程 第2套初级班+强化班/强化班视频/实战图片/药品检测.png&#x27;</span>)</span><br><span class="line">dev_open_window_fit_image (Image, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">-1</span>, WindowHandle)</span><br><span class="line">dev_display (Image)</span><br><span class="line"></span><br><span class="line">*设置显示</span><br><span class="line">set_display_font (WindowHandle, <span class="number">14</span>, <span class="string">&#x27;mono&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="string">&#x27;false&#x27;</span>)</span><br><span class="line">dev_set_draw (<span class="string">&#x27;margin&#x27;</span>)</span><br><span class="line">dev_set_line_width (<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">*阈值分割 提取边界</span><br><span class="line">scale_image (Image, ImageScaled, <span class="number">2.5</span>, <span class="number">-7</span>)</span><br><span class="line">threshold (ImageScaled, Regions, <span class="number">0</span>, <span class="number">114</span>)</span><br><span class="line">connection (Regions, ConnectedRegions)</span><br><span class="line">select_shape (ConnectedRegions, SelectedRegions, <span class="string">&#x27;area&#x27;</span>, <span class="string">&#x27;and&#x27;</span>, <span class="number">67942.9</span>, <span class="number">78903.9</span>)</span><br><span class="line">fill_up (SelectedRegions, RegionFillUp)</span><br><span class="line">*边界更加平滑</span><br><span class="line">shape_trans (RegionFillUp, Blister, <span class="string">&#x27;convex&#x27;</span>)</span><br><span class="line"></span><br><span class="line">*校正图片</span><br><span class="line">orientation_region (Blister, Phi)</span><br><span class="line">area_center (Blister, Area1, Row, Column)</span><br><span class="line">vector_angle_to_rigid (Row, Column, Phi, Row, Column, <span class="number">0</span>, HomMat2D)</span><br><span class="line">affine_trans_image (Image, Image2, HomMat2D, <span class="string">&#x27;constant&#x27;</span>, <span class="string">&#x27;false&#x27;</span>)</span><br><span class="line"></span><br><span class="line">*挨个画圆</span><br><span class="line">gen_empty_obj (Chambers)</span><br><span class="line"><span class="keyword">for</span> I := <span class="number">0</span> to <span class="number">1</span> <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line">    Row := <span class="number">190</span> + I * <span class="number">110</span></span><br><span class="line">    <span class="keyword">for</span> J := <span class="number">0</span> to <span class="number">5</span> <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line">        Column := <span class="number">165</span> + J * <span class="number">80</span></span><br><span class="line">        gen_circle (Circle, Row, Column, <span class="number">35</span>)</span><br><span class="line">        concat_obj (Chambers, Circle, Chambers)</span><br><span class="line">    endfor</span><br><span class="line">endfor</span><br><span class="line"></span><br><span class="line">*得到扣除圆圈的图像</span><br><span class="line">affine_trans_region (Blister, Blister, HomMat2D, <span class="string">&#x27;nearest_neighbor&#x27;</span>)</span><br><span class="line">difference (Blister, Chambers, Pattern)</span><br><span class="line">union1 (Chambers, ChambersUnion)</span><br><span class="line"></span><br><span class="line">*得到变换的角度</span><br><span class="line">orientation_region (Blister, PhiRef)</span><br><span class="line">PhiRef := rad(<span class="number">180</span>) + <span class="function">PhiRef</span></span><br><span class="line"><span class="function"><span class="title">area_center</span> (<span class="params">Blister, Area2, RowRef, ColumnRef</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">*重新读入图像</span></span><br><span class="line"><span class="function"><span class="title">dev_close_window</span> ()</span></span><br><span class="line"><span class="function"><span class="title">dev_open_window_fit_image</span> (<span class="params">Image, <span class="number">0</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">-1</span>, WindowHandle</span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_display</span> (<span class="params">Image2</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">*抠出图像</span></span><br><span class="line"><span class="function"><span class="title">reduce_domain</span> (<span class="params">Image2, ChambersUnion, ImageReduced</span>)</span></span><br><span class="line"><span class="function"><span class="title">threshold</span> (<span class="params">ImageReduced, Regions1, <span class="number">0</span>, <span class="number">125</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">connection</span> (<span class="params">Regions1, ConnectedRegions1</span>)</span></span><br><span class="line"><span class="function"><span class="title">select_shape</span> (<span class="params">ConnectedRegions1, SelectedRegions1, <span class="string">&#x27;area&#x27;</span>, <span class="string">&#x27;and&#x27;</span>, <span class="number">1346.85</span>, <span class="number">2000</span></span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">dev_set_draw</span> (<span class="params"><span class="string">&#x27;margin&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_display</span> (<span class="params">Image2</span>)</span></span><br><span class="line"><span class="function"><span class="title">dev_display</span> (<span class="params">SelectedRegions1</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">*进行检测</span></span><br><span class="line"><span class="function"><span class="title">count_obj</span> (<span class="params">Chambers, Number</span>)</span></span><br><span class="line"><span class="function"><span class="title">gen_empty_obj</span> (<span class="params">WrongPill</span>)</span></span><br><span class="line"><span class="function"><span class="title">gen_empty_obj</span> (<span class="params">MissingPill</span>)</span></span><br><span class="line"><span class="function"><span class="title">gen_empty_obj</span> (<span class="params">CrackPill</span>)</span></span><br><span class="line"><span class="function">    <span class="keyword">for</span> I :</span>= <span class="number">1</span> to Number <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line">        select_obj (Chambers, Chamber, I)</span><br><span class="line">        intersection (Chamber, SelectedRegions1, Pill)</span><br><span class="line">        area_center (Pill, Area, Row1, Column1)</span><br><span class="line">        *如果存在裂缝 就会存在孔洞面积</span><br><span class="line">        area_holes (Pill, AreaHole)</span><br><span class="line">        <span class="keyword">if</span>(AreaHole &gt; <span class="number">0</span>)</span><br><span class="line">            concat_obj (CrackPill, Pill, CrackPill)</span><br><span class="line">        <span class="function">endif</span></span><br><span class="line"><span class="function">        <span class="title">if</span> (<span class="params">Area &gt; <span class="number">0</span></span>)</span></span><br><span class="line"><span class="function">            <span class="title">min_max_gray</span> (<span class="params">Pill, Image2, <span class="number">0</span>, Min, Max, Range</span>)</span></span><br><span class="line"><span class="function">            <span class="title">if</span> (<span class="params">Area &lt; <span class="number">1400</span> <span class="keyword">or</span> Min &gt; <span class="number">40</span></span>)</span></span><br><span class="line"><span class="function">                <span class="title">concat_obj</span> (<span class="params">WrongPill, Pill, WrongPill</span>)</span></span><br><span class="line"><span class="function">            endif</span></span><br><span class="line"><span class="function">        <span class="keyword">else</span></span></span><br><span class="line"><span class="function">            <span class="title">concat_obj</span> (<span class="params">MissingPill, Chamber, MissingPill</span>)</span></span><br><span class="line"><span class="function">        endif</span></span><br><span class="line"><span class="function">        <span class="title">dev_clear_window</span> ()</span></span><br><span class="line"><span class="function">    <span class="title">dev_display</span> (<span class="params">Image2</span>)</span></span><br><span class="line"><span class="function">    <span class="title">dev_set_color</span> (<span class="params"><span class="string">&#x27;forest green&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">count_obj</span> (<span class="params">SelectedRegions1, NumberP</span>)</span></span><br><span class="line"><span class="function">    <span class="title">count_obj</span> (<span class="params">WrongPill, NumberWP</span>)</span></span><br><span class="line"><span class="function">    <span class="title">count_obj</span> (<span class="params">MissingPill, NumberMP</span>)</span></span><br><span class="line"><span class="function">    <span class="title">count_obj</span> (<span class="params">CrackPill, NumberCp</span>)</span></span><br><span class="line"><span class="function">    <span class="title">dev_display</span> (<span class="params">SelectedRegions1</span>)</span></span><br><span class="line"><span class="function">    <span class="title">if</span> (<span class="params">NumberMP &gt; <span class="number">0</span> <span class="keyword">or</span> NumberWP &gt; <span class="number">0</span></span>)</span></span><br><span class="line"><span class="function">        <span class="title">disp_message</span> (<span class="params">WindowHandle, <span class="string">&#x27;Not OK&#x27;</span>, <span class="string">&#x27;window&#x27;</span>, <span class="number">10</span>, <span class="number">10</span> + <span class="number">600</span>, <span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="keyword">else</span></span></span><br><span class="line"><span class="function">        <span class="title">disp_message</span> (<span class="params">WindowHandle, <span class="string">&#x27;OK&#x27;</span>, <span class="string">&#x27;window&#x27;</span>, <span class="number">10</span>, <span class="number">10</span> + <span class="number">600</span>, <span class="string">&#x27;forest green&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    endif</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    <span class="title">disp_message</span> (<span class="params">WindowHandle, <span class="string">&#x27;# correct pills: &#x27;</span> + (NumberP - NumberWP - NumberCp</span>), &#x27;window&#x27;, 10, 10, &#x27;black&#x27;, &#x27;<span class="literal">true</span>&#x27;)</span></span><br><span class="line"><span class="function">    <span class="title">disp_message</span> (<span class="params">WindowHandle, <span class="string">&#x27;# wrong pills  :  &#x27;</span> + NumberWP, <span class="string">&#x27;window&#x27;</span>, <span class="number">10</span> + <span class="number">25</span>, <span class="number">10</span>, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">if</span> (<span class="params">NumberWP &gt; <span class="number">0</span></span>)</span></span><br><span class="line"><span class="function">        <span class="title">disp_message</span> (<span class="params">WindowHandle, NumberWP, <span class="string">&#x27;window&#x27;</span>, <span class="number">10</span> + <span class="number">25</span>, <span class="number">10</span> + <span class="number">180</span>, <span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    endif</span></span><br><span class="line"><span class="function">    <span class="title">disp_message</span> (<span class="params">WindowHandle, <span class="string">&#x27;# missing pills:  &#x27;</span> + NumberMP, <span class="string">&#x27;window&#x27;</span>, <span class="number">10</span> + <span class="number">50</span>, <span class="number">10</span>, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">disp_message</span> (<span class="params">WindowHandle, <span class="string">&#x27;# crack pills:  &#x27;</span> + NumberCp, <span class="string">&#x27;window&#x27;</span>, <span class="number">10</span> + <span class="number">75</span>, <span class="number">10</span>, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">if</span> (<span class="params">NumberMP &gt; <span class="number">0</span></span>)</span></span><br><span class="line"><span class="function">        <span class="title">disp_message</span> (<span class="params">WindowHandle, NumberMP, <span class="string">&#x27;window&#x27;</span>, <span class="number">10</span> + <span class="number">50</span>, <span class="number">10</span> + <span class="number">180</span>, <span class="string">&#x27;red&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    endif</span></span><br><span class="line"><span class="function">    <span class="title">dev_set_color</span> (<span class="params"><span class="string">&#x27;red&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">dev_display</span> (<span class="params">WrongPill</span>)</span></span><br><span class="line"><span class="function">    <span class="title">dev_display</span> (<span class="params">MissingPill</span>)</span></span><br><span class="line"><span class="function">    <span class="title">dev_display</span> (<span class="params">CrackPill</span>)</span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">    endfor</span></span><br></pre></td></tr></table></figure>



<h2 id="37、OCV（光学字符检测）"><a href="#37、OCV（光学字符检测）" class="headerlink" title="37、OCV（光学字符检测）"></a>37、OCV（光学字符检测）</h2><p>例程：<code>write_ocv.hdev</code></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">* <span class="number">1</span>、采集图像</span><br><span class="line">read_image (Image, <span class="string">&#x27;a01&#x27;</span>)</span><br><span class="line">* <span class="number">2</span>、提取字符</span><br><span class="line">threshold (Image, Region, <span class="number">0</span>, <span class="number">100</span>)</span><br><span class="line">* <span class="number">3</span>、抠出图像</span><br><span class="line">shape_trans (Region, RegionTrans, <span class="string">&#x27;rectangle1&#x27;</span>)</span><br><span class="line">dilation_rectangle1 (RegionTrans, RegionDilation, <span class="number">10</span>, <span class="number">10</span>)</span><br><span class="line">* Reduce the domain of an image.</span><br><span class="line">reduce_domain (Image, RegionDilation, ImageReduced)</span><br><span class="line"></span><br><span class="line">* <span class="number">3</span>、创建模型 进行训练</span><br><span class="line">* <span class="function">Create a <span class="keyword">new</span> OCV tool based <span class="keyword">on</span> gray <span class="keyword">value</span> projections</span></span><br><span class="line"><span class="function"><span class="title">create_ocv_proj</span> (<span class="params"><span class="string">&#x27;A&#x27;</span>, OCVHandle</span>)</span></span><br><span class="line"><span class="function"><span class="title">traind_ocv_proj</span> (<span class="params">ImageReduced, OCVHandle, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;single&#x27;</span></span>)</span></span><br><span class="line"><span class="function">* 4、保存训练好的模型</span></span><br><span class="line"><span class="function"><span class="title">write_ocv</span> (<span class="params">OCVHandle, <span class="string">&#x27;test_ocv.ocv&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="title">close_ocv</span> (<span class="params">OCVHandle</span>)</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">* 下次使用时读出训练好的模型</span></span><br><span class="line"><span class="function"><span class="title">read_ocv</span> (<span class="params"><span class="string">&#x27;test_ocv.ocv&#x27;</span>, OCVHandle</span>)</span></span><br><span class="line"><span class="function"><span class="title">close_ocv</span> (<span class="params">OCVHandle</span>)</span></span><br></pre></td></tr></table></figure>



<p>例程：<code>print_quality.hdev</code></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">read_image (Image, <span class="string">&#x27;fonts/arial_a1&#x27;</span>)</span><br><span class="line">get_image_size (Image, Width, Height)</span><br><span class="line">dev_close_window ()</span><br><span class="line">dev_open_window (<span class="number">0</span>, <span class="number">0</span>, Width / <span class="number">2</span>, Height / <span class="number">2</span>, <span class="string">&#x27;black&#x27;</span>, WindowHandle)</span><br><span class="line">dev_display (Image)</span><br><span class="line">dev_set_draw (<span class="string">&#x27;margin&#x27;</span>)</span><br><span class="line">gen_rectangle1 (Rectangle, <span class="number">37</span>, <span class="number">69</span>, <span class="number">115</span>, <span class="number">141</span>)</span><br><span class="line">reduce_domain (Image, Rectangle, ImageReduced)</span><br><span class="line">*创建模型 进行训练</span><br><span class="line">create_ocv_proj (<span class="string">&#x27;A&#x27;</span>, OCVHandle)</span><br><span class="line">traind_ocv_proj (ImageReduced, OCVHandle, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;single&#x27;</span>)</span><br><span class="line">dev_set_color (<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> I := <span class="number">1</span> to <span class="number">9</span> <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line">    read_image (Image, <span class="string">&#x27;fonts/arial_a&#x27;</span> + I)</span><br><span class="line">    binary_threshold (Image, Region, <span class="string">&#x27;max_separability&#x27;</span>, <span class="string">&#x27;dark&#x27;</span>, UsedThreshold)</span><br><span class="line">    connection (Region, ConnectedRegions)</span><br><span class="line">    select_shape (ConnectedRegions, SelectedRegions, <span class="string">&#x27;area&#x27;</span>, <span class="string">&#x27;and&#x27;</span>, <span class="number">150</span>, <span class="number">99999</span>)</span><br><span class="line">    sort_region (SelectedRegions, SortedRegions, <span class="string">&#x27;character&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="string">&#x27;row&#x27;</span>)</span><br><span class="line">    select_obj (SortedRegions, ObjectSelected, <span class="number">1</span>)</span><br><span class="line">    shape_trans (ObjectSelected, RegionTrans, <span class="string">&#x27;rectangle1&#x27;</span>)</span><br><span class="line">    dilation_rectangle1 (RegionTrans, RegionDilation, <span class="number">15</span>, <span class="number">15</span>)</span><br><span class="line">    reduce_domain (Image, RegionDilation, ImageReduced)</span><br><span class="line">    *识别函数 do_ocv_simple</span><br><span class="line">    * Quality的值越大 识别的正确率越高</span><br><span class="line">    * <span class="number">5</span>代表阈值 值越大要求越高</span><br><span class="line">    do_ocv_simple (ImageReduced, OCVHandle, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="number">5</span>, Quality)</span><br><span class="line">    set_tposition (WindowHandle, <span class="number">15</span>, <span class="number">12</span>)</span><br><span class="line">    write_string (WindowHandle, <span class="string">&#x27;Quality = &#x27;</span> + Quality)</span><br><span class="line">    stop ()</span><br><span class="line"><span class="function">endfor</span></span><br><span class="line"><span class="function"><span class="title">close_ocv</span> (<span class="params">OCVHandle</span>)</span></span><br></pre></td></tr></table></figure>



<h2 id="38、频域-空间域"><a href="#38、频域-空间域" class="headerlink" title="38、频域+空间域"></a>38、频域+空间域</h2><h3 id="①理论-2"><a href="#①理论-2" class="headerlink" title="①理论"></a>①理论</h3><p><strong>频率图像中心一般是低频成分，从中心往外频率是逐渐增加的</strong></p>
<p><strong>每一点亮度值越高表示这个频率的特征很突出。亮点越多表示该频率的成分越多</strong></p>
<p><strong>一幅图像灰度均匀的区域，变化不剧烈的部分对应低频部分——频谱图中较亮部分</strong></p>
<p><strong>图像中的噪声、边缘、细节，变化剧烈的部分对应高频部分——频谱图中较暗部分</strong></p>
<p>整个图像区域中一般最多的就是背景图</p>
<p>去除掉较亮的区域（成分多的内容） 就是去除了背景图</p>
<p>留下了较暗的区域 就是留下了细节内容</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705161740305.png" alt="image-20240705161740305"></p>
<h3 id="②傅里叶变换的算子"><a href="#②傅里叶变换的算子" class="headerlink" title="②傅里叶变换的算子"></a>②傅里叶变换的算子</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">*fft_image函数计算输入图像（Image）的傅里叶变换，将图像转换到频率域</span><br><span class="line">*采用的算法是快速傅里叶变换（FFT）。该函数对整个图像进行变换，忽略图像的域</span><br><span class="line">fft_image(Image : ImageFFT : : )</span><br><span class="line"></span><br><span class="line">*fft_generic提供了更灵活的选项，可以选择傅里叶变换的方向、指数符号、归一化因子和直流分量位置等</span><br><span class="line">fft_generic(Image : ImageFFT : Direction, Exponent, Norm, Mode, ResultType : )</span><br><span class="line">    </span><br><span class="line">* 傅里叶反变换 频率图变为灰度图</span><br><span class="line">fft_image_inv(Image : ImageFFTInv : : )</span><br></pre></td></tr></table></figure>

<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240705161340906.png" alt="image-20240705161340906"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240706115211531.png" alt="image-20240706115211531"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*进行快速傅里叶变换</span><br><span class="line">*其中<span class="string">&#x27;to_freq&#x27;</span>代表正向 ‘from_freq’代表反向</span><br><span class="line">*ResultType表示结果类型（傅里叶变换得到的结果有实部和虚部 默认为complex复数形式）</span><br><span class="line"><span class="built_in">fft_generic</span>(Image:ImageFFT:<span class="string">&#x27;to_freq&#x27;</span>,Exponent,Norm,Mode,ResultType:)</span><br></pre></td></tr></table></figure>

<ol>
<li><p><strong>低通滤波器（Low-pass Filter）：</strong><br>低通滤波器<strong>允许低频信号通过</strong>，<strong>抑制高频信号</strong>。它的作用是<strong>平滑图像、去除高频噪声、模糊图像的细节，使图像变得更加平滑</strong>。低通滤波器通常用于图像模糊、降噪和图像压缩等应用。</p>
<p>常见的低通滤波器包括：</p>
<ul>
<li>均值滤波器（平均滤波器）：用邻域像素的平均值替代中心像素的值。</li>
<li>高斯滤波器：使用高斯函数作为权重来平滑图像，具有更好的平滑效果和较好的边缘保留性能。</li>
<li>中值滤波器：用邻域像素的中值替代中心像素的值，对于去除椒盐噪声等非常有效。</li>
</ul>
<p>低通滤波器可以通过控制滤波器的大小或频率响应来调整平滑程度。较大的滤波器将导致更强的平滑效果，但可能会损失图像的细节。</p>
</li>
<li><p><strong>高通滤波器（High-pass Filter）：</strong><br>高通滤波器<strong>允许高频信号通过</strong>，<strong>抑制低频信号</strong>。它的作用是<strong>突出图像中的细节、边缘和纹理，增强图像的锐度和边缘信息</strong>。高通滤波器通常用于图像增强、边缘检测和纹理分析等应用。</p>
<p>常见的高通滤波器包括：</p>
<ul>
<li>拉普拉斯滤波器：用于增强图像的高频部分，使边缘更加明显。</li>
<li>Sobel滤波器：用于检测图像中的边缘，通过计算梯度来突出边缘。</li>
<li>Prewitt滤波器：类似于Sobel滤波器，用于检测图像中的边缘。</li>
</ul>
<p>高通滤波器可以通过控制滤波器的大小或频率响应来调整增强效果。较小的滤波器将突出较细的边缘和细节，而较大的滤波器将突出更粗的边缘和纹理。</p>
</li>
</ol>
<h3 id="③喷图处理（除滤波器外）"><a href="#③喷图处理（除滤波器外）" class="headerlink" title="③喷图处理（除滤波器外）"></a>③喷图处理（除滤波器外）</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240721125908603.png" alt="image-20240721125908603"></p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240721125923423.png" alt="image-20240721125923423"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">read_image (Image11, <span class="string">&#x27;C:/Users/ZW/Desktop/机器视觉/Halcon视频教程 第2套初级班+强化班/强化班视频/实战图片/11.png&#x27;</span>)</span><br><span class="line"></span><br><span class="line">rgb1_to_gray (Image11, GrayImage)</span><br><span class="line">*傅里叶变换</span><br><span class="line">fft_image (GrayImage, ImageFFT)</span><br><span class="line"></span><br><span class="line">gen_rectangle1 (ROI_0, <span class="number">-0.5</span>, <span class="number">399.311</span>, <span class="number">169.691</span>, <span class="number">423.571</span>)</span><br><span class="line">gen_rectangle1 (TMP_Region, <span class="number">158.828</span>, <span class="number">313.914</span>, <span class="number">225.215</span>, <span class="number">455.595</span>)</span><br><span class="line">union2 (ROI_0, TMP_Region, ROI_0)</span><br><span class="line">gen_rectangle1 (TMP_Region, <span class="number">220.387</span>, <span class="number">397.37</span>, <span class="number">298.844</span>, <span class="number">421.63</span>)</span><br><span class="line">union2 (ROI_0, TMP_Region, ROI_0)</span><br><span class="line">gen_rectangle1 (TMP_Region, <span class="number">291.602</span>, <span class="number">399.311</span>, <span class="number">303.672</span>, <span class="number">421.63</span>)</span><br><span class="line">union2 (ROI_0, TMP_Region, ROI_0)</span><br><span class="line">gen_rectangle1 (TMP_Region, <span class="number">313.328</span>, <span class="number">404.163</span>, <span class="number">616.293</span>, <span class="number">418.719</span>)</span><br><span class="line">union2 (ROI_0, TMP_Region, ROI_0)</span><br><span class="line">paint_region (ROI_0, ImageFFT, ImageResult, <span class="number">0</span>, <span class="string">&#x27;fill&#x27;</span>)</span><br><span class="line"></span><br><span class="line">*傅里叶反变换</span><br><span class="line">fft_image_inv (ImageResult, ImageFFTInv)</span><br></pre></td></tr></table></figure>

<h3 id="④转为功率图"><a href="#④转为功率图" class="headerlink" title="④转为功率图"></a>④转为功率图</h3><p>转为功率图之前</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240721145430944.png" alt="image-20240721145430944"></p>
<p>转为功率图之后</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240721145509730.png" alt="image-20240721145509730"></p>
<p>例程：<code>remove_textture_fft.hdev</code></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">dev_update_off ()</span><br><span class="line">dev_close_window ()</span><br><span class="line">Scale := [<span class="number">1.0</span>,<span class="number">.65</span>]</span><br><span class="line">MinGray := [<span class="number">50</span>,<span class="number">100</span>]</span><br><span class="line"><span class="keyword">for</span> Index := <span class="number">0</span> to <span class="number">1</span> <span class="keyword">by</span> <span class="number">1</span></span><br><span class="line">    * </span><br><span class="line">    * <span class="function">Read <span class="keyword">and</span> display the image</span></span><br><span class="line"><span class="function">    <span class="title">read_image</span> (<span class="params">Image, <span class="string">&#x27;plan_&#x27;</span> + (Index + <span class="number">1</span></span>)$&#x27;02&#x27;)</span></span><br><span class="line"><span class="function">    <span class="title">get_image_size</span> (<span class="params">Image, Width, Height</span>)</span></span><br><span class="line"><span class="function">    <span class="title">dev_open_window</span> (<span class="params"><span class="number">0</span>, <span class="number">0</span>, Width * Scale[Index], Height * Scale[Index], <span class="string">&#x27;black&#x27;</span>, WindowHandle</span>)</span></span><br><span class="line"><span class="function">    <span class="title">set_display_font</span> (<span class="params">WindowHandle, <span class="number">14</span>, <span class="string">&#x27;mono&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="string">&#x27;false&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">dev_set_part</span> (<span class="params"><span class="number">0</span>, <span class="number">0</span>, Height - <span class="number">1</span>, Width - <span class="number">1</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">dev_display</span> (<span class="params">Image</span>)</span></span><br><span class="line"><span class="function">    <span class="title">disp_message</span> (<span class="params">WindowHandle, <span class="string">&#x27;Original image&#x27;</span>, <span class="string">&#x27;image&#x27;</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    * </span></span><br><span class="line"><span class="function">    * Perform fft <span class="keyword">and</span> display spectrum</span></span><br><span class="line"><span class="function">    <span class="title">optimize_fft_speed</span> (<span class="params">Width, Height, <span class="string">&#x27;standard&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    * </span></span><br><span class="line"><span class="function">    * We used &#x27;fft_generic&#x27; &#x27;sqrt&#x27; <span class="keyword">and</span> &#x27;dc_center&#x27; mainly</span></span><br><span class="line"><span class="function">    * <span class="keyword">for</span> visualization purposes.</span></span><br><span class="line"><span class="function">    * To speed up the program, rft_generic should be used</span>;</span><br><span class="line">    * but of course, the peak detection algorithm has to be</span><br><span class="line">    * adjusted <span class="keyword">in</span> <span class="keyword">this</span> <span class="keyword">case</span>.</span><br><span class="line">    fft_generic (Image, ImageFFT, <span class="string">&#x27;to_freq&#x27;</span>, <span class="number">-1</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;dc_center&#x27;</span>, <span class="string">&#x27;complex&#x27;</span>)</span><br><span class="line">    dev_open_window (<span class="number">0</span>, Width * Scale[Index] + <span class="number">7</span>, Width * Scale[Index], Height * Scale[Index], <span class="string">&#x27;black&#x27;</span>, WindowHandle1)</span><br><span class="line">    dev_set_color (<span class="string">&#x27;red&#x27;</span>)</span><br><span class="line">    dev_set_draw (<span class="string">&#x27;margin&#x27;</span>)</span><br><span class="line">    set_display_font (WindowHandle1, <span class="number">14</span>, <span class="string">&#x27;mono&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="string">&#x27;false&#x27;</span>)</span><br><span class="line">    dev_set_part (<span class="number">0</span>, <span class="number">0</span>, Height - <span class="number">1</span>, Width - <span class="number">1</span>)</span><br><span class="line">    dev_display (ImageFFT)</span><br><span class="line">    disp_message (WindowHandle1, <span class="string">&#x27;Fourier spectrum&#x27;</span>, <span class="string">&#x27;image&#x27;</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span>)</span><br><span class="line">    disp_cont_message (WindowHandle1, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span>)</span><br><span class="line">    stop ()</span><br><span class="line">    * </span><br><span class="line">    * Detect the eight most significant peaks <span class="keyword">in</span> the spectrum</span><br><span class="line">    *重点函数</span><br><span class="line">    power_real (ImageFFT, PowerSpectrum)</span><br><span class="line">    binomial_filter (PowerSpectrum, ImageSmooth, <span class="number">9</span>, <span class="number">9</span>)</span><br><span class="line">    threshold (ImageSmooth, Region, MinGray[Index], <span class="number">100000</span>)</span><br><span class="line">    connection (Region, ConnectedRegions)</span><br><span class="line">    select_shape (ConnectedRegions, SelectedRegions, <span class="string">&#x27;area&#x27;</span>, <span class="string">&#x27;and&#x27;</span>, <span class="number">5</span>, <span class="number">200</span>)</span><br><span class="line">    union1 (SelectedRegions, RegionUnion)</span><br><span class="line">    reduce_domain (ImageSmooth, RegionUnion, ImageReduced)</span><br><span class="line">    local_max (ImageReduced, LocalMaxima)</span><br><span class="line">    * </span><br><span class="line">    * Next, detect peaks one octave higher, i.e., at twice</span><br><span class="line">    * <span class="function">the frequency of the most significant peaks</span></span><br><span class="line"><span class="function">    <span class="title">shape_trans</span> (<span class="params">LocalMaxima, RegionTrans, <span class="string">&#x27;convex&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    * Construct ROI band at twice the frequency</span></span><br><span class="line"><span class="function">    <span class="title">hom_mat2d_identity</span> (<span class="params">HomMat2DIdentity</span>)</span></span><br><span class="line"><span class="function">    <span class="title">hom_mat2d_scale</span> (<span class="params">HomMat2DIdentity, <span class="number">2.1</span>, <span class="number">2.1</span>, Height / <span class="number">2</span>, Width / <span class="number">2</span>, HomMat2DScale</span>)</span></span><br><span class="line"><span class="function">    <span class="title">affine_trans_region</span> (<span class="params">RegionTrans, RegionTrans1, HomMat2DScale, <span class="string">&#x27;nearest_neighbor&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">hom_mat2d_scale</span> (<span class="params">HomMat2DIdentity, <span class="number">1.9</span>, <span class="number">1.9</span>, Height / <span class="number">2</span>, Width / <span class="number">2</span>, HomMat2DScale</span>)</span></span><br><span class="line"><span class="function">    <span class="title">affine_trans_region</span> (<span class="params">RegionTrans, RegionTrans2, HomMat2DScale, <span class="string">&#x27;nearest_neighbor&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">difference</span> (<span class="params">RegionTrans1, RegionTrans2, RegionDifference</span>)</span></span><br><span class="line"><span class="function">    * Extract the peaks at twice the frequency</span></span><br><span class="line"><span class="function">    <span class="title">reduce_domain</span> (<span class="params">ImageSmooth, RegionDifference, ImageReduced</span>)</span></span><br><span class="line"><span class="function">    <span class="title">threshold</span> (<span class="params">ImageReduced, Region, <span class="number">15</span>, <span class="number">100000</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">reduce_domain</span> (<span class="params">ImageSmooth, Region, ImageReduced</span>)</span></span><br><span class="line"><span class="function">    <span class="title">local_max</span> (<span class="params">ImageReduced, LocalMaxima2</span>)</span></span><br><span class="line"><span class="function">    * </span></span><br><span class="line"><span class="function">    * Merge the peaks of both octaves <span class="keyword">and</span> enlarge them to</span></span><br><span class="line"><span class="function">    * integrate the relevant frequencies <span class="keyword">into</span> the filter</span></span><br><span class="line"><span class="function">    <span class="title">union2</span> (<span class="params">LocalMaxima, LocalMaxima2, RegionUnion</span>)</span></span><br><span class="line"><span class="function">    <span class="title">dilation_circle</span> (<span class="params">RegionUnion, RegionDilation, <span class="number">15.5</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">paint_region</span> (<span class="params">RegionDilation, ImageFFT, ImageFFTFiltered, <span class="number">0</span>, <span class="string">&#x27;fill&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">dev_display</span> (<span class="params">ImageFFT</span>)</span></span><br><span class="line"><span class="function">    <span class="title">dev_display</span> (<span class="params">RegionDilation</span>)</span></span><br><span class="line"><span class="function">    <span class="title">disp_message</span> (<span class="params">WindowHandle1, <span class="string">&#x27;Frequencies of the\nbackground texture&#x27;</span>, <span class="string">&#x27;image&#x27;</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">disp_cont_message</span> (<span class="params">WindowHandle1, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">stop</span> ()</span></span><br><span class="line"><span class="function">    * </span></span><br><span class="line"><span class="function">    * Apply the filter <span class="keyword">and</span> display the results</span></span><br><span class="line"><span class="function">    <span class="title">fft_generic</span> (<span class="params">ImageFFTFiltered, ImageFiltered, <span class="string">&#x27;from_freq&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;sqrt&#x27;</span>, <span class="string">&#x27;dc_center&#x27;</span>, <span class="string">&#x27;byte&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">dev_display</span> (<span class="params">ImageFiltered</span>)</span></span><br><span class="line"><span class="function">    <span class="title">disp_message</span> (<span class="params">WindowHandle1, <span class="string">&#x27;Filtered image&#x27;</span>, <span class="string">&#x27;image&#x27;</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    * </span></span><br><span class="line"><span class="function">    <span class="title">dev_open_window</span> (<span class="params"><span class="number">0</span>, <span class="number">2</span> * (Width * Scale[Index]</span>) + 14, Width * Scale[Index], Height * Scale[Index], &#x27;black&#x27;, WindowHandle2)</span></span><br><span class="line"><span class="function">    <span class="title">set_display_font</span> (<span class="params">WindowHandle2, <span class="number">14</span>, <span class="string">&#x27;mono&#x27;</span>, <span class="string">&#x27;true&#x27;</span>, <span class="string">&#x27;false&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">dev_set_part</span> (<span class="params"><span class="number">0</span>, <span class="number">0</span>, Height - <span class="number">1</span>, Width - <span class="number">1</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">sub_image</span> (<span class="params">Image, ImageFiltered, ImageTexture, <span class="number">1</span>, <span class="number">128</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">dev_display</span> (<span class="params">ImageTexture</span>)</span></span><br><span class="line"><span class="function">    <span class="title">disp_message</span> (<span class="params">WindowHandle2, <span class="string">&#x27;Removed texture&#x27;</span>, <span class="string">&#x27;window&#x27;</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function">    <span class="title">if</span> (<span class="params">Index &lt; <span class="number">1</span></span>)</span></span><br><span class="line"><span class="function">        <span class="title">disp_cont_message</span> (<span class="params">WindowHandle2, <span class="string">&#x27;black&#x27;</span>, <span class="string">&#x27;true&#x27;</span></span>)</span></span><br><span class="line"><span class="function">        <span class="title">stop</span> ()</span></span><br><span class="line"><span class="function">        <span class="title">dev_close_window</span> ()</span></span><br><span class="line"><span class="function">        <span class="title">dev_close_window</span> ()</span></span><br><span class="line"><span class="function">        <span class="title">dev_close_window</span> ()</span></span><br><span class="line"><span class="function">    endif</span></span><br><span class="line"><span class="function">endfor</span></span><br></pre></td></tr></table></figure>



<h2 id="39、标定助手进行标定"><a href="#39、标定助手进行标定" class="headerlink" title="39、标定助手进行标定"></a>39、标定助手进行标定</h2><h3 id="创建描述文件"><a href="#创建描述文件" class="headerlink" title="创建描述文件"></a>创建描述文件</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">*用于生成校准板描述文件和相应的PostScript文件的算子</span><br><span class="line"><span class="built_in">gen_caltab</span>( : : XNum, YNum, MarkDist, DiameterRatio, CalPlateDescr, CalPlatePSFile : )</span><br><span class="line">    </span><br><span class="line">XNum（输入控制）：校准板在x方向上的标记数量，默认值为<span class="number">7</span>。</span><br><span class="line">YNum（输入控制）：校准板在y方向上的标记数量，默认值为<span class="number">7</span>。</span><br><span class="line">MarkDist（输入控制）：标记之间的距离（以米为单位），默认值为<span class="number">0.0125</span>。</span><br><span class="line">DiameterRatio（输入控制）：标记直径与标记距离的比率，默认值为<span class="number">0.5</span>。</span><br><span class="line">CalPlateDescr（输入控制）：校准板描述文件的文件名，默认为<span class="string">&#x27;caltab.descr&#x27;</span>。</span><br><span class="line">CalPlatePSFile（输入控制）：PostScript文件的文件名，默认为<span class="string">&#x27;caltab.ps&#x27;</span>。</span><br></pre></td></tr></table></figure>



<h3 id="标定助手"><a href="#标定助手" class="headerlink" title="标定助手"></a>标定助手</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240722110943149.png" alt="image-20240722110943149"></p>
<h3 id="标定过程"><a href="#标定过程" class="headerlink" title="标定过程"></a>标定过程</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240722111747747.png" alt="image-20240722111747747"></p>
<h3 id="得到的结果"><a href="#得到的结果" class="headerlink" title="得到的结果"></a>得到的结果</h3><p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240722112200664.png" alt="image-20240722112200664"></p>
<h2 id="40、单相机标定—畸形矫正"><a href="#40、单相机标定—畸形矫正" class="headerlink" title="40、单相机标定—畸形矫正"></a>40、单相机标定—畸形矫正</h2><p>标定完成后插入代码中的插入数据得到两个参数</p>
<p><strong>CameraParameters</strong>（内参数） 和 <strong>CameraPose</strong>（外参数）</p>
<p>一般只会使用内参数</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/image-20240722120754472.png" alt="image-20240722120754472"></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 根据指定的径向畸变系数来确定新的相机参数</span><br><span class="line">* CamParamIn是得到的初始参数</span><br><span class="line">change_radial_distortion_cam_par( : : Mode, CamParamIn, DistortionCoeffs : CamParamOut)</span><br><span class="line"></span><br><span class="line">* 根据内部相机参数CamParamIn（原始参数）和计算得到的CamParamOut（新参数）计算与径向畸变变化相对应的图像映射</span><br><span class="line">gen_radial_distortion_map( : Map : CamParamIn, CamParamOut, MapType : )</span><br><span class="line"></span><br><span class="line">*使用一个任意的转换Map来转换图像<span class="function">Image</span></span><br><span class="line"><span class="function"><span class="title">map_image</span>(<span class="params">Image, Map : ImageMapped : : </span>)</span></span><br></pre></td></tr></table></figure>

<h2 id="41、VS一些操作"><a href="#41、VS一些操作" class="headerlink" title="41、VS一些操作"></a>41、VS一些操作</h2><h3 id="①上锁"><a href="#①上锁" class="headerlink" title="①上锁"></a>①上锁</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上锁</span></span><br><span class="line">::<span class="built_in">EnableWindow</span>(<span class="built_in">GetDlgItem</span>(IDC_MATH)-&gt;<span class="built_in">GetSafeHwnd</span>(), FALSE);</span><br><span class="line"><span class="comment">// 解锁</span></span><br><span class="line">::<span class="built_in">EnableWindow</span>(<span class="built_in">GetDlgItem</span>(IDC_DRAW)-&gt;<span class="built_in">GetSafeHwnd</span>(), TRUE);</span><br></pre></td></tr></table></figure>



<h3 id="②滑动条的设置"><a href="#②滑动条的设置" class="headerlink" title="②滑动条的设置"></a>②滑动条的设置</h3><p>先增加控件</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/ad8dfa3f370a640bc6980a5716129d06.png" alt="img"></p>
<p>再进行设置（在 <code>OnInitDialog()</code> 进行设置 ）</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置范围</span></span><br><span class="line">m_yuzhi_cabin.<span class="built_in">SetRange</span>(<span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line"><span class="comment">//设置初始位置</span></span><br><span class="line">m_yuzhi_cabin.<span class="built_in">SetPos</span>(<span class="number">141</span>);</span><br><span class="line"><span class="comment">//设置显示刻度的间隔</span></span><br><span class="line">m_yuzhi_cabin.<span class="built_in">SetTicFreq</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<h3 id="③绑定窗口设置（在-OnInitDialog-进行设置-）"><a href="#③绑定窗口设置（在-OnInitDialog-进行设置-）" class="headerlink" title="③绑定窗口设置（在 OnInitDialog() 进行设置 ）"></a>③绑定窗口设置（在 <code>OnInitDialog()</code> 进行设置 ）</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//开启第一个窗口---hv_WindowHandle</span></span><br><span class="line">HWND hwnd;</span><br><span class="line">CRect rect;</span><br><span class="line"><span class="built_in">GetDlgItem</span>(IDC_IMAGE1)-&gt;<span class="built_in">GetWindowRect</span>(&amp;rect);</span><br><span class="line">hwnd = <span class="built_in">GetDlgItem</span>(IDC_IMAGE1)-&gt;m_hWnd;</span><br><span class="line">Hlong WWindowID = (Hlong)hwnd;</span><br><span class="line"><span class="built_in">OpenWindow</span>(<span class="number">0</span>, <span class="number">0</span>, rect.<span class="built_in">Width</span>(), rect.<span class="built_in">Height</span>(), WWindowID, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, &amp;hv_WindowHandle);</span><br><span class="line"><span class="comment">//SetWindowAttr(&quot;background_color&quot;, &quot;white&quot;);</span></span><br><span class="line">HDevWindowStack::<span class="built_in">Push</span>(hv_WindowHandle);</span><br><span class="line"></span><br><span class="line"><span class="comment">//开启第二个窗口------hv_WindowHandle1</span></span><br><span class="line">HWND hwnd1;</span><br><span class="line">CRect rect1;</span><br><span class="line"><span class="built_in">GetDlgItem</span>(IDC_IMAGE2)-&gt;<span class="built_in">GetWindowRect</span>(&amp;rect1);</span><br><span class="line">hwnd1 = <span class="built_in">GetDlgItem</span>(IDC_IMAGE2)-&gt;m_hWnd;</span><br><span class="line">Hlong WWindowID1 = (Hlong)hwnd1;</span><br><span class="line"><span class="built_in">OpenWindow</span>(<span class="number">0</span>, <span class="number">0</span>, rect1.<span class="built_in">Width</span>(), rect1.<span class="built_in">Height</span>(), WWindowID1, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, &amp;hv_WindowHandle1);</span><br><span class="line"><span class="built_in">SetWindowAttr</span>(<span class="string">&quot;background_color&quot;</span>, <span class="string">&quot;black&quot;</span>);</span><br><span class="line">HDevWindowStack::<span class="built_in">Push</span>(hv_WindowHandle1);</span><br><span class="line"></span><br><span class="line"><span class="comment">//激活其中某个窗口</span></span><br><span class="line">HDevWindowStack::<span class="built_in">SetActive</span>(hv_WindowHandle);</span><br></pre></td></tr></table></figure>

<h3 id="④列表控件ListControl"><a href="#④列表控件ListControl" class="headerlink" title="④列表控件ListControl"></a>④列表控件ListControl</h3><p>添加ListControl</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/4e181a6e6f4d40432aa3b5c2bb68c752.png" alt="img"></p>
<p>设置view变量 让ListControl竖着或者横着</p>
<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/9d4abf9d7433cace21c978147532c46e.png" alt="img"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">CString head[] = &#123; <span class="built_in">TEXT</span>(<span class="string">&quot;姓名&quot;</span>),<span class="built_in">TEXT</span>(<span class="string">&quot;年龄&quot;</span>),<span class="built_in">TEXT</span>(<span class="string">&quot;性别&quot;</span>) &#125;;</span><br><span class="line">CString name[] = &#123; <span class="built_in">TEXT</span>(<span class="string">&quot;小赵&quot;</span>),<span class="built_in">TEXT</span>(<span class="string">&quot;小凡&quot;</span>),<span class="built_in">TEXT</span>(<span class="string">&quot;小夏&quot;</span>),</span><br><span class="line">                  <span class="built_in">TEXT</span>(<span class="string">&quot;小川&quot;</span>),<span class="built_in">TEXT</span>(<span class="string">&quot;小卉&quot;</span>),<span class="built_in">TEXT</span>(<span class="string">&quot;小余&quot;</span>) &#125;;</span><br><span class="line"><span class="comment">//设置主题</span></span><br><span class="line">m_List.<span class="built_in">SetExtendedStyle</span>(LVS_EX_FULLROWSELECT | LVS_EX_GRIDLINES | LVS_EX_DOUBLEBUFFER);</span><br><span class="line"><span class="comment">//插入列标题</span></span><br><span class="line">m_List.<span class="built_in">InsertColumn</span>(<span class="number">0</span>, head[<span class="number">0</span>], LVCFMT_LEFT, <span class="number">100</span>);</span><br><span class="line">m_List.<span class="built_in">InsertColumn</span>(<span class="number">1</span>, head[<span class="number">1</span>], LVCFMT_LEFT, <span class="number">100</span>);</span><br><span class="line">m_List.<span class="built_in">InsertColumn</span>(<span class="number">2</span>, head[<span class="number">2</span>], LVCFMT_LEFT, <span class="number">100</span>);</span><br><span class="line"><span class="comment">//插入正文内容</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//确定行数</span></span><br><span class="line">    m_List.<span class="built_in">InsertItem</span>(i, name[i]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置列内容</span></span><br><span class="line">    <span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> age = <span class="number">23</span>;</span><br><span class="line">    m_List.<span class="built_in">SetItemText</span>(i, ++j, <span class="built_in">TEXT</span>(<span class="string">&quot;18&quot;</span>));</span><br><span class="line">    m_List.<span class="built_in">SetItemText</span>(i, ++j, <span class="built_in">TEXT</span>(<span class="string">&quot;女&quot;</span>));</span><br></pre></td></tr></table></figure>

<p><img src="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/97c89826774839f4b52eb18f1bff503a.png" alt="img"></p>
<h2 id="42、VS与Halcon变量的转换"><a href="#42、VS与Halcon变量的转换" class="headerlink" title="42、VS与Halcon变量的转换"></a>42、VS与Halcon变量的转换</h2><h3 id="①-Halcon中的HTuple-→-VS-数据类型"><a href="#①-Halcon中的HTuple-→-VS-数据类型" class="headerlink" title="① Halcon中的HTuple → VS 数据类型"></a>① Halcon中的HTuple → VS 数据类型</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">HTuple hTuple = <span class="number">1234</span>;</span><br><span class="line"><span class="type">int</span> i = hTuple[<span class="number">0</span>].<span class="built_in">I</span>(); <span class="comment">// i=1234</span></span><br><span class="line"><span class="type">long</span> l = hTuple[<span class="number">0</span>].<span class="built_in">L</span>(); <span class="comment">// l=1234</span></span><br><span class="line"><span class="type">long</span> lNumber = hTuple.<span class="built_in">Num</span>(); <span class="comment">// lNumber=1，数据个数</span></span><br><span class="line"><span class="type">double</span> d = hTuple[<span class="number">0</span>].<span class="built_in">D</span>(); <span class="comment">// d=1234.0000</span></span><br><span class="line"></span><br><span class="line">hTuple = “<span class="number">1234</span>”;</span><br><span class="line">CString strBuffer = hTuple[<span class="number">0</span>].<span class="built_in">S</span>(); <span class="comment">// strBuffer=“1234”</span></span><br></pre></td></tr></table></figure>



<h3 id="②VS-数据类型-→-Halcon中的数据类型"><a href="#②VS-数据类型-→-Halcon中的数据类型" class="headerlink" title="②VS 数据类型 → Halcon中的数据类型"></a>②VS 数据类型 → Halcon中的数据类型</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> ii = <span class="number">1234</span>;</span><br><span class="line"><span class="type">double</span> dd = <span class="number">1234.1234</span>;</span><br><span class="line">CString strTemp = “Halcon”;</span><br><span class="line"></span><br><span class="line">HTuple hTuple2;</span><br><span class="line">hTuple2[<span class="number">0</span>] = ii; <span class="comment">// hTuple2[0].I() = 1234</span></span><br><span class="line">hTuple2[<span class="number">1</span>] = dd; <span class="comment">// hTuple2[1].D() = 1234.1234</span></span><br><span class="line">hTuple2[<span class="number">2</span>] = strTemp.<span class="built_in">GetBuffer</span>(); <span class="comment">// hTuple2[2].S() = “Halcon”</span></span><br><span class="line"></span><br><span class="line">i = hTuple2[<span class="number">0</span>].<span class="built_in">I</span>(); <span class="comment">// i = 1234</span></span><br><span class="line">d = hTuple2[<span class="number">1</span>].<span class="built_in">D</span>(); <span class="comment">// d = 1234.1234</span></span><br><span class="line">str = hTuple2[<span class="number">2</span>].<span class="built_in">S</span>(); <span class="comment">// str = “Halcon”</span></span><br><span class="line">lNumber = hTuple2.<span class="built_in">Num</span>(); <span class="comment">// lNumber = 3，数据个数</span></span><br></pre></td></tr></table></figure>

<h3 id="③如果Halcon的数据类型中有多个数据"><a href="#③如果Halcon的数据类型中有多个数据" class="headerlink" title="③如果Halcon的数据类型中有多个数据"></a>③如果Halcon的数据类型中有多个数据</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义vs中的CString类型</span></span><br><span class="line">CString str1;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将HTuple → VS 中 double类型</span></span><br><span class="line"><span class="type">double</span> m_mianji = hv_UserArea[i].<span class="built_in">D</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">//CString 类型 的格式化</span></span><br><span class="line">str1.<span class="built_in">Format</span>(<span class="string">&quot;%0.2f&quot;</span>, m_mianji);</span><br></pre></td></tr></table></figure>


                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Yolo</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://homeryland.cn/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/">https://homeryland.cn/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Yolo</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">
                                    <span class="chip bg-color">人工智能</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">感谢打赏</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.jpg" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'gOywyl0R9LxxdE93gftpTjG9-gzGzoHsz',
        appKey: 'xVJSnETyvvLZBUaSbHYauYWp',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;本篇
            </div>
            <div class="card">
                <a href="/2024/07/24/%E6%9C%BA%E5%99%A8%E8%A7%86%E8%A7%89/">
                    <div class="card-image">
                        
                        <img src="https://s2.loli.net/2024/06/06/dY4vajhPWgO3zsb.jpg" class="responsive-img" alt="机器视觉笔记">
                        
                        <span class="card-title">机器视觉笔记</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            机器视觉个人笔记整理
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-07-24
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Yolo
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD/">
                        <span class="chip bg-color">人工智能</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2024/06/22/OS-%E7%BB%8F%E5%85%B8%E5%90%8C%E6%AD%A5%E4%B8%8E%E4%BA%92%E6%96%A5%E9%97%AE%E9%A2%98/">
                    <div class="card-image">
                        
                        <img src="https://s2.loli.net/2024/06/22/qQJoPjZw1NkeMHB.jpg" class="responsive-img" alt="OS--经典同步与互斥问题">
                        
                        <span class="card-title">OS--经典同步与互斥问题</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            经典进程同步与互斥问题
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2024-06-22
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Yolo
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">
                        <span class="chip bg-color">操作系统</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('8'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>





    <footer class="page-footer bg-color">
    
    <div class="container row center-align" style="margin-bottom: 15px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2024</span>
            
            <span id="year">2024</span>
            <a href="/about" target="_blank">Yolo</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">52.7k</span>&nbsp;字
            
            
            
            <br>
            
            <span id="sitetime">载入运行时间...</span>
            <script>
                function siteTime() {
                    var seconds = 1000;
                    var minutes = seconds * 60;
                    var hours = minutes * 60;
                    var days = hours * 24;
                    var years = days * 365;
                    var today = new Date();
                    var startYear = "2024";
                    var startMonth = "5";
                    var startDate = "11";
                    var startHour = "0";
                    var startMinute = "0";
                    var startSecond = "0";
                    var todayYear = today.getFullYear();
                    var todayMonth = today.getMonth() + 1;
                    var todayDate = today.getDate();
                    var todayHour = today.getHours();
                    var todayMinute = today.getMinutes();
                    var todaySecond = today.getSeconds();
                    var t1 = Date.UTC(startYear, startMonth, startDate, startHour, startMinute, startSecond);
                    var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
                    var diff = t2 - t1;
                    var diffYears = Math.floor(diff / years);
                    var diffDays = Math.floor((diff / days) - diffYears * 365);
                    var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
                    var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) /
                        minutes);
                    var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours -
                        diffMinutes * minutes) / seconds);
                    if (startYear == todayYear) {
                        document.getElementById("year").innerHTML = todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffDays + " 天 " + diffHours +
                            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    } else {
                        document.getElementById("year").innerHTML = startYear + " - " + todayYear;
                        document.getElementById("sitetime").innerHTML = "本站已安全运行 " + diffYears + " 年 " + diffDays +
                            " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
                    }
                }
                setInterval(siteTime, 1000);
            </script>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link ">
    <a href="https://github.com/zw0927/zw0927.github.io" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:2946473607@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=2946473607" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 2946473607" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>



    <a href="weixin://contacts/profile/Zw18502786548" class="tooltipped" target="_blank" data-tooltip="微信联系我: Zw18502786548" data-position="top" data-delay="50">
        <i class="fab fa-weixin"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    

    

    

	
    

    
    
    <script type="text/javascript" size="150" alpha='0.6'
        zIndex="-1" src="/libs/background/ribbon-refresh.min.js" async="async"></script>
    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
